---
title: LLM Rules
description: Authoritative rules for AI assistants working with the Module System
tableOfContents:
  maxHeadingLevel: 2
---

import { Aside, Steps, Tabs, TabItem } from '@astrojs/starlight/components';

These rules apply across the **entire Module System**: starter template, module starter, and individual modules. All `CLAUDE.md` files should reference this document.

---

## The Registry Pattern (Core Concept)

**The registry pattern is the foundation of this entire system.** Everything extends through registries - never by modifying core files.

### How It Works

```
┌─────────────────────────────────────────────────────────────┐
│                     Your Application                         │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌────────────┐  │
│  │ Billing │   │  Teams  │   │ Uploads │   │ Your Code  │  │
│  │ Module  │   │ Module  │   │ Module  │   │  Feature   │  │
│  └────┬────┘   └────┬────┘   └────┬────┘   └─────┬──────┘  │
│       │             │             │              │          │
│       └─────────────┴─────────────┴──────────────┘          │
│                          │                                   │
│                          ▼                                   │
│       ┌─────────────────────────────────────────────┐       │
│       │         REGISTRIES (extension points)       │       │
│       │   navigation · dashboard · settings · routes │       │
│       └─────────────────────────────────────────────┘       │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                    Starter Template                          │
└─────────────────────────────────────────────────────────────┘
```

### The Golden Rule

<Aside type="danger">
  **NEVER modify core files to add features.** Always use registries.
</Aside>

```typescript
// ✅ CORRECT - Create a registration file
// features/billing/navigation.registration.ts
navigationRegistry.registerMain({
  id: 'billing',
  title: 'Billing',
  url: '/billing',
  icon: CreditCard,
  order: 40,
});

// ❌ WRONG - Editing routes.tsx, app.ts, or any core file
```

### Available Registries

| Registry | Purpose | Location |
|----------|---------|----------|
| `navigationRegistry` | Sidebar menu items | Frontend |
| `dashboardRegistry` | Dashboard widgets | Frontend |
| `settingsPagesRegistry` | Settings page sections | Frontend |
| `headerToolbarRegistry` | Header actions/toggles | Frontend |
| `adminPagesRegistry` | Admin panel pages | Frontend |
| `preferencesRegistry` | User preference options | Frontend |
| `routeRegistry` | API routes (versioned) | Backend |
| `serviceRegistry` | Cross-feature services | Backend |
| `filterRegistry` | Data transformation hooks | Both |
| `actionRegistry` | Side effect hooks | Both |

→ See [Registry Reference](/starter-template/registries/) for complete API documentation.

→ See [Base Registry](/starter-template/base-registry/) for creating custom registries.

### Self-Registration Pattern

Features register via **side-effect imports** in their `index.ts`:

```typescript
// features/billing/index.ts

// Side-effect imports trigger registration at import time
import './navigation.registration';
import './settings.registration';
import './route.registration';

// Named exports for public API
export { BillingPage } from './pages/BillingPage';
export { useBilling } from './hooks/useBilling';
```

When the app imports the feature, registrations happen automatically. No manual wiring.

---

## Critical Rules

These rules are **mandatory** across all parts of the system.

### 1. Use Registries, Not Core Files

Already covered above - this is the most important rule.

### 2. Version Bumping

**When you modify infrastructure files, you MUST bump the version.**

<Tabs>
  <TabItem label="Starter Template">
Files requiring bump:
```
frontend/src/config/*.ts     # Registry files
frontend/src/lib/*.ts        # Utilities
backend/src/config/*.ts      # Registry files
backend/src/lib/*.ts         # Utilities
backend/src/middleware/*.ts  # Middleware
scripts/*.ps1, scripts/*.sh  # CLI scripts
create-app.*, update-template.*
```

Command:
```bash
npm run template:version:patch   # Bug fixes
npm run template:version:minor   # New features
npm run template:version:major   # Breaking changes
```
  </TabItem>
  <TabItem label="Module Starter">
Files requiring bump:
```
src/templates/**/*           # Code templates
src/scaffold/**/*            # Scaffold infrastructure
src/config/*.ts              # Configuration
```

Command:
```bash
npm run release:patch
npm run release:minor
npm run release:major
```
  </TabItem>
  <TabItem label="Individual Modules">
Files requiring bump:
```
src/templates/**/*           # Module templates
src/module.ts                # Module definition
Any file affecting generated output
```

Command:
```bash
npm run release:patch
npm run release:minor
npm run release:major
```
  </TabItem>
</Tabs>

<Aside type="danger">
  Never skip version bumping. Apps track versions to receive updates. Missing bumps break the update system.
</Aside>

### 3. Push Documentation Changes

When editing ANY file in `docs/`, you MUST push:

```bash
cd docs && git add . && git commit -m "Docs: description"
git push                    # Triggers deploy to live site
cd .. && git add docs && git commit -m "Update docs submodule"
```

### 4. Backend Import Extensions

Always use `.js` for relative imports in backend TypeScript:

```typescript
// ✅ Correct
import { prisma } from '../../lib/prisma.js';

// ❌ Wrong - fails at runtime
import { prisma } from '../../lib/prisma';
```

### 5. File Headers

Every new file needs a header:

```typescript
// ========================================================================
// FILE: [path/from/repo/root]
// PURPOSE: [one-line description]
// ========================================================================
```

---

## Working in Different Contexts

### In the Starter Template

You're modifying the **foundation** that all apps and modules build on.

**Key files:**
- `frontend/src/config/*.registry.ts` - Registry definitions
- `backend/src/config/*.registry.ts` - Backend registries
- `backend/src/middleware/*.ts` - Auth and other middleware

**Rules:**
- Changes here affect ALL apps using the template
- Always bump version after changes
- Test that existing features still work

### In the Module Starter

You're modifying the **scaffolding system** that generates modules. Like the starter template, it has an upstream update system.

**Key files:**
- `src/templates/` - Code templates for generated modules
- `src/scaffold/` - Scaffolding logic

**Rules:**
- Changes affect ALL modules (existing modules can pull updates via `template-upstream`)
- Test by generating a new module
- Bump version after template changes

### In Individual Modules

You're building a **feature that plugs into the starter template**.

**Key files:**
- `src/templates/` - Code that gets copied to apps
- `src/module.ts` - Module definition and dependencies

**Rules:**
- Use registries to extend the app (never modify core files)
- Follow the exact feature structure from starter template
- Bump version when templates change

---

## Registry Details

### Type Names

Use the **exact type names** from registry files:

| Registry | Correct Type | NOT |
|----------|-------------|-----|
| `navigationRegistry` | `NavigationItem` | ~~NavItem~~ |
| `dashboardRegistry` | `DashboardWidget` | ~~Widget~~ |
| `settingsPagesRegistry` | `SettingsPage` | ~~SettingPage~~ |
| `headerToolbarRegistry` | `HeaderToolbarItem` | ~~ToolbarItem~~ |

### Order Values

All registries use consistent ordering:

| Range | Use For |
|-------|---------|
| 1-9 | Core/system items |
| 10-29 | Primary features (Dashboard, Home) |
| 30-49 | Main features |
| 50-69 | Secondary features |
| 70-89 | Settings, admin |
| 90-99 | Footer items, logout |
| 100+ | Third-party modules/plugins |

**Lower numbers = appears first / runs first**

### Creating a Registration File

```typescript
// features/my-feature/navigation.registration.ts
import { navigationRegistry } from '@/config/navigation.registry';
import { MyIcon } from 'lucide-react';

navigationRegistry.registerMain({
  id: 'my-feature',           // Unique ID
  title: 'My Feature',        // Display text
  url: '/my-feature',         // Route path
  icon: MyIcon,               // Lucide icon
  order: 35,                  // Position in list
  // Optional:
  // roles: ['admin'],        // Role-based visibility
  // badge: 3,                // Notification badge
});
```

---

## Feature Architecture

→ See [Project Architecture](/starter-template/architecture/) for detailed file organisation.

### Frontend Structure

```
frontend/src/features/[feature]/
├── index.ts                    # Exports + registration imports
├── routes.config.tsx           # Route definitions
├── navigation.registration.ts  # Nav registry
├── settings.registration.ts    # Settings registry (if needed)
├── components/                 # UI components
├── pages/                      # Page components
├── services/                   # API service layer
├── hooks/                      # Custom hooks
└── types/                      # TypeScript types
```

### Backend Structure

```
backend/src/features/[feature]/
├── index.ts                    # Exports + registration imports
├── [feature].routes.ts         # Express routes
├── [feature].service.ts        # Business logic
├── [feature].types.ts          # Types
├── route.registration.ts       # Route registry
└── service.registration.ts     # Service registry
```

---

## Spelling Conventions

**Australian spelling** in prose, **American spelling** in code.

| Context | Use | Example |
|---------|-----|---------|
| Docs, comments, UI text | Australian | colour, behaviour, organisation |
| Variables, functions, CSS | American | `backgroundColor`, `customizeSettings` |

---

## System Knowledge

→ See [Configuration](/starter-template/configuration/) for complete environment setup.

### Auth URLs Must Match

Frontend and backend must use **identical** auth URLs:

```env
VITE_NEON_AUTH_URL=https://xxx.neonauth.region.aws.neon.tech/neondb/auth
NEON_AUTH_URL=https://xxx.neonauth.region.aws.neon.tech/neondb/auth
```

### Database URLs

| Variable | Pattern | Use For |
|----------|---------|---------|
| `DATABASE_URL` | has `-pooler` | App queries |
| `DIRECT_DATABASE_URL` | no `-pooler` | Migrations only |

### Migrations

Always use `migrate dev`, never `db push`:

```bash
cd backend && npx prisma migrate dev --name describe_change
```

---

## Common Mistakes

| Mistake | Fix |
|---------|-----|
| Editing core files for features | Use registration files and registries |
| Missing `.js` in backend imports | Always: `import { x } from './file.js'` |
| Using `NavItem` instead of `NavigationItem` | Use exact type names from registry |
| Editing `components/ui/` | Never edit shadcn - regenerate instead |
| Using `db push` | Use `prisma migrate dev` |
| Forgetting version bump | Bump after any infrastructure change |
| Forgetting to push docs | Always push docs submodule |

---

## Code Conventions

### Import Order

1. External packages (react, express)
2. Internal absolute imports (`@/...`)
3. Relative imports (`./`, `../`)

### Naming

| Item | Convention | Example |
|------|------------|---------|
| Files | kebab-case | `user-profile.tsx` |
| Components | PascalCase | `UserProfile` |
| Functions | camelCase | `getUserProfile` |
| Registry files | `*.registry.ts` | `navigation.registry.ts` |
| Registration files | `*.registration.ts` | `navigation.registration.ts` |

---

## Shell Script Rules

→ See [Updating from Template](/starter-template/updating/) for how the update system works.

When working on `create-app.*` or `update-template.*`:

- **Always update both `.ps1` AND `.sh` versions**
- Use `--no-pager` for git commands: `git --no-pager log`
- Use `git checkout` not `git show` for file content
- Self-updating scripts must: commit → push → wait → re-execute

---

## Do and Don't

### DO

- ✅ Use registries for all extensibility
- ✅ Follow feature-based architecture
- ✅ Add file headers to all files
- ✅ Use `.js` extensions in backend
- ✅ Bump version after infrastructure changes
- ✅ Push docs after documentation changes

### DON'T

- ❌ Modify core files for features
- ❌ Edit `components/ui/` (shadcn)
- ❌ Put business logic in route handlers
- ❌ Use `db push` instead of `migrate dev`
- ❌ Skip version bumping
- ❌ Leave docs changes unpushed

---

## Testing Checklist

- [ ] TypeScript compiles: `npm run type-check`
- [ ] Frontend runs: `npm run dev:frontend`
- [ ] Backend runs: `npm run dev:backend`
- [ ] Registrations appear correctly
- [ ] **Version bumped** (if infrastructure changed)
- [ ] **Docs pushed** (if documentation changed)

---

## Quick Reference

### Version Commands

```bash
# Starter template
npm run template:version:patch
npm run template:version:minor
npm run template:version:major

# Modules
npm run release:patch
npm run release:minor
npm run release:major
```

### Common Commands

```bash
npm run dev                    # Run frontend + backend
npm run type-check             # Check TypeScript
cd backend && npx prisma studio        # Database GUI
cd backend && npx prisma migrate dev   # Migrations
cd frontend && npx shadcn@latest add [component]
```

---

## Referencing These Rules

Add to CLAUDE.md:

```markdown
## LLM Rules Reference

For comprehensive rules, see: **https://saas.uniqueicon.com.au/getting-started/llm-rules/**

**Core concept:** Use the registry pattern - never modify core files for features.

**Critical rules:**
1. **Use registries** for all extensibility (navigation, settings, routes, etc.)
2. **Bump version** after modifying config/, lib/, middleware/, scripts/
3. **Push docs** after editing documentation
4. **Add file headers** to all new files
5. **Use .js extensions** in backend imports
```
