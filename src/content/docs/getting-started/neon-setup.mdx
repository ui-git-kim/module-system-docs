---
title: Neon Database Setup
description: How to set up Neon PostgreSQL and Neon Auth for your application
---

This guide walks you through setting up Neon PostgreSQL database and Neon Auth for authentication.

## Prerequisites

- A [Neon account](https://neon.tech) (free tier available)
- Node.js 18+ installed

## Step 1: Create a Neon Project

1. Go to [Neon Console](https://console.neon.tech)
2. Click **New Project**
3. Choose a name (e.g., `my-app`)
4. Select your region (choose closest to your users)
5. Click **Create Project**

## Step 2: Get Database Connection Strings

After creating the project, you'll see your connection details. You need two URLs:

### Pooled Connection (for app queries)

```
postgresql://user:password@ep-xxx-pooler.region.aws.neon.tech/neondb?sslmode=require
```

Note the `-pooler` in the hostname. This is for your `DATABASE_URL`.

### Direct Connection (for migrations)

```
postgresql://user:password@ep-xxx.region.aws.neon.tech/neondb?sslmode=require
```

No `-pooler` in the hostname. This is for your `DIRECT_DATABASE_URL`.

:::tip
The pooled connection handles connection limits efficiently for your app. The direct connection is needed for Prisma migrations which require a persistent connection.
:::

## Step 3: Enable Neon Auth

Neon Auth provides authentication with email OTP (one-time password) out of the box.

1. In your Neon project, go to **Auth** in the sidebar
2. Click **Enable Auth**
3. Copy the **Auth URL** - it looks like:
   ```
   https://xxx.neonauth.region.aws.neon.tech/neondb/auth
   ```

:::caution[Important]
The Auth URL must match **exactly** between frontend and backend `.env` files, including the `/neondb/auth` path.
:::

## Step 4: Configure Environment Variables

### Backend (`backend/.env`)

```bash
# Database - Pooled connection for app queries
DATABASE_URL="postgresql://user:password@ep-xxx-pooler.region.aws.neon.tech/neondb?sslmode=require"

# Database - Direct connection for migrations only
DIRECT_DATABASE_URL="postgresql://user:password@ep-xxx.region.aws.neon.tech/neondb?sslmode=require"

# Database adapter (use 'neon' for Neon, 'pg' for other PostgreSQL)
DATABASE_ADAPTER=neon

# Neon Auth URL (must match frontend exactly)
NEON_AUTH_URL="https://xxx.neonauth.region.aws.neon.tech/neondb/auth"

# Server config
PORT=3100
NODE_ENV=development

# Frontend URL for CORS
FRONTEND_URL=http://localhost:5173

# Optional settings
DEBUG_PRISMA=false
DB_QUERY_TIMEOUT=10000
SHUTDOWN_TIMEOUT=10000
```

### Frontend (`frontend/.env`)

```bash
# Neon Auth URL (must match backend exactly)
VITE_NEON_AUTH_URL=https://xxx.neonauth.region.aws.neon.tech/neondb/auth

# Backend API URL
VITE_API_URL=http://localhost:3100

# App name (shown in UI)
VITE_APP_NAME=My App
```

## Step 5: Run Migrations

```bash
cd backend
npx prisma migrate dev --name init
```

This creates the initial database tables.

## Step 6: Verify Setup

```bash
# Start the app
npm run dev

# Visit http://localhost:5173
# Click Sign In
# Enter your email
# Check your email for the OTP code
# Enter the code to sign in
```

If you can sign in successfully, your Neon setup is complete!

## Troubleshooting

### 401 Unauthorized Errors

1. **Check Auth URL match** - Compare `NEON_AUTH_URL` in backend and `VITE_NEON_AUTH_URL` in frontend. They must be identical.

2. **Check the path** - The URL should include `/neondb/auth` (or similar path shown in Neon console).

3. **Verify JWKS endpoint** - Visit `<NEON_AUTH_URL>/.well-known/jwks.json` in your browser. You should see JSON with public keys.

### Connection Errors

1. **Check connection strings** - Ensure you're using the pooled URL (`-pooler`) for `DATABASE_URL`.

2. **Check SSL** - The connection string should include `?sslmode=require`.

3. **Check region** - Make sure the region in your connection string matches your Neon project.

### Migration Errors

1. **Use direct URL** - Migrations need `DIRECT_DATABASE_URL` (without `-pooler`).

2. **Check Prisma config** - Ensure `prisma.config.ts` uses the direct URL for migrations.

## Production Considerations

### Connection Pooling

Neon's connection pooler is enabled by default with the `-pooler` URL. For high traffic:

- Consider Neon's serverless driver for edge deployments
- Monitor connection usage in Neon console
- Set appropriate `DB_QUERY_TIMEOUT`

### Environment Security

- Never commit `.env` files
- Use environment variables in your hosting platform
- Rotate database passwords periodically
- Use separate Neon branches for staging/production

### Auth Configuration

Neon Auth supports additional configuration:

- Custom email templates
- Social login providers (coming soon)
- Session duration settings

See [Neon Auth documentation](https://neon.tech/docs/guides/neon-auth) for details.
