---
title: Developer Workflow
description: How to develop, test, version, and maintain the Structure module
sidebar:
  order: 4
---

import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

This page covers the full developer workflow for working on the Structure module — from local setup to testing, versioning, and documentation.

---

## Setup

### Clone and Install

```bash
git clone <structure-repo-url>
cd structure
npm install
```

### Build

```bash
npm run build     # One-time build
npm run dev       # Watch mode (rebuilds on file changes)
```

### Link for Local Testing

```bash
npm link          # Makes the 'structure' command available globally
```

---

## Development Loop

The standard workflow when making changes:

```
Edit templates → Build → Test in app → Version bump → Commit → Push
```

### 1. Edit Templates

All your work happens in these locations:

| Location | What You Edit |
|----------|--------------|
| `src/templates/frontend/` | Frontend component, hook, and service templates |
| `src/templates/backend/` | Backend route, service, and registration templates |
| `src/templates/schema.ts` | Prisma schema (database tables) |
| `src/module.ts` | Module configuration (routes, dependencies, features list) |

<Aside type="caution">
Never edit files in `src/scaffold/` or `src/cli.ts`. These are shared infrastructure — report bugs upstream to the module starter template.
</Aside>

### 2. Build

```bash
npm run build
```

This compiles TypeScript to the `dist/` folder. Template string constants are bundled as-is — they're not transpiled, just included in the build output.

### 3. Test in a Starter App

In a separate terminal, navigate to a starter template app:

```bash
# Fresh install
npx structure init

# Update existing installation (after template changes)
npx structure update

# Force overwrite all files
npx structure update --force

# Start the app
npm run dev
```

Verify that:
- Frontend routes work (`/clients`, `/clients/:id`)
- Backend API responds (`/api/v1/structure/nodes`)
- Admin page loads at Admin > App Structure
- Registrations are active (sidebar nav, header toolbar, admin page)
- Action hooks fire on mutations (check structured logs)

### 4. Version Bump

After modifying templates, bump the version:

```bash
npm run version:patch  # Bug fix (x.x.X)
npm run version:minor  # New feature (x.X.0)
npm run version:major  # Breaking change (X.0.0)
```

### 5. Commit and Push

```bash
git add src/templates/ src/module.ts
git commit -m "feat: description

Co-Authored-By: Claude <noreply@anthropic.com>"
git push
```

---

## Template Placeholders

Templates use placeholder patterns that get replaced during installation:

| Placeholder | Replaced With | Example |
|-------------|--------------|---------|
| `My Feature` | Title Case (space-separated) | `Ai Chat` |
| `my feature` | lowercase (space-separated) | `ai chat` |
| `my-feature` | moduleId (kebab-case) | `ai-chat` |
| `myFeature` | camelCase | `aiChat` |
| `MyFeature` | PascalCase | `AiChat` |
| `my_feature` | snake_case | `ai_chat` |

Templates also support variable substitution from prompt answers:

| Syntax | Purpose |
|--------|---------|
| `{{variableName}}` | Replace with prompt answer |
| `{{variableName\|default}}` | Replace with prompt answer or default value |
| `{{#if var}}...{{/if}}` | Conditional block |

---

## Scaffold Updates

The scaffold provides shared CLI infrastructure (init, update, uninstall commands). It's maintained separately and receives updates independently of your templates.

```bash
npm run scaffold:check    # Check for scaffold updates
npm run scaffold:update   # Apply scaffold updates
```

<Aside type="note">
Scaffold updates may cause merge conflicts in `src/module.ts` if both you and the scaffold have modified it. Resolve conflicts by keeping your custom template registrations and accepting scaffold structural changes.
</Aside>

---

## Lifecycle Hooks

Structure defines lifecycle hooks in `module.ts` that run during installation and updates:

```typescript
lifecycle: {
  onInstall: async (context) => {
    context.utils.log.success('Structure module installed successfully');
    context.utils.log.info('Default node types will be seeded on first app startup');
  },
  onUpdate: async (context) => {
    context.utils.log.info(
      `Structure updated from ${context.fromVersion} to ${context.toVersion}`
    );
    if (context.versionChange.major) {
      context.utils.log.warning('Major version update — review migration notes');
    }
    if (context.changes.schemaUpdated) {
      context.utils.log.info('Schema was updated — run prisma migrate to apply changes');
    }
  },
},
```

The `onInstall` hook fires after first installation. The `onUpdate` hook fires after updates and receives version transition information via `context.fromVersion`, `context.toVersion`, `context.versionChange`, and `context.changes`.

---

## Documentation

Docs live in the `docs/` submodule and deploy automatically when pushed.

### Editing Docs

Files are in `docs/src/content/docs/modules/structure/`. Edit the `.mdx` files directly — they use Starlight's Markdown + component syntax.

### Pushing Docs

Docs changes must be pushed separately since `docs/` is a git submodule:

```bash
cd docs && git add . && git commit -m "Docs: description" && git push
cd .. && git add docs && git commit -m "docs: update docs submodule"
```

---

## Common Commands

| Command | Description |
|---------|-------------|
| `npm run build` | Build module |
| `npm run dev` | Watch mode |
| `npm run type-check` | TypeScript check |
| `npm link` | Link for local testing |
| `npm run version:patch` | Bug fix bump |
| `npm run version:minor` | New feature bump |
| `npm run version:major` | Breaking change bump |
| `npm run scaffold:check` | Check for scaffold updates |
| `npm run scaffold:update` | Apply scaffold updates |

---

## Pre-Commit Checklist

Run through this before committing:

- [ ] **No scaffold files modified** — Only edited `src/templates/` and `src/module.ts`
- [ ] **File headers in templates** — All template files have the standard comment header
- [ ] **Backend imports use `.js`** — All backend template relative imports include `.js` extension
- [ ] **Placeholders used** — Templates use `my-feature`, `MyFeature`, `myFeature` patterns
- [ ] **Uses registries** — Generated code extends via registries, not core file edits
- [ ] **Build passes** — `npm run build` completes without errors
- [ ] **Version bumped** — If templates changed, ran `npm run version:patch` (or minor/major)
- [ ] **Docs updated** — If behaviour changed, updated relevant `.mdx` files and pushed docs submodule

---

## Next Steps

- [Configuration](/modules/structure/configuration/) — Database schema and API reference
- [Integration](/modules/structure/integration/) — How other modules extend Structure
- [Building Modules docs](https://saas.uniqueicon.com.au/module-starter/building-modules/) — Full guide to template development
