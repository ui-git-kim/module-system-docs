---
title: Configuration
description: Installation prompts, database schema, API endpoints, and node type configuration
sidebar:
  order: 1
---

import { Steps, Tabs, TabItem, Aside } from '@astrojs/starlight/components';

This page covers everything about how Structure is configured — from the CLI prompts during installation to the database schema and API endpoints.

---

## Installation Prompts

When you run `npx structure init`, the CLI asks you to define your app's structure. Some prompts are conditional.

### Container Node (Optional)

A container is a top-level grouping node. Use this when your primary entity belongs to something else (e.g., Client contains Projects, Building contains Units).

| Prompt | Default | Condition | Description |
|--------|---------|-----------|-------------|
| `hasContainer` | No | — | Do you need a container type? |
| `containerNodeName` | Client | hasContainer=true | Singular name |
| `containerNodePlural` | Clients | hasContainer=true | Plural form |
| `containerSlug` | clients | hasContainer=true | URL slug |
| `containerNodeIcon` | Building2 | hasContainer=true | Lucide icon |

**When to use a container:**
- Legal: Clients contain Matters
- Agency: Clients contain Projects
- Property: Buildings contain Units

**When NOT to use a container:**
- Simple project management (just Projects)
- Personal productivity (just Tasks or Notes)

### Primary Node

The main entity your users work with.

| Prompt | Default | Condition | Description |
|--------|---------|-----------|-------------|
| `primaryNodeName` | Project | — | Singular name (e.g., "Matter", "Case") |
| `primaryNodePlural` | Projects | — | Plural form for navigation |
| `primarySlug` | projects | — | URL path |
| `primaryNodeIcon` | Briefcase | — | Lucide icon |
| `primaryInMainNav` | Yes | hasContainer=false | Show in main navigation? |

### Optional Features

| Prompt | Default | Description |
|--------|---------|-------------|
| `enableFolders` | Yes | Allow folders within nodes for organisation |
| `enableTags` | Yes | Allow tags for categorisation |

---

## Post-Installation

<Steps>
1. **Generate Prisma client**
   ```bash
   npx prisma generate
   ```

2. **Run migrations**
   ```bash
   npx prisma migrate dev
   ```

3. **Add routes** to `frontend/src/routes.tsx`
   ```typescript
   import { structureRoutes } from '@/features/structure';

   // In protected routes:
   ...structureRoutes,
   ```

4. **Initialise backend** in `server.ts`
   ```typescript
   import { initStructure } from './features/structure';

   await initStructure();
   ```
</Steps>

---

## Module Initialisation

On first backend start, `initStructure()` seeds default node types based on your installation prompts. The default types are:

- **Container type** (if `hasContainer` was true) — e.g., Client
- **Primary type** — e.g., Project
- **Folder type** (if `enableFolders` was true) — for organisation within nodes
- **Tag type** (if `enableTags` was true) — for categorisation

Default types are created with `userId: null`, making them system-level types visible to all users.

---

## Database Schema

Structure creates four tables in your database.

### structure_node

The universal entity table — every node is stored here.

| Column | Type | Description |
|--------|------|-------------|
| `id` | String | CUID primary key |
| `userId` | String | Owner |
| `nodeType` | String | References node type slug |
| `name` | String | Display name |
| `slug` | String? | URL-safe identifier |
| `description` | String? | Rich text description |
| `data` | JSON | Custom field values |
| `icon` | String? | Custom icon override |
| `color` | String? | Custom colour override |
| `parentId` | String? | Parent node (self-referential) |
| `path` | String? | Materialised path for tree queries |
| `depth` | Int | Tree depth (0 = root) |
| `sortOrder` | Int | Position among siblings |
| `fromNodeId` | String? | Source node for connections |
| `toNodeId` | String? | Target node for connections |
| `connectionType` | String? | Connection relationship label |
| `status` | String | `active` / `archived` / `deleted` |
| `isFavorite` | Boolean | Marked as favourite |
| `isPublished` | Boolean | Publishing workflow state |
| `publishedSlug` | String? | Public URL slug |
| `settings` | JSON | Node-specific settings |
| `metadata` | JSON | Module extensibility data |
| `createdAt` | DateTime | Creation timestamp |
| `updatedAt` | DateTime | Last update timestamp |

<Aside type="note" title="Self-referential relations">
The schema uses multiple self-referential `@relation` directives to disambiguate `parentId`, `fromNodeId`, and `toNodeId` foreign keys. This is required by Prisma when a model references itself through multiple fields.
</Aside>

### structure_node_type

Configuration for each node type.

| Column | Type | Description |
|--------|------|-------------|
| `id` | String | CUID primary key |
| `userId` | String? | Owner (null = system default) |
| `slug` | String | Unique identifier |
| `name` | String | Display name |
| `namePlural` | String | Plural form |
| `description` | String? | Type description |
| `icon` | String? | Default Lucide icon |
| `color` | String? | Default theme colour |
| `moduleId` | String? | Owning module ID |
| `rules` | JSON | Hierarchy rules |
| `features` | JSON | Enabled features |
| `fields` | JSON | Custom field definitions |
| `navigation` | JSON | Navigation config |
| `cardTemplateId` | String? | FK → structure_template for card view |
| `listItemTemplateId` | String? | FK → structure_template for list view |
| `detailHeaderTemplateId` | String? | FK → structure_template for detail header |
| `overviewTemplateId` | String? | FK → structure_template for overview |
| `templateOverrides` | JSON | Local overrides on assigned templates |
| `integrations` | JSON | Admin control of module tabs/widgets/extensions |
| `isSystem` | Boolean | Protected from user editing |
| `isEnabled` | Boolean | Whether the type is active |
| `sortOrder` | Int | Display order |

### structure_template

Reusable rendering templates for views. A template defines how nodes render in a specific view (card, list, detail header, overview) and can be assigned to multiple node types with local overrides.

| Column | Type | Description |
|--------|------|-------------|
| `id` | String | CUID primary key |
| `userId` | String | Owner |
| `name` | String | Display name |
| `slug` | String | URL-friendly identifier |
| `description` | String? | Template description |
| `type` | String | `card`, `listItem`, `detailHeader`, or `overview` |
| `config` | JSON | View-specific configuration |
| `isDefault` | Boolean | Default template for this type |
| `sortOrder` | Int | Display order |

### structure_settings

User-specific preferences and UI state.

| Column | Type | Description |
|--------|------|-------------|
| `id` | String | CUID primary key |
| `userId` | String | Unique owner reference |
| `settings` | JSON | Flexible settings object |

---

## Node Type Configuration

The full TypeScript interface for node type configuration:

### NodeTypeConfig

```typescript
interface NodeTypeConfig {
  slug: string;
  name: string;
  namePlural: string;
  description?: string;
  icon: string;
  color?: string;
  moduleId?: string;
  isSystem: boolean;
  sortOrder: number;
  rules: NodeTypeRules;
  features: NodeTypeFeatures;
  fields: NodeTypeField[];
  navigation: NodeTypeNavigation;
  labels?: NodeTypeLabels;
  integrations?: NodeTypeIntegrations;
}
```

### Rules

```typescript
interface NodeTypeRules {
  allowedParents?: string[];
  allowedChildren?: string[];
  canBeRoot?: boolean;
  canNestSameType?: boolean;
  canContainSameType?: boolean;
  maxDepth?: number;
}
```

### Features

```typescript
interface NodeTypeFeatures {
  canFavorite?: boolean;
  canArchive?: boolean;
  canPublish?: boolean;
  canManualSort?: boolean;
  customSlug?: boolean;
  customColor?: boolean;
  customIcon?: boolean;
}
```

### Navigation

```typescript
interface NodeTypeNavigation {
  mainNav?: {
    enabled?: boolean;
    order?: number;
    icon?: string;
  };
  sidebarNav?: {
    style?: 'list' | 'tree';
    showEmpty?: boolean;
    maxItems?: number;
    sortBy?: string;
    filter?: string;
    label?: string;
  };
  pageNav?: {
    style?: 'tabs' | 'sidebar' | 'none';
    builtInTabs?: {
      overview?: boolean;
      info?: boolean;
      children?: boolean;
      connections?: boolean;
      settings?: boolean;
    };
    defaultTab?: string;
  };
  listPage?: {
    defaultView?: 'grid' | 'list' | 'table';
    defaultSort?: string;
    showFilters?: boolean;
    showSearch?: boolean;
    card?: {
      showDescription?: boolean;
      showIcon?: boolean;
      showColor?: boolean;
      showFields?: string[];
    };
    columns?: Array<{
      fieldId: string;
      label?: string;
      width?: string;
      sortable?: boolean;
    }>;
    filterableFields?: string[];
  };
}
```

### Fields

```typescript
interface NodeTypeField {
  id: string;
  type: string;        // See built-in types below
  label: string;
  description?: string;
  placeholder?: string;
  required?: boolean;
  options?: Array<{ label: string; value: string }>;
  validation?: {
    min?: number;
    max?: number;
    pattern?: string;
    message?: string;
  };
  order?: number;
  section?: string;
  width?: 'full' | 'half';
}
```

**Built-in field types:** text, textarea, number, date, datetime, select, multiselect, toggle, url, email, secret, node-reference, media

### Labels

```typescript
interface NodeTypeLabels {
  addNew?: string;
  editItem?: string;
  deleteItem?: string;
  archiveAction?: string;
  restoreAction?: string;
  listTitle?: string;
  emptyState?: string;
  searchPlaceholder?: string;
  createFirst?: string;
  confirmDelete?: string;
}
```

---

## API Endpoints

All endpoints are prefixed with `/api/v1/structure`.

### Nodes

| Method | Path | Description |
|--------|------|-------------|
| GET | `/nodes` | List nodes (with filters) |
| GET | `/nodes/:id` | Get single node |
| POST | `/nodes` | Create node |
| PATCH | `/nodes/:id` | Update node |
| DELETE | `/nodes/:id` | Soft delete |
| POST | `/nodes/:id/move` | Move to different parent |
| POST | `/nodes/:id/duplicate` | Duplicate node |
| POST | `/nodes/:id/archive` | Archive |
| POST | `/nodes/:id/restore` | Restore from archive |
| POST | `/nodes/:id/favorite` | Toggle favourite |
| GET | `/nodes/:id/path` | Get ancestor path |
| GET | `/nodes/:id/children` | Get direct children |
| GET | `/nodes/:id/descendants` | Get all descendants |

### Connections

| Method | Path | Description |
|--------|------|-------------|
| GET | `/nodes/:id/connections` | Get connections for a node |
| POST | `/connections` | Create a connection |
| DELETE | `/connections/:id` | Remove a connection |

### Tree

| Method | Path | Description |
|--------|------|-------------|
| GET | `/tree` | Get tree structure (optional `?type=` filter) |
| POST | `/reorder` | Batch reorder nodes within a parent |

### Node Types

| Method | Path | Description |
|--------|------|-------------|
| GET | `/types` | List all types (add `?all=true` for disabled) |
| GET | `/types/:slug` | Get type config |
| POST | `/types` | Create type (admin only) |
| PATCH | `/types/:slug` | Update type (admin only) |
| DELETE | `/types/:slug` | Delete type (admin only, fails if nodes exist) |

### Templates

| Method | Path | Description |
|--------|------|-------------|
| GET | `/templates` | List templates (optional `?type=` filter) |
| GET | `/templates/:id` | Get single template |
| POST | `/templates` | Create template |
| PATCH | `/templates/:id` | Update template |
| DELETE | `/templates/:id` | Delete template |

### Settings

| Method | Path | Description |
|--------|------|-------------|
| GET | `/settings` | Get user settings |
| PATCH | `/settings` | Update user settings (merges) |

### Query Parameters

| Param | Description |
|-------|-------------|
| `type` | Filter by node type slug |
| `types` | Comma-separated list of type slugs |
| `parentId` | Filter by parent (use `null` for roots) |
| `status` | `active`, `archived`, `deleted`, or `all` |
| `isFavorite` | `true` or `false` |
| `search` | Search name and description |
| `page`, `limit` | Pagination |
| `sortBy` | `name`, `createdAt`, `updatedAt`, or `sortOrder` |
| `sortOrder` | `asc` or `desc` |
| `includeChildren` | `true` to include child nodes |
| `includeChildrenDepth` | Depth of children to include |
| `includePath` | `true` to include ancestor path |
| `includeConnectionCounts` | `true` to include connection counts |

---

## Request Validation

All POST and PATCH endpoints validate request bodies using Zod schemas. Invalid requests return a `400 Bad Request` with a descriptive error message.

| Schema | Used by | Key validations |
|--------|---------|----------------|
| `createNodeSchema` | POST `/nodes` | `nodeType` and `name` required, max lengths |
| `updateNodeSchema` | PATCH `/nodes/:id` | All fields optional, max lengths |
| `moveNodeSchema` | POST `/nodes/:id/move` | `newParentId` required (nullable) |
| `reorderNodesSchema` | POST `/reorder` | `nodeIds` array required (min 1) |
| `createConnectionSchema` | POST `/connections` | `fromNodeId`, `toNodeId`, `connectionType` required |
| `createNodeTypeSchema` | POST `/types` | `slug` regex validated, `name`/`namePlural` required |
| `updateNodeTypeSchema` | PATCH `/types/:slug` | All fields optional |
| `createTemplateSchema` | POST `/templates` | `name`, `type` required, `slug` regex validated |
| `updateTemplateSchema` | PATCH `/templates/:id` | All fields optional |

---

## Updating

```bash
npx structure update            # Update templates and schema
npx structure update --skip-schema  # Update templates only
```

The update command pulls the latest template versions. If the schema has changed, it updates your Prisma schema block. Run `npx prisma generate` and `npx prisma migrate dev` after updating.

---

## Uninstalling

```bash
npx structure uninstall
```

This removes generated files and the schema block. You will need to manually clean up any references in your `routes.tsx` and `server.ts`.

---

## Next Steps

- [Usage](/modules/structure/usage/) — Admin page, pages, components, and hooks
- [Integration](/modules/structure/integration/) — How other modules extend Structure
- [Database docs](/starter-template/database/) — Starter template Prisma setup and migration commands
