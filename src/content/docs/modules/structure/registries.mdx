---
title: Registries
description: Extending nodes with tabs, widgets, card extensions, actions, columns, filters, sidebar sections, and field types
---

import { Aside } from '@astrojs/starlight/components';

Structure provides nine registries for managing and extending node functionality.

<Aside type="tip">
All registries except the node type registry extend `BaseRegistry` from `@/config/base.registry`. This gives them standard methods like `register()`, `unregister()`, `get()`, `getAll()`, and automatic React hooks. The node type registry is custom because it syncs from the database.
</Aside>

---

## Node Type Registry

The `NodeTypeRegistry` is a **custom registry** that syncs configuration from the database rather than relying solely on in-memory registration. It does not extend `BaseRegistry` because it needs database synchronisation support.

### Methods

| Method | Description |
|--------|-------------|
| `register(config)` | Register a node type configuration |
| `get(slug)` | Get config for a specific type |
| `getAll()` | Get all registered types |
| `getEnabledTypes()` | Get all types sorted by sortOrder |
| `syncFromDatabase(types)` | Update registry from database response |
| `onSync(callback)` | Subscribe to sync events (returns unsubscribe function) |

### Reactive Hooks

```typescript
import { useEnabledNodeTypes } from '@/features/structure';

function TypeList() {
  // Re-renders when types sync from database
  const types = useEnabledNodeTypes();
}
```

```typescript
import { useStructureNavItems } from '@/features/structure';

function Sidebar() {
  // Re-renders when types change
  const navItems = useStructureNavItems();
}
```

<Aside type="note" title="Reactivity">
The `useEnabledNodeTypes` and `useStructureNavItems` hooks subscribe to the registry's `onSync` event internally. They automatically re-render when node types are updated from the database, ensuring the UI stays in sync. The `onSync` method returns an unsubscribe function for proper cleanup.
</Aside>

---

## Node Tab Registry

Add tabs to node detail pages.

```typescript
import { nodeTabRegistry } from '@/features/structure';

nodeTabRegistry.register({
  id: 'documents',
  moduleId: 'documents',
  label: 'Documents',
  icon: 'FileText',
  nodeTypes: ['client', 'matter'],
  order: 30,
  component: DocumentsTab,
});
```

**React Hook:**

```typescript
import { useNodeTabRegistry } from '@/features/structure';

function TabBar() {
  const allTabs = useNodeTabRegistry();
}
```

**Filtered for a Node:**

```typescript
const tabsForThisNode = nodeTabRegistry.getTabsForNodeType(
  nodeType.slug,
  node,
  nodeTypeConfig
);
```

### Tab Configuration

| Property | Type | Description |
|----------|------|-------------|
| `id` | string | Unique tab identifier |
| `moduleId` | string | Owning module |
| `label` | string | Display text |
| `icon` | string | Lucide icon name |
| `nodeTypes` | `'*'` or `string[]` | Which types show this tab |
| `order` | number | Position in tab bar (lower = earlier) |
| `component` | React component | The tab content |
| `isVisible` | function? | Dynamic visibility check |

---

## Node Widget Registry

Add widgets to the Overview tab.

```typescript
import { nodeWidgetRegistry } from '@/features/structure';

nodeWidgetRegistry.register({
  id: 'recent-activity',
  moduleId: 'activity',
  title: 'Recent Activity',
  nodeTypes: '*',
  order: 10,
  component: RecentActivityWidget,
});
```

**React Hook:**

```typescript
import { useNodeWidgetRegistry } from '@/features/structure';

function OverviewTab() {
  const widgets = useNodeWidgetRegistry();
}
```

---

## Node Card Extension Registry

Add badges or actions to node cards in list views.

```typescript
import { nodeCardExtensionRegistry } from '@/features/structure';

nodeCardExtensionRegistry.register({
  id: 'task-count',
  moduleId: 'tasks',
  type: 'badge',
  nodeTypes: '*',
  order: 10,
  component: TaskCountBadge,
});
```

**Extension Positions:**

| Position | shadcn Part | Description |
|----------|-------------|-------------|
| `badge` | CardAction | Small badge inline near title |
| `action` | CardAction (dropdown) | Action in the card dropdown menu |
| `header` | After CardHeader | Content zone after the header |
| `content` | CardContent | Content zone in the card body |
| `footer` | CardFooter | Content in the card footer area |

The card uses the full shadcn Card API (`CardHeader`, `CardTitle`, `CardDescription`, `CardAction`, `CardContent`, `CardFooter`). Admins can enable/disable and reassign extension slots per node type via the Templates tab.

**React Hook:**

```typescript
import { useNodeCardExtensionRegistry } from '@/features/structure';

function NodeCard({ node }) {
  const extensions = useNodeCardExtensionRegistry();
}
```

---

## Node Action Registry

Add action buttons and menu items to node detail pages, context menus, and bulk operation bars.

```typescript
import { nodeActionRegistry } from '@/features/structure';

nodeActionRegistry.register({
  id: 'export-pdf',
  moduleId: 'documents',
  label: 'Export as PDF',
  icon: 'FileDown',
  nodeTypes: ['project', 'client'],
  location: 'detail-header',     // 'detail-header' | 'context-menu' | 'bulk-action'
  variant: 'default',            // 'default' | 'destructive' | 'outline'
  order: 30,
  handler: async (node) => {
    await exportNodeAsPdf(node.id);
  },
  // Optional: bulk handler for multi-select operations
  // bulkHandler: async (nodes) => { ... },
  // Optional: confirmation dialog
  // confirm: { title: 'Export PDF?', description: 'This may take a moment.' },
  // Optional: keyboard shortcut
  // shortcut: 'ctrl+shift+e',
});
```

**React Hook:**

```typescript
import { useNodeActions } from '@/features/structure';

function NodeDetailHeader({ node, nodeType }) {
  const actions = useNodeActions(node, nodeType);
  // Returns actions filtered for this node type with admin overrides applied
}
```

### Action Configuration

| Property | Type | Description |
|----------|------|-------------|
| `id` | string | Unique action identifier |
| `moduleId` | string | Owning module |
| `label` | string | Display text |
| `icon` | string | Lucide icon name |
| `nodeTypes` | `'*'` or `string[]` | Which types show this action |
| `location` | string | Where the action appears (`detail-header`, `context-menu`, `bulk-action`) |
| `variant` | string | Button variant (`default`, `destructive`, `outline`) |
| `order` | number | Position in action list |
| `handler` | function | Action handler receiving the node |
| `bulkHandler` | function? | Handler for bulk operations (receives array of nodes) |
| `confirm` | object? | Confirmation dialog config (`title`, `description`, `confirmLabel`, `cancelLabel`) |
| `shortcut` | string? | Keyboard shortcut (e.g., `ctrl+shift+e`) |
| `isVisible` | function? | Dynamic visibility check |

<Aside type="note" title="Actions vs Starter actionRegistry">
Structure's `nodeActionRegistry` stores **UI buttons and menu items** (React components on node pages). The starter template's `actionRegistry` stores **backend event hooks** (side-effect functions like `structure.node.created`). They serve different purposes and both are used.
</Aside>

---

## Node Field Type Registry

Register custom field types that extend the built-in field editor and display system. Structure includes 13 built-in types (text, textarea, number, date, datetime, select, multiselect, toggle, url, email, secret, node-reference, media) via the `field-types.registration.ts` file.

```typescript
import { nodeFieldTypeRegistry } from '@/features/structure';
import { RichTextEditor, RichTextDisplay } from '../components/RichTextEditor';

nodeFieldTypeRegistry.register({
  id: 'rich-text',
  moduleId: 'editor',
  label: 'Rich Text',
  category: 'content',
  icon: 'Type',
  nodeTypes: '*',
  order: 50,
  component: RichTextEditor,         // Edit mode component
  displayComponent: RichTextDisplay,  // Read-only display component
  // Optional: validation function
  // validate: (value, field) => value ? null : 'Required',
  // Optional: transform before saving
  // transformBeforeSave: (value) => sanitizeHtml(value),
  // Optional: config schema for admin
  // configSchema: { toolbar: { type: 'multiselect', options: ['bold', 'italic', 'link'] } },
});
```

**React Hook:**

```typescript
import { useNodeFieldTypes } from '@/features/structure';

// Not commonly needed - NodeFieldRenderer handles lookup automatically
const fieldTypes = useNodeFieldTypes();
```

The `NodeFieldRenderer` component automatically checks the field type registry before falling back to built-in types. If your module registers a custom field type, it will be used wherever that field type is assigned to a node type's fields.

### Field Type Configuration

| Property | Type | Description |
|----------|------|-------------|
| `id` | string | Unique type identifier (used in field config `type` property) |
| `moduleId` | string | Owning module |
| `label` | string | Display name in admin field type selector |
| `category` | string | Grouping category (`text`, `number`, `date`, `selection`, `media`, `reference`, `content`) |
| `icon` | string | Lucide icon name |
| `nodeTypes` | `'*'` or `string[]` | Which node types can use this field type |
| `component` | React component | Edit mode component (receives `FieldTypeRenderProps`) |
| `displayComponent` | React component? | Read-only display (receives `FieldTypeDisplayProps`) |
| `validate` | function? | Validation function returning error string or null |
| `transformBeforeSave` | function? | Transform value before saving |
| `configSchema` | object? | Admin configuration schema for the field type |

---

## Node Column Registry

Register custom columns for the table view on list pages.

```typescript
import { nodeColumnRegistry } from '@/features/structure';

nodeColumnRegistry.register({
  id: 'task-count',
  moduleId: 'tasks',
  label: 'Tasks',
  nodeTypes: ['project'],
  order: 40,
  width: '100px',
  alignment: 'center',
  sortable: true,
  render: (node) => <span>{node.metadata?.taskCount ?? 0}</span>,
  // Optional: compact version for narrow viewports
  // renderCompact: (node) => <span>{node.metadata?.taskCount ?? 0}</span>,
  // Optional: prefetch data needed by this column
  // prefetch: async (nodes) => { ... },
});
```

**React Hook:**

```typescript
import { useNodeColumns } from '@/features/structure';

function TableView({ nodeType }) {
  const columns = useNodeColumns(nodeType);
  // Returns columns filtered for this node type, sorted by order
}
```

### Column Configuration

| Property | Type | Description |
|----------|------|-------------|
| `id` | string | Unique column identifier |
| `moduleId` | string | Owning module |
| `label` | string | Column header text |
| `nodeTypes` | `'*'` or `string[]` | Which types show this column |
| `order` | number | Position in column list |
| `width` | string? | CSS width (e.g., `'100px'`, `'20%'`) |
| `alignment` | string? | Text alignment (`left`, `center`, `right`) |
| `sortable` | boolean? | Whether the column supports sorting |
| `render` | function | Cell renderer (receives the node) |
| `renderCompact` | function? | Compact cell renderer for narrow viewports |
| `prefetch` | function? | Async function to prefetch data for a batch of nodes |

---

## Node Filter Registry

Register custom filter controls for list pages. Filters can operate client-side or server-side.

```typescript
import { nodeFilterRegistry } from '@/features/structure';
import { StatusFilterControl } from '../components/StatusFilter';

nodeFilterRegistry.register({
  id: 'task-status',
  moduleId: 'tasks',
  label: 'Task Status',
  icon: 'Filter',
  nodeTypes: ['project'],
  mode: 'client',               // 'client' | 'server'
  order: 30,
  component: StatusFilterControl,
  // Client-side: filter function runs in the browser
  filterFn: (node, filterValue) => {
    if (!filterValue) return true;
    return node.metadata?.taskStatus === filterValue;
  },
  // Server-side: convert filter value to query params
  // toQueryParams: (value) => ({ taskStatus: value }),
});
```

**React Hook:**

```typescript
import { useNodeFilters } from '@/features/structure';

function ListPage({ nodeType }) {
  const { filters, activeFilters, setFilter, clearFilters } = useNodeFilters(nodeType);
  // filters: registered filter controls for this type
  // activeFilters: current filter state
  // setFilter(filterId, value): update a filter
  // clearFilters(): reset all filters
}
```

### Filter Configuration

| Property | Type | Description |
|----------|------|-------------|
| `id` | string | Unique filter identifier |
| `moduleId` | string | Owning module |
| `label` | string | Filter control label |
| `icon` | string? | Lucide icon name |
| `nodeTypes` | `'*'` or `string[]` | Which types show this filter |
| `mode` | string | `'client'` (in-browser) or `'server'` (API query param) |
| `order` | number | Position in filter bar |
| `component` | React component | Filter control UI (receives `FilterRenderProps`) |
| `filterFn` | function? | Client-side filter function (required when `mode: 'client'`) |
| `toQueryParams` | function? | Convert value to API query params (required when `mode: 'server'`) |

<Aside type="note" title="Filters vs Starter filterRegistry">
Structure's `nodeFilterRegistry` stores **UI filter controls** (React components on list pages). The starter template's `filterRegistry` stores **backend data transformation pipelines** (like `structure.node.response`). They serve different purposes and both are used.
</Aside>

---

## Node Sidebar Section Registry

Add custom sections to the detail page sidebar (when using sidebar navigation style).

```typescript
import { nodeSidebarSectionRegistry } from '@/features/structure';
import { TaskSummarySection } from '../components/TaskSummarySection';

nodeSidebarSectionRegistry.register({
  id: 'task-summary',
  moduleId: 'tasks',
  label: 'Task Summary',
  icon: 'CheckSquare',
  nodeTypes: ['project'],
  order: 30,
  collapsible: true,
  defaultCollapsed: false,
  component: TaskSummarySection,
});
```

**React Hook:**

```typescript
import { useNodeSidebarSections } from '@/features/structure';

function DetailSidebar({ node, nodeType }) {
  const sections = useNodeSidebarSections(node, nodeType);
  // Returns sidebar sections filtered for this node type
}
```

### Sidebar Section Configuration

| Property | Type | Description |
|----------|------|-------------|
| `id` | string | Unique section identifier |
| `moduleId` | string | Owning module |
| `label` | string | Section heading text |
| `icon` | string? | Lucide icon name |
| `nodeTypes` | `'*'` or `string[]` | Which types show this section |
| `order` | number | Position in sidebar |
| `collapsible` | boolean? | Whether the section can be collapsed |
| `defaultCollapsed` | boolean? | Whether collapsed by default |
| `component` | React component | Section content (receives `NodeSidebarSectionProps`) |

---

## Labels Utility

Customise the UI text for each node type using the labels system. Each node type can define custom labels for common UI strings.

```typescript
import { getLabel } from '@/features/structure';

function CreateButton({ nodeType }: { nodeType: NodeTypeConfig }) {
  // Returns the custom label or auto-generates from the type name
  const label = getLabel(nodeType, 'addNew');
  // e.g., "Add Client" (auto-generated) or "Create New Matter" (custom label)

  return <Button>{label}</Button>;
}
```

The `getLabel()` function checks three sources in order:
1. **Custom label** — from `nodeType.labels.addNew` if defined
2. **Auto-generated** — creates a sensible default from the node type name (e.g., "Add Project")
3. **Fallback** — returns a generic default like "Add New"

### Available Label Keys

| Key | Default Pattern | Example (type: "Client") |
|-----|----------------|--------------------------|
| `addNew` | `Add {name}` | "Add Client" |
| `editItem` | `Edit {name}` | "Edit Client" |
| `deleteItem` | `Delete {name}` | "Delete Client" |
| `archiveAction` | `Archive {name}` | "Archive Client" |
| `restoreAction` | `Restore {name}` | "Restore Client" |
| `listTitle` | `{namePlural}` | "Clients" |
| `emptyState` | `No {namePlural} yet` | "No Clients yet" |
| `searchPlaceholder` | `Search {namePlural}...` | "Search Clients..." |
| `createFirst` | `Create your first {name}` | "Create your first Client" |
| `confirmDelete` | `Are you sure you want to delete this {name}?` | "Are you sure you want to delete this Client?" |

Labels are configured per node type in the admin panel or when registering a node type programmatically via the `labels` property on `NodeTypeConfig`.

---

## Registry Summary

| Registry | Purpose | Hook | Extends BaseRegistry |
|----------|---------|------|---------------------|
| `nodeTypeRegistry` | Node type configurations | `useEnabledNodeTypes()` | No (custom, DB-synced) |
| `nodeTabRegistry` | Tabs on detail pages | `useNodeTabRegistry()` | Yes |
| `nodeWidgetRegistry` | Widgets on Overview tab | `useNodeWidgetRegistry()` | Yes |
| `nodeCardExtensionRegistry` | Badges/actions on cards | `useNodeCardExtensionRegistry()` | Yes |
| `nodeActionRegistry` | Actions on nodes | `useNodeActions()` | Yes |
| `nodeFieldTypeRegistry` | Custom field types | — (auto via `NodeFieldRenderer`) | Yes |
| `nodeColumnRegistry` | Table view columns | `useNodeColumns()` | Yes |
| `nodeFilterRegistry` | List page filter controls | `useNodeFilters()` | Yes |
| `nodeSidebarSectionRegistry` | Detail page sidebar sections | `useNodeSidebarSections()` | Yes |

---

## Registrations

The Structure module uses the starter template's registration system for integration. Each registration file is a side-effect import that runs on module load.

| Registration | Description |
|-------------|-------------|
| `tabs.registration.ts` | Registers built-in tabs (Overview, Info, Children, Connections, Settings) |
| `navigation.registration.ts` | Auto-registers sidebar items from enabled node types |
| `routes.registration.ts` | Registers dynamic routes with the route registry |
| `header-toolbar.registration.ts` | Adds QuickCreateDropdown to the header toolbar |
| `default-types.registration.ts` | Registers default node types from installer prompts |
| `field-types.registration.ts` | Registers 13 built-in field types (text, textarea, number, date, etc.) |
| `admin-pages.registration.ts` | Registers the App Structure admin page |

<Aside type="tip">
Registration imports must come **first** in the barrel `index.ts` file as side-effect imports, before any public exports. This ensures registries are populated before any component tries to read from them.
</Aside>

---

## Backend Hooks (Filter & Action Registries)

Structure registers filter and action hooks that other modules can subscribe to. These use the starter template's `filterRegistry` and `actionRegistry` — not Structure-specific registries.

### Filter Hooks

Filters transform data in a pipeline. Each filter receives the output of the previous one.

| Hook | Receives | Purpose |
|------|----------|---------|
| `structure.node.beforeCreate` | Node input data | Transform data before a node is saved |
| `structure.node.response` | Node object | Enrich node data before sending to client |
| `structure.node.listQuery` | Query parameters | Modify list query before execution |
| `structure.nodeType.response` | Node type object | Transform node type data before sending to client |

```typescript
import { filterRegistry } from '../../config/filter.registry.js';

// Enrich node responses with your module's data
filterRegistry.register(
  'structure.node.response',
  'my-module-enrich',
  (node, context) => {
    return { ...node, metadata: { ...node.metadata, myData: true } };
  },
  20
);
```

### Action Hooks

Actions fire side effects. They don't return values (fire-and-forget pattern).

| Hook | Context | Fires when |
|------|---------|------------|
| `structure.node.created` | `{ userId, node, nodeType }` | Node created |
| `structure.node.updated` | `{ userId, node, changes }` | Node updated |
| `structure.node.deleted` | `{ userId, nodeId, nodeType }` | Node deleted |
| `structure.node.moved` | `{ userId, node, oldParentId, newParentId }` | Node moved |
| `structure.node.archived` | `{ userId, node }` | Node archived |
| `structure.node.restored` | `{ userId, node }` | Node restored |
| `structure.node.favorited` | `{ userId, node, isFavorite }` | Favourite toggled |
| `structure.connection.created` | `{ userId, connection }` | Connection created |
| `structure.connection.deleted` | `{ userId, connectionId }` | Connection deleted |
| `structure.nodeType.created` | `{ userId, nodeType }` | Node type created |
| `structure.nodeType.updated` | `{ userId, slug, changes }` | Node type updated |
| `structure.nodeType.deleted` | `{ userId, slug }` | Node type deleted |

```typescript
import { actionRegistry } from '../../config/action.registry.js';

// Clean up when a node is deleted
actionRegistry.addActionAsync(
  'structure.node.deleted',
  'my-module-cleanup',
  async (context) => {
    await myService.handleNodeDeleted(context.nodeId, context.userId);
  },
  20
);
```

<Aside type="tip">
For a complete guide on how other modules integrate with Structure — including tabs, widgets, service access, and event hooks — see the [Module Integration](/modules/structure/integration/) page.
</Aside>

---

## Next Steps

- [Module Integration](/modules/structure/integration/) - How other modules integrate with Structure
- [Components & Hooks](/modules/structure/components/) - Full component and hook reference
- [Database & API](/modules/structure/database/) - Schema and endpoint reference
- [Registry Reference](/starter-template/registries/) - Full BaseRegistry API docs
