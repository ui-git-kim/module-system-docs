---
title: Registries
description: Extending nodes with tabs, widgets, card extensions, and the node type registry
---

import { Aside } from '@astrojs/starlight/components';

Structure provides four registries for managing and extending node functionality.

<Aside type="tip">
The tab, widget, and card extension registries all extend `BaseRegistry` from `@/config/base.registry`. This gives them standard methods like `register()`, `unregister()`, `get()`, `getAll()`, and automatic React hooks. The node type registry is custom because it syncs from the database.
</Aside>

---

## Node Type Registry

The `NodeTypeRegistry` is a **custom registry** that syncs configuration from the database rather than relying solely on in-memory registration. It does not extend `BaseRegistry` because it needs database synchronisation support.

### Methods

| Method | Description |
|--------|-------------|
| `register(config)` | Register a node type configuration |
| `get(slug)` | Get config for a specific type |
| `getAll()` | Get all registered types |
| `getEnabledTypes()` | Get all types sorted by sortOrder |
| `syncFromDatabase(types)` | Update registry from database response |
| `onSync(callback)` | Subscribe to sync events (returns unsubscribe function) |

### Reactive Hooks

```typescript
import { useEnabledNodeTypes } from '@/features/structure';

function TypeList() {
  // Re-renders when types sync from database
  const types = useEnabledNodeTypes();
}
```

```typescript
import { useStructureNavItems } from '@/features/structure';

function Sidebar() {
  // Re-renders when types change
  const navItems = useStructureNavItems();
}
```

<Aside type="note" title="Reactivity">
The `useEnabledNodeTypes` and `useStructureNavItems` hooks subscribe to the registry's `onSync` event internally. They automatically re-render when node types are updated from the database, ensuring the UI stays in sync. The `onSync` method returns an unsubscribe function for proper cleanup.
</Aside>

---

## Node Tab Registry

Add tabs to node detail pages.

```typescript
import { nodeTabRegistry } from '@/features/structure';

nodeTabRegistry.register({
  id: 'documents',
  moduleId: 'documents',
  label: 'Documents',
  icon: 'FileText',
  nodeTypes: ['client', 'matter'],
  order: 30,
  component: DocumentsTab,
});
```

**React Hook:**

```typescript
import { useNodeTabRegistry } from '@/features/structure';

function TabBar() {
  const allTabs = useNodeTabRegistry();
}
```

**Filtered for a Node:**

```typescript
const tabsForThisNode = nodeTabRegistry.getTabsForNodeType(
  nodeType.slug,
  node,
  nodeTypeConfig
);
```

### Tab Configuration

| Property | Type | Description |
|----------|------|-------------|
| `id` | string | Unique tab identifier |
| `moduleId` | string | Owning module |
| `label` | string | Display text |
| `icon` | string | Lucide icon name |
| `nodeTypes` | `'*'` or `string[]` | Which types show this tab |
| `order` | number | Position in tab bar (lower = earlier) |
| `component` | React component | The tab content |
| `isVisible` | function? | Dynamic visibility check |

---

## Node Widget Registry

Add widgets to the Overview tab.

```typescript
import { nodeWidgetRegistry } from '@/features/structure';

nodeWidgetRegistry.register({
  id: 'recent-activity',
  moduleId: 'activity',
  title: 'Recent Activity',
  nodeTypes: '*',
  order: 10,
  component: RecentActivityWidget,
});
```

**React Hook:**

```typescript
import { useNodeWidgetRegistry } from '@/features/structure';

function OverviewTab() {
  const widgets = useNodeWidgetRegistry();
}
```

---

## Node Card Extension Registry

Add badges or actions to node cards in list views.

```typescript
import { nodeCardExtensionRegistry } from '@/features/structure';

nodeCardExtensionRegistry.register({
  id: 'task-count',
  moduleId: 'tasks',
  type: 'badge',
  nodeTypes: '*',
  order: 10,
  component: TaskCountBadge,
});
```

**Extension Types:**

| Type | Description |
|------|-------------|
| `badge` | Small badge overlay on the card |
| `action` | Action button on the card |
| `footer` | Content in the card footer area |

**React Hook:**

```typescript
import { useNodeCardExtensionRegistry } from '@/features/structure';

function NodeCard({ node }) {
  const extensions = useNodeCardExtensionRegistry();
}
```

---

## Registry Summary

| Registry | Purpose | Hook | Extends BaseRegistry |
|----------|---------|------|---------------------|
| `nodeTypeRegistry` | Node type configurations | `useEnabledNodeTypes()` | No (custom, DB-synced) |
| `nodeTabRegistry` | Tabs on detail pages | `useNodeTabRegistry()` | Yes |
| `nodeWidgetRegistry` | Widgets on Overview tab | `useNodeWidgetRegistry()` | Yes |
| `nodeCardExtensionRegistry` | Badges/actions on cards | `useNodeCardExtensionRegistry()` | Yes |

---

## Registrations

The Structure module uses the starter template's registration system for integration. Each registration file is a side-effect import that runs on module load.

| Registration | Description |
|-------------|-------------|
| `tabs.registration.ts` | Registers built-in tabs (Overview, Info, Children, Connections, Settings) |
| `navigation.registration.ts` | Auto-registers sidebar items from enabled node types |
| `routes.registration.ts` | Registers dynamic routes with the route registry |
| `header-toolbar.registration.ts` | Adds QuickCreateDropdown to the header toolbar |
| `default-types.registration.ts` | Registers default node types from installer prompts |
| `admin-pages.registration.ts` | Registers the App Structure admin page |

<Aside type="tip">
Registration imports must come **first** in the barrel `index.ts` file as side-effect imports, before any public exports. This ensures registries are populated before any component tries to read from them.
</Aside>

---

## Backend Hooks (Filter & Action Registries)

Structure registers filter and action hooks that other modules can subscribe to. These use the starter template's `filterRegistry` and `actionRegistry` — not Structure-specific registries.

### Filter Hooks

Filters transform data in a pipeline. Each filter receives the output of the previous one.

| Hook | Receives | Purpose |
|------|----------|---------|
| `structure.node.beforeCreate` | Node input data | Transform data before a node is saved |
| `structure.node.response` | Node object | Enrich node data before sending to client |
| `structure.node.listQuery` | Query parameters | Modify list query before execution |
| `structure.nodeType.response` | Node type object | Transform node type data before sending to client |

```typescript
import { filterRegistry } from '../../config/filter.registry.js';

// Enrich node responses with your module's data
filterRegistry.register(
  'structure.node.response',
  'my-module-enrich',
  (node, context) => {
    return { ...node, metadata: { ...node.metadata, myData: true } };
  },
  20
);
```

### Action Hooks

Actions fire side effects. They don't return values (fire-and-forget pattern).

| Hook | Context | Fires when |
|------|---------|------------|
| `structure.node.created` | `{ userId, node, nodeType }` | Node created |
| `structure.node.updated` | `{ userId, node, changes }` | Node updated |
| `structure.node.deleted` | `{ userId, nodeId, nodeType }` | Node deleted |
| `structure.node.moved` | `{ userId, node, oldParentId, newParentId }` | Node moved |
| `structure.node.archived` | `{ userId, node }` | Node archived |
| `structure.node.restored` | `{ userId, node }` | Node restored |
| `structure.node.favorited` | `{ userId, node, isFavorite }` | Favourite toggled |
| `structure.connection.created` | `{ userId, connection }` | Connection created |
| `structure.connection.deleted` | `{ userId, connectionId }` | Connection deleted |
| `structure.nodeType.created` | `{ userId, nodeType }` | Node type created |
| `structure.nodeType.updated` | `{ userId, slug, changes }` | Node type updated |
| `structure.nodeType.deleted` | `{ userId, slug }` | Node type deleted |

```typescript
import { actionRegistry } from '../../config/action.registry.js';

// Clean up when a node is deleted
actionRegistry.addActionAsync(
  'structure.node.deleted',
  'my-module-cleanup',
  async (context) => {
    await myService.handleNodeDeleted(context.nodeId, context.userId);
  },
  20
);
```

<Aside type="tip">
For a complete guide on how other modules integrate with Structure — including tabs, widgets, service access, and event hooks — see the [Module Integration](/modules/structure/integration/) page.
</Aside>

---

## Next Steps

- [Module Integration](/modules/structure/integration/) - How other modules integrate with Structure
- [Components & Hooks](/modules/structure/components/) - Full component and hook reference
- [Database & API](/modules/structure/database/) - Schema and endpoint reference
- [Registry Reference](/starter-template/registries/) - Full BaseRegistry API docs
