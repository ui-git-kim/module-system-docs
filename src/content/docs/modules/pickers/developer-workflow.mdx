---
title: Developer Workflow
description: How to develop, test, version, and maintain the Pickers module
sidebar:
  order: 4
---

import { Aside, Steps, Tabs, TabItem } from '@astrojs/starlight/components';

This page covers the full developer workflow for working on the Pickers module — from local setup through to versioning, scaffold updates, and documentation.

---

## Setup

<Steps>
1. **Clone the repository**
   ```bash
   git clone <pickers-repo-url>
   cd pickers
   ```

2. **Install dependencies**
   ```bash
   npm install
   ```

3. **Build the module**
   ```bash
   npm run build
   ```

4. **Link for local testing**
   ```bash
   npm link
   ```
   This makes the `pickers` CLI command available globally for testing in a starter template app.
</Steps>

---

## Development Loop

The core development workflow is: **edit templates, build, test in a target app**.

```
Edit src/templates/  →  npm run build  →  npx pickers init (in test app)  →  Verify
```

### Watch Mode

For faster iteration, use watch mode to rebuild automatically when templates change:

```bash
npm run dev
```

### Testing in a Target App

In a separate terminal, navigate to a starter template app and run:

```bash
# First-time installation
npx pickers init

# Force overwrite existing files
npx pickers init --force

# Update existing installation (preserves user changes)
npx pickers update

# Preview update without writing files
npx pickers update --dry-run

# View module metadata
npx pickers info
```

<Aside type="tip">
  Use `npx pickers update --dry-run` to preview what files would change before applying an update. This is especially useful when developing to verify your changes are detected.
</Aside>

### Type Checking

Run TypeScript type checking without emitting files:

```bash
npm run type-check
```

---

## Version Management

**You must bump the version after ANY change to templates or `module.ts`.** This is how the system detects updates and generates version headers in output files.

### When to Bump

| Change Type | Command | Example |
|-------------|---------|---------|
| Bug fix, typo, minor adjustment | `npm run version:patch` | Fix a CSS class, correct a type |
| New feature, enhancement | `npm run version:minor` | Add a new picker prop, new admin feature |
| Breaking change | `npm run version:major` | Rename component, change props interface |

### Version Commands

```bash
# Version bump only (creates a commit)
npm run version:patch    # 1.2.3 → 1.2.4
npm run version:minor    # 1.2.3 → 1.3.0
npm run version:major    # 1.2.3 → 2.0.0

# Tagged release (creates a commit + git tag + pushes tags)
npm run release:patch
npm run release:minor
npm run release:major
```

### Why Bumping Matters

- **Version headers** — Every generated file includes a version comment. Target apps compare these to detect outdated files.
- **Update detection** — `npx pickers update` uses version and file hash comparison to determine what needs updating.
- **Changelog tracking** — Semantic versioning communicates the nature of changes to consumers.

<Aside type="caution">
  Forgetting to bump the version is one of the most common mistakes. If you modify templates and don't bump, target apps will not detect the update.
</Aside>

---

## Scaffold Updates

The Pickers module was cloned from the **module starter template**, which provides shared scaffold infrastructure (CLI, init, update, uninstall logic). Periodically, improvements are made upstream to the scaffold.

### Checking for Updates

```bash
npm run scaffold:check
```

This previews what scaffold files have changed upstream without modifying anything.

### Applying Updates

```bash
npm run scaffold:update
```

This merges upstream scaffold improvements into your local copy.

### What Gets Updated

| Updated | NOT Updated |
|---------|-------------|
| `src/scaffold/` files | `src/templates/` (your code) |
| `src/cli.ts` | `src/module.ts` (your config) |
| Build scripts | `CLAUDE.md` custom sections |
| CLAUDE.md scaffold sections | Your customisations |

### Handling Merge Conflicts

If `scaffold:update` encounters conflicts (rare, since it only touches scaffold files), resolve them manually and commit:

```bash
npm run scaffold:update
# If conflicts occur:
# 1. Open conflicted files
# 2. Resolve conflicts
# 3. git add . && git commit -m "fix: resolve scaffold merge conflicts"
```

---

## Common Development Scenarios

### Adding a New Frontend Component

<Steps>
1. Create the template file in `src/templates/frontend/`:
   ```typescript
   // src/templates/frontend/my-new-component.ts
   export const MY_NEW_COMPONENT_TEMPLATE = `// ========================================================================
   // FILE: frontend/src/features/my-feature/components/MyNewComponent.tsx
   // PURPOSE: Description of the component
   // ========================================================================

   // Component code using my-feature / MyFeature placeholders...
   `;
   ```

2. Export it from `src/templates/frontend/index.ts`:
   ```typescript
   export { MY_NEW_COMPONENT_TEMPLATE } from './my-new-component.js';
   ```

3. Register it in `src/module.ts` under `frontend.templates`:
   ```typescript
   'components/MyNewComponent.tsx': frontend.MY_NEW_COMPONENT_TEMPLATE,
   ```

4. Export the component from the barrel file template (`INDEX_TEMPLATE` in `routes.ts`):
   ```typescript
   export { MyNewComponent } from './components/MyNewComponent';
   ```

5. Bump the version:
   ```bash
   npm run version:patch
   ```
</Steps>

### Adding a New Backend Endpoint

<Steps>
1. Add the route handler to the routes template in `src/templates/backend/routes.ts`

2. Add the service method to the service template in `src/templates/backend/services.ts`

3. Add any new types to `src/templates/backend/types.ts`

4. Bump the version:
   ```bash
   npm run version:patch
   ```
</Steps>

### Adding a New Database Table

<Steps>
1. Edit `src/templates/schema.ts` to add the new model:
   ```prisma
   model my_feature_new_table {
     id        String   @id @default(cuid())
     // fields...
     createdAt DateTime @default(now())
     updatedAt DateTime @updatedAt

     @@index([...])
   }
   ```

2. Add the model name to `schema.modelNames` in `src/module.ts`:
   ```typescript
   schema: {
     content: SCHEMA,
     modelNames: ['pickers_profile', 'pickers_new_table'],
   },
   ```

3. Bump the version:
   ```bash
   npm run version:minor
   ```
</Steps>

<Aside type="note">
  Module schemas must be self-contained. Use plain foreign key fields with `@@index`, never `@relation` directives.
</Aside>

### Adding a New Registry Registration

<Steps>
1. Create the registration template in `src/templates/frontend/registrations.ts` (or `backend/registrations.ts`)

2. Add a side-effect import in the barrel file template (`INDEX_TEMPLATE`)

3. Register the file in `src/module.ts` under the appropriate `templates` section

4. Bump the version:
   ```bash
   npm run version:patch
   ```
</Steps>

### Adding a New Environment Variable

<Steps>
1. Document the variable in the module's configuration docs

2. If applicable, add it to the `.env.example` template generation (via `module.ts` env config)

3. Reference it in your backend templates using `process.env.VARIABLE_NAME`

4. Bump the version:
   ```bash
   npm run version:minor
   ```
</Steps>

### Adding a Prompt Variable

Add a prompt to the `prompts` array in `src/module.ts`:

```typescript
prompts: [
  {
    name: 'apiProvider',
    message: 'Which API provider do you want to use?',
    type: 'select',
    choices: ['openai', 'anthropic', 'google'],
    default: 'openai',
  },
],
```

Then reference the variable in templates using `{{apiProvider}}` or with a default: `{{apiProvider|openai}}`.

### Adding Lifecycle Hooks

Add `onInstall`, `onUpdate`, or `onUninstall` callbacks in `src/module.ts`:

```typescript
lifecycle: {
  onInstall: async (context) => {
    console.log('Pickers module installed!');
  },
  onUpdate: async (context) => {
    console.log('Pickers module updated!');
  },
  onUninstall: async (context) => {
    console.log('Pickers module uninstalled!');
  },
},
```

### Adding Module Dependencies

If your module depends on another module, declare it in `src/module.ts`:

```typescript
dependencies: ['other-module'],
```

The scaffold will check for the dependency during installation.

---

## Debugging & Troubleshooting

### Inspecting Generated Output

After running `npx pickers init` in a target app, check the generated files:

```bash
# Frontend
ls frontend/src/features/pickers/

# Backend
ls backend/src/features/pickers/

# Schema additions
cat backend/prisma/schema.prisma | grep -A 20 "pickers"
```

### Common Template Placeholder Mistakes

| Mistake | Fix |
|---------|-----|
| Using `Pickers` instead of `MyFeature` in component names | Templates must use `MyFeature` (PascalCase placeholder) |
| Using `pickers` instead of `my-feature` in paths | Templates must use `my-feature` (kebab-case placeholder) |
| Using `pickers` instead of `myFeature` in variable names | Templates must use `myFeature` (camelCase placeholder) |
| Using `pickers_` instead of `my_feature_` in schema models | Templates must use `my_feature_` (snake_case placeholder) |

The scaffold replaces these patterns during installation:

| Placeholder | Replaced With |
|-------------|--------------|
| `my-feature` | `pickers` |
| `myFeature` | `pickers` |
| `MyFeature` | `Pickers` |
| `my_feature` | `pickers` |

### Build Errors

```bash
npm run build
```

Common issues:
- **Missing export** — Check `src/templates/frontend/index.ts` and `src/templates/backend/index.ts` export all templates
- **TypeScript error in template string** — Remember templates are strings, not actual TypeScript. Escaped backticks and `$` need care.
- **Import not found** — Ensure new template files use `.js` extensions in their exports

### Update Not Detecting Changes

If `npx pickers update` doesn't detect your changes:

1. **Check version** — Did you bump? Run `npx pickers info` to see the current version.
2. **Check file hashes** — The update system compares file content hashes. If content hasn't actually changed, it won't update.
3. **Force reinstall** — Use `npx pickers init --force` to overwrite everything.

### Backend Import Extensions

All relative imports in backend templates **must** use `.js` extensions:

```typescript
// Correct
import { prisma } from '../../lib/prisma.js';
import { myFeatureService } from './my-feature.service.js';

// Wrong — will fail at runtime
import { prisma } from '../../lib/prisma';
import { myFeatureService } from './my-feature.service';
```

---

## Documentation Workflow

The `docs/` directory is a git submodule pointing to the shared documentation site.

### Editing Docs

1. Edit `.mdx` files under `docs/src/content/docs/modules/pickers/`
2. If adding a new page, register it in `docs/astro.config.mjs` under the sidebar config

### Push Workflow

Documentation changes must be pushed separately:

```bash
# 1. Push docs submodule
cd docs
git add .
git commit -m "Docs: update pickers documentation"
git push
cd ..

# 2. Update submodule reference in parent repo
git add docs
git commit -m "docs: update docs submodule"
git push
```

<Aside type="note">
  Documentation deploys automatically via GitHub Actions when pushed to the docs repository.
</Aside>

---

## Project Structure Reference

```
src/
├── module.ts                    # Module configuration
├── cli.ts                       # CLI entry point (DO NOT EDIT)
├── scaffold/                    # Scaffold infrastructure (DO NOT EDIT)
└── templates/
    ├── schema.ts                # Prisma schema template
    ├── frontend/
    │   ├── index.ts             # Frontend template exports
    │   ├── routes.ts            # Barrel file + route config
    │   ├── pages.ts             # Showcase + admin page
    │   ├── registrations.ts     # Navigation + admin registrations
    │   ├── color-picker.ts      # ColorPicker component
    │   ├── icon-picker.ts       # IconPicker component
    │   ├── date-picker.ts       # DatePicker component
    │   ├── date-range-picker.ts # DateRangePicker component
    │   ├── time-picker.ts       # TimePicker component
    │   ├── timezone-picker.ts   # TimezonePicker component
    │   ├── image-picker.ts      # ImagePicker component
    │   ├── emoji-picker.ts      # EmojiPicker component
    │   ├── font-picker.ts       # FontPicker component
    │   ├── avatar-picker.ts     # AvatarPicker component
    │   ├── hooks.ts             # useColorPicker, useIconPicker, usePickerProfile
    │   ├── lib.ts               # Colour utility functions
    │   ├── data.ts              # Emoji, timezone, font, icon tag data
    │   ├── services.ts          # Frontend API service
    │   ├── types.ts             # TypeScript types
    │   └── admin.ts             # Admin page component
    └── backend/
        ├── index.ts             # Backend template exports
        ├── routes.ts            # Barrel file + API routes
        ├── services.ts          # Business logic service
        ├── registrations.ts     # Route, service, filter, action registrations
        └── types.ts             # Backend types
```

---

## Next Steps

- [Configuration](/modules/pickers/configuration/) — Profile settings and defaults
- [Integration](/modules/pickers/integration/) — Cross-module usage
- [Changelog](/modules/pickers/changelog/) — Version history
