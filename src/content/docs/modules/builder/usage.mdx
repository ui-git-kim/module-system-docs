---
title: Usage
description: How to use the Block Builder — pages, components, hooks, and API endpoints
sidebar:
  order: 2
---

import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

This page covers how to use the Block Builder after installation — the pages you get, the hooks available to your code, and the full API reference.

---

## Pages

The builder generates three frontend pages:

### Builder Page (`/builder`)

The main visual builder. It provides a full-screen layout with:

- **Component Panel** (left sidebar) — drag components from the palette onto the canvas
- **Preview Panel** (top centre) — live render of your block using pristine shadcn components
- **Canvas Panel** (bottom centre) — the block tree editor with drag-and-drop reordering
- **Property Panel** (right sidebar) — edit the selected node's properties

All panels are resizable. The layout auto-collapses the app sidebar to maximise canvas space.

**URL parameters:**

| Parameter | Description |
|-----------|-------------|
| `?blockId=xxx` | Load an existing block for editing |
| `?projectId=xxx` | Pre-select a project scope for saving |

### Blocks Library Page (`/blocks`)

Browse, search, and manage all your saved blocks:

- Grid and list view toggle
- Filter by scope: project-scoped, global, or system blocks
- Search by name
- Actions: open in builder, duplicate, delete
- Category-based organisation

### Admin Components Page

Accessed via **Admin > Components** (admin role only). Full CRUD interface for managing native component definitions in the `native_component` table.

---

## Frontend Components

### Canvas Components

| Component | File | Purpose |
|-----------|------|---------|
| `CanvasPanel` | `components/canvas/BuilderCanvas.tsx` | The block tree editor with drag-and-drop support |
| `BlockRenderer` | `components/canvas/BlockRenderer.tsx` | Renders individual nodes in the canvas tree |

### Panel Components

| Component | File | Purpose |
|-----------|------|---------|
| `ComponentPanel` | `components/panels/ComponentPanel.tsx` | Draggable component palette sidebar |
| `PropertyPanel` | `components/panels/PropertyPanel.tsx` | Property editor for the selected node |
| `PreviewPanel` | `components/panels/PreviewPanel.tsx` | Live preview with responsive device switching |
| `TreePanel` | `components/panels/TreePanel.tsx` | Block tree outline view |

### Toolbar Components

| Component | File | Purpose |
|-----------|------|---------|
| `BuilderToolbar` | `components/toolbar/BuilderToolbar.tsx` | Canvas toolbar actions |

### Shared Components

| Component | File | Purpose |
|-----------|------|---------|
| `IconPicker` | `components/shared/IconPicker.tsx` | Lucide icon selector for properties |
| `CodePreview` | `components/shared/CodePreview.tsx` | Generated code viewer |
| `SaveBlockDialog` | `components/shared/SaveBlockDialog.tsx` | Save/update block dialog with name, scope, and category |

### Structure Integration Components

| Component | File | Purpose |
|-----------|------|---------|
| `ProjectBlocksTab` | `components/structure/ProjectBlocksTab.tsx` | Blocks tab for project node detail pages |
| `ProjectBlocksWidget` | `components/structure/ProjectBlocksWidget.tsx` | Blocks summary widget for project overview |
| `ProjectRegistryTab` | `components/structure/ProjectRegistryTab.tsx` | Registry config tab showing `components.json` snippet |
| `ProjectBlocksBadge` | `components/structure/ProjectBlocksBadge.tsx` | Block count badge on project cards |

### Dashboard Widget

| Component | File | Purpose |
|-----------|------|---------|
| `BuilderWidget` | `components/widgets/BuilderWidget.tsx` | Dashboard quick-access widget |

---

## Hooks

### `useBuilder`

Main builder state management hook. Call this to manage the block tree, selection, and editing operations.

```typescript
import { useBuilder } from '@/features/builder/hooks/useBuilder';

const {
  block,           // Current root NodeInstance
  selectedId,      // ID of the currently selected node
  setBlock,        // Replace the entire block tree
  setSelectedId,   // Select a node by ID
  updateNodeProps, // Update properties on a specific node
  removeNodeById,  // Remove a node from the tree
  resetBlock,      // Reset to a fresh default block
} = useBuilder(initialBlock?);
```

### `useBlockTree`

Low-level tree manipulation utilities. Used internally by `useBuilder`, but available for custom integrations:

```typescript
import {
  generateId,          // Generate a random node ID
  createNodeFromType,  // Create a new node with defaults from registry
  findNode,            // Find a node by ID in the tree
  findParent,          // Find a node's parent
  cloneTree,           // Deep clone a block tree (immutable updates)
  updateNode,          // Update a node's properties in-place
  removeNode,          // Remove a node from the tree
  insertNode,          // Insert a node at a position
  moveNode,            // Move a node to a new position
} from '@/features/builder/hooks/useBlockTree';
```

### `useCodeGeneration`

Generates React component code from a block tree. Requires `NativeComponentsProvider` context.

```typescript
import { useCodeGeneration } from '@/features/builder/hooks/useCodeGeneration';

// Inside a component wrapped by NativeComponentsProvider
const generatedCode = useCodeGeneration(block);
// Returns: string (the generated .tsx source code)
```

### `useNativeComponents`

Provides the component registry context. Wrap your builder UI with `NativeComponentsProvider` to access it.

```typescript
import {
  NativeComponentsProvider,
  useComponentRegistry,
} from '@/features/builder/hooks/useNativeComponents';

// In your component tree
<NativeComponentsProvider>
  <YourBuilderUI />
</NativeComponentsProvider>

// Inside child components
const {
  registry,         // ComponentRegistry (type -> ComponentDefinition)
  loading,          // boolean
  error,            // string | null
  sharedOptions,    // SharedOptionsMap
  sharedFields,     // SharedFieldsMap
  projectNodeType,  // string | null (slug of project node type)
} = useComponentRegistry();
```

### `useProjectBlocks`

Fetches and manages blocks scoped to a specific project.

```typescript
import { useProjectBlocks } from '@/features/builder/hooks/useProjectBlocks';

const {
  blocks,     // BlockData[]
  loading,    // boolean
  error,      // string | null
  refresh,    // () => void
  deleteBlock // (id: string) => Promise<void>
} = useProjectBlocks(projectId);
```

### `useBlocksLibrary`

Powers the Blocks Library page — fetching, filtering, and searching blocks across all scopes.

```typescript
import { useBlocksLibrary } from '@/features/builder/hooks/useBlocksLibrary';
```

### `useNativeComponentsAdmin`

Admin-only hook for managing native component definitions.

```typescript
import { useNativeComponentsAdmin } from '@/features/builder/hooks/useNativeComponentsAdmin';
```

---

## Types

The core types are defined in `features/builder/types/index.ts`:

```typescript
// What category a component belongs to
type ComponentCategory = 'container' | 'element' | 'child' | 'primitive' | 'layout';

// Source library
type ComponentLibrary = 'shadcn' | 'primitive' | 'plate' | 'custom';

// A property definition on a component
interface PropertyDefinition {
  key: string;
  label: string;
  type: 'string' | 'number' | 'boolean' | 'select' | 'icon' | 'textarea' | 'id' | 'className';
  default?: unknown;
  options?: PropertyOption[];
  description?: string;
  placeholder?: string;
  richText?: boolean;
  classNameKey?: string;
  unique?: boolean;
  invertValue?: boolean;
}

// A component in the registry
interface ComponentDefinition {
  type: string;
  library?: ComponentLibrary;
  label: string;
  description?: string;
  category: ComponentCategory;
  icon: LucideIcon;
  jsxTag?: string;
  importPath?: string;
  selfClosing?: boolean;
  isContainer?: boolean;
  acceptsAny?: boolean;
  parent?: string;
  properties: PropertyDefinition[];
  allowedChildren?: string[];
  defaultChildren?: Array<string | DefaultChildConfig>;
  defaultConfig?: Record<string, unknown>;
  codeStructure?: CodeStructureConfig;
  asChildBehavior?: boolean | Record<string, unknown>;
}

// A node in the block tree (runtime)
interface NodeInstance {
  id: string;
  type: string;
  children?: NodeInstance[];
  [key: string]: unknown;  // Property values stored directly on the node
}

// The full registry
interface ComponentRegistry {
  [type: string]: ComponentDefinition;
}
```

---

## Backend API Endpoints

All endpoints are under `/api/v1/builder` and require authentication unless noted.

### Native Components

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/components` | All components + shared options + shared fields |
| `GET` | `/components/:type` | Single component by type |
| `POST` | `/components` | Create or update a component (upsert by type) |
| `DELETE` | `/components/:type` | Delete a component |
| `POST` | `/components/import` | Bulk import components from array |
| `POST` | `/components/import-json` | Import from `shadcn-components.json` format |

### Config

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/config/:key` | Get a config value |
| `PUT` | `/config/:key` | Update a config value |

### Shared Options

| Method | Path | Description |
|--------|------|-------------|
| `POST` | `/shared-options` | Create or update a shared option set |
| `DELETE` | `/shared-options/:name` | Delete a shared option set |

### Shared Fields

| Method | Path | Description |
|--------|------|-------------|
| `POST` | `/shared-fields` | Create or update a shared field template |
| `DELETE` | `/shared-fields/:name` | Delete a shared field template |

### Blocks

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/blocks` | List blocks (supports query filters) |
| `GET` | `/blocks/:id` | Get a single block |
| `POST` | `/blocks` | Create a block |
| `PUT` | `/blocks/:id` | Update a block (auto-appends changelog) |
| `DELETE` | `/blocks/:id` | Delete a block |
| `POST` | `/blocks/:id/duplicate` | Duplicate a block |

**Block list filters** (query parameters on `GET /blocks`):

| Parameter | Description |
|-----------|-------------|
| `?projectId=xxx` | Blocks scoped to a project |
| `?collectionId=xxx` | Blocks within a collection |
| `?global=true` | Global blocks (no project scope) |
| `?system=true` | System blocks (admin-created, available to all) |

### Categories

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/categories` | All categories for the user |
| `POST` | `/categories` | Create a category |
| `DELETE` | `/categories/:id` | Delete a category |

### Collections

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/collections` | List all collections |
| `GET` | `/collections/:id` | Get a collection with metadata |
| `POST` | `/collections` | Create a collection |
| `PUT` | `/collections/:id` | Update a collection |
| `DELETE` | `/collections/:id` | Delete a collection |

---

## Public Registry API

<Aside type="tip">
These endpoints are **public** (no authentication required for public projects). They serve JSON consumed by the `shadcn` CLI.
</Aside>

| Method | Path | Description |
|--------|------|-------------|
| `GET` | `/r/:projectSlug` | List available blocks in a project |
| `GET` | `/r/:projectSlug/:blockName.json` | Get registry JSON for a specific block |

Registry URLs use subdomain-based user identification:

```
https://handle.usefoundryui.app/r/my-project/hero-section.json
```

For local development, you can use the `?handle=` query parameter instead:

```
http://localhost:3001/r/my-project/hero-section.json?handle=myhandle
```

### Private Projects

If a project has `visibility: 'private'` in its data, requests must include a Bearer token matching the project's `registrytoken`:

```bash
curl -H "Authorization: Bearer <token>" \
  https://handle.usefoundryui.app/r/private-project/my-block.json
```
