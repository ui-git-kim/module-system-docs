---
title: Configuration
description: Environment variables, config tables, and module initialisation for the Block Builder
sidebar:
  order: 1
---

import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

The Block Builder module uses a database-driven configuration system. There are no environment variables specific to this module — all configuration lives in the `builder_config` table and is seeded automatically on first run.

---

## Installation Prompts

The builder has **no interactive prompts** during `npx builder init`. It installs with sensible defaults and seeds configuration automatically.

---

## Module Initialisation

On first backend start, `initBuilderModule()` runs automatically and seeds two things:

### 1. Shared Options

Default shared option sets are created in the `builder_config` table under the key `sharedOptions`. These provide reusable dropdown choices for component properties.

| Option Set | Values |
|-----------|--------|
| `width` | auto, full, 1/2, 1/3, 2/3, 1/4, 3/4 |
| `maxWidth` | none, xs, sm, md, lg, xl, 2xl, 3xl, full |
| `spacing` | 0 (none), 1 (4px), 2 (8px), 3 (12px), 4 (16px), 5 (20px), 6 (24px), 8 (32px) |
| `rounded` | none, sm, md, lg, xl, 2xl, full |
| `shadow` | none, sm, md, lg, xl |
| `orientation` | horizontal, vertical |
| `align` | inline-start (Left), inline-end (Right), block-start (Top), block-end (Bottom) |
| `layout` | row (horizontal), column (vertical) |
| `iconSize` | xs (h-3 w-3), sm (h-3.5 w-3.5), md (h-4 w-4), lg (h-5 w-5) |

<Aside type="tip">
Shared options can include a `className` property (e.g. `iconSize` maps `sm` to `h-3.5 w-3.5`). The property panel's `transformProperty()` function in `useNativeComponents` resolves these at render time.
</Aside>

### 2. Projects Node Type

If no `projects` node type exists in the Structure module, the builder seeds one with these defaults:

```typescript
{
  slug: 'projects',
  name: 'Project',
  namePlural: 'Projects',
  description: 'Projects organise blocks, components, and registry output',
  icon: 'Briefcase',
  color: '#06B6D4',
  moduleId: 'builder',
  rules: { isRoot: true, isHierarchical: false },
  features: { color: true },
  navigation: {
    mainNav: { enabled: true, order: 30 },
    sidebarNav: { style: 'list', showEmpty: true },
    pageNav: { style: 'tabs' },
    listPage: { defaultView: 'grid' },
  },
}
```

<Aside type="note">
If you've already created a project-like node type manually in the Structure admin, the builder won't overwrite it. It only seeds when no type with slug `projects` exists.
</Aside>

---

## Builder Config Table

The `builder_config` table stores key-value JSON pairs:

| Key | Description | Seeded by Init? |
|-----|-------------|:---:|
| `sharedOptions` | Reusable select option sets referenced by `$optionName` in properties | Yes |
| `sharedFields` | Reusable field template definitions | No |
| `projectNodeType` | The node type slug used for projects (returned in component API) | No |

### How Shared Options Work

Native component property definitions can reference shared options by prefixing the option set name with `$`:

```json
{
  "key": "orientation",
  "label": "Orientation",
  "type": "select",
  "options": "$orientation"
}
```

When the frontend fetches components via `GET /api/v1/builder/components`, the response includes both the component definitions and the shared options map. The `useNativeComponents` hook resolves `$orientation` to the actual array of options at runtime.

### How Shared Fields Work

Shared fields are reusable property template definitions stored under the `sharedFields` config key. They allow you to define a property once and reference it across multiple components, ensuring consistency.

---

## Native Component Registry

The `native_component` table is the palette of available components. It is **public** (no `userId` column) — all users share the same component definitions. Key fields:

| Field | Description |
|-------|-------------|
| `type` | Unique identifier (e.g. `button`, `card-header`) |
| `library` | Source library: `shadcn`, `primitive`, `plate`, `custom` |
| `category` | Behaviour category: `container`, `element`, `child`, `primitive` |
| `jsxTag` | React component name (e.g. `Button`, `CardHeader`) |
| `importPath` | Where the component is imported from (e.g. `@/components/ui/card`) |
| `parentType` | If this is a child component, which parent it belongs to |
| `isContainer` | Whether this component accepts children |
| `acceptsAny` | Whether it accepts any child type (vs. `allowedChildren` list) |
| `properties` | JSON array of `NativeComponentProperty` definitions |
| `allowedChildren` | Array of allowed child component types |
| `defaultChildren` | Default child nodes added when this component is dropped onto the canvas |
| `codeStructure` | Code generation hints (conditional wrappers, siblings) |

### Seeding Components

Components are not auto-seeded by the init function. You populate them via the API:

<Tabs>
  <TabItem label="JSON Import">
    ```bash
    # Import from shadcn-components.json format
    curl -X POST /api/v1/builder/components/import-json \
      -H "Content-Type: application/json" \
      -d @shadcn-components.json
    ```
  </TabItem>
  <TabItem label="Individual">
    ```bash
    # Create or update a single component
    curl -X POST /api/v1/builder/components \
      -H "Content-Type: application/json" \
      -d '{
        "type": "button",
        "category": "element",
        "label": "Button",
        "jsxTag": "Button",
        "importPath": "@/components/ui/button",
        "properties": [
          { "key": "variant", "label": "Variant", "type": "select",
            "options": [
              { "value": "default", "label": "Default" },
              { "value": "secondary", "label": "Secondary" },
              { "value": "outline", "label": "Outline" },
              { "value": "ghost", "label": "Ghost" },
              { "value": "destructive", "label": "Destructive" }
            ] }
        ]
      }'
    ```
  </TabItem>
  <TabItem label="Admin UI">
    Navigate to **Admin > Components** in the app. The admin page provides a full CRUD interface for managing native component definitions.
  </TabItem>
</Tabs>

---

## Frontend Dependencies

The module installs these npm packages automatically:

| Package | Purpose |
|---------|---------|
| `@dnd-kit/core` | Core drag-and-drop engine |
| `@dnd-kit/sortable` | Sortable list support for reordering children |
| `@dnd-kit/utilities` | DnD utility functions |
| `react-resizable-panels@^2.1.9` | Resizable panel layout (pinned — newer versions have a bug) |

### shadcn Components

The module installs a large set of shadcn components, split into two groups:

**Builder UI** — used by the builder's own panels, toolbar, and canvas:
`button`, `checkbox`, `collapsible`, `input`, `label`, `resizable`, `scroll-area`, `select`, `separator`, `sidebar`, `tabs`, `textarea`, `toggle-group`

**Preview Render** — used to render user-built blocks in the live preview:
`accordion`, `alert`, `alert-dialog`, `aspect-ratio`, `avatar`, `badge`, `breadcrumb`, `calendar`, `card`, `command`, `context-menu`, `dialog`, `drawer`, `dropdown-menu`, `hover-card`, `input-otp`, `menubar`, `navigation-menu`, `pagination`, `popover`, `progress`, `radio-group`, `sheet`, `skeleton`, `slider`, `switch`, `table`, `toggle`, `tooltip`

<Aside type="caution">
Preview render components are imported via a local `ui/` barrel file to ensure they remain pristine and untouched by app customisation. The preview always uses the original shadcn defaults.
</Aside>
