---
title: Configuration
description: Environment variables, config tables, and module initialisation for the Block Builder
sidebar:
  order: 1
---

import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

The Block Builder module uses a database-driven configuration system. There are no environment variables specific to this module — all configuration lives in the `builder_config` table and is seeded automatically on first run.

---

## Installation Prompts

The builder has **no interactive prompts** during `npx builder init`. It installs with sensible defaults and seeds configuration automatically.

---

## Module Initialisation

On first backend start, `initBuilderModule()` runs automatically and seeds the **Projects Node Type**.

If no `projects` node type exists in the Structure module, the builder seeds one with these defaults:

```typescript
{
  slug: 'projects',
  name: 'Project',
  namePlural: 'Projects',
  description: 'Projects organise blocks, components, and registry output',
  icon: 'Briefcase',
  color: '#06B6D4',
  moduleId: 'builder',
  rules: { isRoot: true, isHierarchical: false },
  features: { color: true },
  navigation: {
    mainNav: { enabled: true, order: 30 },
    sidebarNav: { style: 'list', showEmpty: true },
    pageNav: { style: 'tabs' },
    listPage: { defaultView: 'grid' },
  },
}
```

<Aside type="note">
If you've already created a project-like node type manually in the Structure admin, the builder won't overwrite it. It only seeds when no type with slug `projects` exists.
</Aside>

---

## Builder Config Table

The `builder_config` table stores key-value JSON pairs:

| Key | Description | Seeded by Init? |
|-----|-------------|:---:|
| `sharedFields` | Reusable field template definitions | No |
| `projectNodeType` | The node type slug used for projects (returned in component API) | No |

### How Shared Fields Work

Shared fields are reusable property template definitions stored under the `sharedFields` config key. They allow you to define a property once and add it to multiple components via the admin UI, ensuring consistency across your component library.

---

## Native Component Registry

The `native_component` table is the palette of available components. It is **public** (no `userId` column) — all users share the same component definitions. Key fields:

| Field | Description |
|-------|-------------|
| `type` | Unique identifier (e.g. `button`, `card-header`) |
| `library` | Source library: `shadcn`, `primitive`, `plate`, `custom` |
| `category` | Behaviour category: `container`, `element`, `child`, `primitive` |
| `jsxTag` | React component name (e.g. `Button`, `CardHeader`) |
| `importPath` | Where the component is imported from (e.g. `@/components/ui/card`) |
| `parentType` | If this is a child component, which parent it belongs to |
| `isContainer` | Whether this component accepts children |
| `acceptsAny` | Whether it accepts any child type (vs. `allowedChildren` list) |
| `properties` | JSON array of `NativeComponentProperty` definitions |
| `allowedChildren` | Array of allowed child component types |
| `defaultChildren` | Default child nodes added when this component is dropped onto the canvas |
| `codeStructure` | Code generation hints (conditional wrappers, siblings) |

### Property Definition Fields

Each property in the `properties` JSON array supports these fields:

| Field | Type | Description |
|-------|------|-------------|
| `key` | `string` | Property key stored on the node (e.g. `variant`, `label`) |
| `label` | `string` | Display label in the property panel |
| `type` | `string` | Field type: `string`, `number`, `boolean`, `select`, `icon`, `textarea`, `id`, `className` |
| `defaultValue` | `string?` | Default value for the property |
| `placeholder` | `string?` | Placeholder text for the input |
| `description` | `string?` | Help text shown below the field |
| `codePlacement` | `string?` | How this field appears in generated code (see below) |
| `codeAlias` | `string?` | JSX attribute name override (see below) |
| `codeFormat` | `string?` | Value format in JSX output (see below) |
| `isRequired` | `boolean?` | Field must have a value |
| `isUnique` | `boolean?` | Only one instance with this value per parent |
| `invertValue` | `boolean?` | Boolean is flipped — checked = false in code |
| `richText` | `boolean?` | Enable rich text editing for textarea fields |
| `classNameKey` | `string?` | Companion className prop key (for icon fields) |
| `options` | `array?` | Array of `{ label, value }` for select fields |

### Code Generation Fields

These three fields control how a property appears in the generated React code. They make the code generation engine fully config-driven — no hardcoded property key or component type checks.

#### `codePlacement`

Controls **where** the property value appears in the generated JSX:

| Value | Output | Example |
|-------|--------|---------|
| `'attribute'` (default) | Inside the tag as a prop | `<Button variant="outline">` |
| `'inner'` | Between open/close tags as text content | `<Button>Click me</Button>` |
| `'hidden'` | Not included in generated code | _(no output)_ |

<Aside type="tip">
When `codePlacement` is `'inner'`, the code generator also falls back to the property's `defaultValue` if the user hasn't explicitly set a value. So a Button with `label` defaulting to "Button" and `codePlacement: 'inner'` will generate `<Button>Button</Button>` automatically.
</Aside>

#### `codeAlias`

Overrides the JSX attribute name. Use this when the property key in the builder differs from the actual React prop name.

| Property Key | `codeAlias` | Output |
|-------------|------------|--------|
| `htmlId` | `id` | `<div id="hero">` |
| `accordionType` | `type` | `<Accordion type="single">` |
| `htmlFor` | `htmlFor` | `<Label htmlFor="email">` |

If not set, the property key is used as the JSX attribute name.

#### `codeFormat`

Controls how the **value** is formatted in JSX:

| Value | Output | Use Case |
|-------|--------|----------|
| `'default'` (default) | Normal: `prop="value"` or `prop={42}` | Most properties |
| `'array'` | Wrapped in array: `prop={[value]}` | Slider `defaultValue`, multi-value props |

### Seeding Components

Components are not auto-seeded by the init function. You populate them via the API:

<Tabs>
  <TabItem label="JSON Import">
    ```bash
    # Import from shadcn-components.json format
    curl -X POST /api/v1/builder/components/import-json \
      -H "Content-Type: application/json" \
      -d @shadcn-components.json
    ```
  </TabItem>
  <TabItem label="Individual">
    ```bash
    # Create or update a single component
    curl -X POST /api/v1/builder/components \
      -H "Content-Type: application/json" \
      -d '{
        "type": "button",
        "category": "element",
        "label": "Button",
        "jsxTag": "Button",
        "importPath": "@/components/ui/button",
        "isContainer": true,
        "allowedChildren": ["icon", "typography"],
        "properties": [
          { "key": "label", "label": "Label", "type": "string",
            "defaultValue": "Button", "codePlacement": "inner",
            "isRequired": true },
          { "key": "variant", "label": "Variant", "type": "select",
            "options": [
              { "value": "default", "label": "Default" },
              { "value": "secondary", "label": "Secondary" },
              { "value": "outline", "label": "Outline" },
              { "value": "ghost", "label": "Ghost" },
              { "value": "destructive", "label": "Destructive" }
            ] },
          { "key": "asChild", "label": "Use asChild Prop", "type": "boolean" }
        ]
      }'
    ```
  </TabItem>
  <TabItem label="Admin UI">
    Navigate to **Admin > Block Builder** in the app. The admin page provides a full CRUD interface for managing native component definitions across three tabs: **Native Components**, **Field Templates**, and **Settings**.
  </TabItem>
</Tabs>

---

## Admin Page

The Block Builder admin page is at **Admin > Block Builder** (`/admin/block-builder`), accessible to admin users only. It has three tabs:

### Native Components Tab

Lists all component definitions with an inline category filter (All, Containers, Elements, Children, Primitives). Each component can be edited via a dialog with three sub-tabs:

- **General** — Component key, label, library, category, JSX tag, import path, icon, description, parent type, and behaviour flags (accepts children, any child type, self-closing, dynamic HTML tag)
- **Children** — Allowed children types and default template configuration
- **Fields** — Property definitions with drag reordering. Each field shows its key, type, options count, required status, and code placement/alias at a glance

### Field Templates Tab

Manage reusable field templates (shared fields). Create a template once, then add it to multiple components to ensure consistent property definitions.

### Settings Tab

Module-level configuration values stored in the `builder_config` table.

---

## Frontend Dependencies

The module installs these npm packages automatically:

| Package | Purpose |
|---------|---------|
| `@dnd-kit/core` | Core drag-and-drop engine |
| `@dnd-kit/sortable` | Sortable list support for reordering children |
| `@dnd-kit/utilities` | DnD utility functions |
| `react-resizable-panels@^2.1.9` | Resizable panel layout (pinned — newer versions have a bug) |

### shadcn Components

The module installs a large set of shadcn components, split into two groups:

**Builder UI** — used by the builder's own panels, toolbar, and canvas:
`button`, `checkbox`, `collapsible`, `input`, `label`, `resizable`, `scroll-area`, `select`, `separator`, `sidebar`, `tabs`, `textarea`, `toggle-group`

**Preview Render** — used to render user-built blocks in the live preview:
`accordion`, `alert`, `alert-dialog`, `aspect-ratio`, `avatar`, `badge`, `breadcrumb`, `calendar`, `card`, `command`, `context-menu`, `dialog`, `drawer`, `dropdown-menu`, `hover-card`, `input-otp`, `menubar`, `navigation-menu`, `pagination`, `popover`, `progress`, `radio-group`, `sheet`, `skeleton`, `slider`, `switch`, `table`, `toggle`, `tooltip`

<Aside type="caution">
Preview render components are imported via a local `ui/` barrel file to ensure they remain pristine and untouched by app customisation. The preview always uses the original shadcn defaults.
</Aside>
