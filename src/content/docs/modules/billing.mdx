---
title: Billing Module
description: Stripe integration for subscriptions and payments
---

import { Steps } from '@astrojs/starlight/components';

## Overview

The Billing module provides Stripe integration for:
- Subscription plans and checkout
- Customer portal for self-service
- Webhook handling for sync
- Usage tracking support

---

## Requirements

- Starter template v1.2.0+
- Stripe account with API keys
- Stripe CLI for local webhooks

---

## Installation

<Steps>
1. **Copy module files**
   ```bash
   cp -r billing-module/frontend/src/features/billing frontend/src/features/
   cp -r billing-module/backend/src/features/billing backend/src/features/
   ```

2. **Add Prisma schema**

   Add `Subscription` model to `schema.prisma`

3. **Run migration**
   ```bash
   cd backend && npx prisma migrate dev --name add-billing
   ```

4. **Import modules**
   ```typescript
   // frontend/main.tsx
   import '@/features/billing';

   // backend/app.ts
   import './features/billing/index.js';
   ```

5. **Configure environment**
   ```env
   STRIPE_SECRET_KEY=sk_test_...
   STRIPE_WEBHOOK_SECRET=whsec_...
   STRIPE_PRICE_ID_BASIC=price_...
   STRIPE_PRICE_ID_PRO=price_...
   ```

6. **Set up webhooks**
   ```bash
   stripe listen --forward-to localhost:3100/api/v1/billing/webhook
   ```
</Steps>

---

## API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/billing/checkout` | POST | Create checkout session |
| `/billing/subscription` | GET | Get subscription status |
| `/billing/portal` | POST | Create portal session |
| `/billing/webhook` | POST | Stripe webhook handler |

---

## Frontend Usage

```typescript
import { useBilling } from '@/features/billing';

function BillingPage() {
  const { subscription, createCheckout, openPortal } = useBilling();

  return (
    <div>
      {subscription ? (
        <Button onClick={openPortal}>Manage</Button>
      ) : (
        <Button onClick={() => createCheckout('price_xxx')}>
          Subscribe
        </Button>
      )}
    </div>
  );
}
```

---

## Next Steps

- [Module Catalogue](/modules/) - Other modules
- [Module Structure](/modules/structure/) - Standards
