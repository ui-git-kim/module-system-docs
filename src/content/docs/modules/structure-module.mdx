---
title: Structure Module
description: Hierarchical organisation and navigation skeleton for SaaS applications
---

import { Steps, Tabs, TabItem, FileTree, Card, CardGrid, Aside } from '@astrojs/starlight/components';

## What is Structure?

The Structure module provides the **organisational backbone** for your SaaS application. It gives you a flexible system where you define **node types** that represent the core entities in your app, and each node gets its own detail page with tabs that other modules can extend.

<Aside type="tip" title="Think of it like this">
Structure is like a filing cabinet system. You decide what goes in the cabinet (Clients? Workspaces? Cases? Properties?), how things are organised (folders, tags), and other modules add functionality to each item (billing adds invoices, tasks adds task lists, etc.).
</Aside>

### How It Works

1. **You define node types** - These are the core entities in your app. A legal practice might have "Clients" and "Matters". A property manager might have "Properties" and "Tenants". A creative agency might have "Clients" and "Projects".

2. **Users create nodes** - Each node is an instance of a type. A node has a name, description, custom fields, and can be organised hierarchically.

3. **Nodes have detail pages** - When a user clicks on a node, they see a detail page with tabs. The Structure module provides default tabs (Overview, Info, Children, Settings), but other modules can add their own tabs.

4. **Modules extend nodes** - A Tasks module might add a "Tasks" tab to every node. A Billing module might add an "Invoices" tab only to Client nodes. A Notes module might add a "Notes" tab to everything.

### Example: Legal Practice

```
Node Types:
├── Client (container)     → /clients
│   └── Matter (primary)   → /clients/:clientId/matters/:matterId
│       ├── Folder         → organise documents
│       └── Tag            → categorise (e.g., "Litigation", "Contract")

Node Detail Page (/clients/abc123):
├── Overview tab      ← Structure module (widgets from other modules)
├── Info tab          ← Structure module (custom fields)
├── Matters tab       ← Structure module (child nodes)
├── Invoices tab      ← Billing module (adds this tab)
├── Documents tab     ← Documents module (adds this tab)
└── Settings tab      ← Structure module (node settings)
```

### Example: Project Management

```
Node Types:
├── Project (primary)      → /projects
│   ├── Folder             → organise work
│   └── Tag                → categorise (e.g., "Active", "On Hold")

Node Detail Page (/projects/xyz789):
├── Overview tab      ← Structure module
├── Tasks tab         ← Tasks module (adds this tab)
├── Time tab          ← Time Tracking module (adds this tab)
├── Files tab         ← Files module (adds this tab)
└── Settings tab      ← Structure module
```

<CardGrid>
  <Card title="Unified Nodes" icon="document">
    Everything is a node - your entities, folders, tags, connections
  </Card>
  <Card title="Hierarchical" icon="list-format">
    Nodes can contain other nodes with parent/child relationships
  </Card>
  <Card title="Extensible" icon="puzzle">
    Other modules add tabs, widgets, and card extensions to nodes
  </Card>
  <Card title="Clean URLs" icon="external">
    Routes like `/clients/:id` - no `/structure/` prefix
  </Card>
</CardGrid>

---

## Installation

```bash
npx structure init
```

### Prompts

The installer asks you to define your app's structure. Some prompts are conditional based on previous answers.

#### Container Node (Optional)

A container is a top-level grouping node. Use this when your primary entity belongs to something else.

| Prompt | Default | Condition | Description |
|--------|---------|-----------|-------------|
| `hasContainer` | No | - | Do you need a container type? (e.g., Client that contains Projects) |
| `containerNodeName` | Client | hasContainer=true | Singular name |
| `containerNodePlural` | Clients | hasContainer=true | Plural form |
| `containerSlug` | clients | hasContainer=true | URL slug |
| `containerNodeIcon` | Building2 | hasContainer=true | Lucide icon |

**When to use a container:**
- Legal: Clients contain Matters
- Agency: Clients contain Projects
- Property: Buildings contain Units

**When NOT to use a container:**
- Simple project management (just Projects)
- Personal productivity (just Tasks or Notes)

#### Primary Node

The main entity users work with.

| Prompt | Default | Condition | Description |
|--------|---------|-----------|-------------|
| `primaryNodeName` | Project | - | Singular name (e.g., "Matter", "Property", "Case") |
| `primaryNodePlural` | Projects | - | Plural form for navigation |
| `primarySlug` | projects | - | URL path |
| `primaryNodeIcon` | Briefcase | - | Lucide icon |
| `primaryInMainNav` | Yes | hasContainer=false | Show in main navigation? |

#### Optional Features

| Prompt | Default | Description |
|--------|---------|-------------|
| `enableFolders` | Yes | Allow folders within nodes for organisation |
| `enableTags` | Yes | Allow tags for categorisation |

### Post-Installation

<Steps>
1. **Generate Prisma client**
   ```bash
   npx prisma generate
   ```

2. **Run migrations**
   ```bash
   npx prisma migrate dev
   ```

3. **Add routes** to `frontend/src/routes.tsx`
   ```typescript
   import { structureRoutes } from '@/features/structure';

   // In protected routes:
   ...structureRoutes,
   ```

4. **Initialize backend** in `server.ts`
   ```typescript
   import { initStructure } from './features/structure';

   await initStructure();
   ```
</Steps>

---

## Node Types

A **node type** defines a category of entity in your app. Each type has:

- **Name** - Display name (e.g., "Client", "Project", "Matter")
- **Icon** - Lucide icon for navigation and cards
- **Rules** - What can contain it, what it can contain
- **Features** - Which features are enabled (favorites, archiving, etc.)
- **Fields** - Custom data fields (stored as JSON)
- **Navigation** - How it appears in sidebar and main nav

### Default Types

The installer creates default types based on your prompts. These can be modified in the admin panel or via code.

### Creating Additional Types

Other modules can register their own node types:

```typescript
import { structureService } from '@/features/structure';

await structureService.createNodeType({
  slug: 'invoice',
  name: 'Invoice',
  namePlural: 'Invoices',
  icon: 'FileText',
  moduleId: 'billing',
  rules: {
    allowedParents: ['client'],  // Can only exist under Clients
    allowedChildren: [],          // Cannot contain other nodes
  },
  features: {
    canFavorite: false,
    canArchive: true,
  },
  fields: [
    { id: 'amount', type: 'number', label: 'Amount' },
    { id: 'dueDate', type: 'date', label: 'Due Date' },
  ],
});
```

---

## Node Types Admin Page

The Admin page provides a visual interface for managing node types without code changes. Access it at **Admin > App Structure**.

### Two-Pane Layout

The admin page uses a master-detail layout:

- **Left pane** - Compact list of all node types with drag handles
- **Right pane** - Full form editor for the selected type

Click a type in the list to select it. The form appears in the right pane where you can edit all configuration.

### Drag-to-Reorder

Node types can be reordered by dragging:

1. Grab the **grip handle** on the left of any type
2. Drag to the desired position
3. Release to save - order persists automatically

The sort order affects display in navigation and list views.

### Configuration Tabs

When editing a node type, the form is organised into tabs:

#### Basic Tab

| Field | Description |
|-------|-------------|
| Slug | URL identifier (cannot change after creation) |
| Name / Plural | Display names |
| Description | Optional description |
| Icon | Lucide icon picker |
| Color | Theme color for the type |
| Sort Order | Position in lists |
| Enabled | Toggle type on/off |

#### Properties Tab

Toggle built-in features for this node type:

| Feature | Description |
|---------|-------------|
| Custom Slug | Allow nodes to have custom URLs |
| Description | Enable rich text descriptions |
| Custom Colour | Let nodes have their own color |
| Custom Icon | Let nodes have their own icon |
| Favourites | Enable favorite/star functionality |
| Archiving | Enable archive/restore |
| Publishing | Enable draft/published workflow |
| Manual Sort | Allow drag-to-reorder nodes |

#### Fields Tab

Define custom data fields for nodes of this type:

**Supported field types:**
- Text, Text Area, Number
- Date, Date & Time
- Select, Multi-Select
- URL, Email
- Toggle (boolean)
- Secret (API keys - masked display)
- Media (file uploads)
- Node Reference (link to other nodes)

Each field can have:
- Label and placeholder
- Required toggle
- Description/help text
- Width (full or half)
- Type-specific options (e.g., select options, min/max for numbers)

#### Hierarchy Tab

Configure how this type fits into the node hierarchy:

| Setting | Description |
|---------|-------------|
| Root Structure Type | Can exist at top level without a parent |
| Hierarchical | Can have parent-child relationships |
| Maximum Depth | Limit nesting depth |
| Allowed Parents | Which types can contain this type (empty = any) |
| Allowed Children | Which types can be nested inside this type (empty = any) |

<Aside type="tip" title="Allowed Parents/Children">
Click the type badges to toggle them on/off. Selected types appear highlighted. Leave empty to allow all types.
</Aside>

#### Navigation Tab

**Main Navigation:**
- Show in main sidebar
- Order position
- Show count badge

**Page Navigation:**
- Tab style (Tabs, Sidebar, or None)
- Default tab when opening a node

**Built-in Tabs:**
Toggle visibility of: Overview, Info, Children, Connections, Settings

**Module Tabs:**
Configure tabs registered by other modules:
- **Hidden Tabs** - Comma-separated list of tab IDs to hide (e.g., `tasks-tab, notes-tab`)
- **Tab Order** - Custom order for tabs (e.g., `overview, info, tasks-tab, children, settings`)

**List Page:**
- Default view (Grid, List, Table)
- Show search bar
- Show filters

### Actions

When editing an existing type, the header shows:

| Action | Description |
|--------|-------------|
| **Duplicate** | Create a copy to use as a starting point |
| **Enable/Disable** | Toggle the type on/off |
| **Delete** | Remove the type (requires confirmation) |

---

## Node Detail Pages

When a user navigates to a node (e.g., `/clients/abc123`), they see a detail page with:

1. **Header** - Node name, icon, breadcrumbs, actions
2. **Tab Navigation** - Horizontal tabs
3. **Tab Content** - The selected tab's content

### Built-in Tabs

Structure provides these default tabs (all can be hidden per node type):

| Tab | Description |
|-----|-------------|
| **Overview** | Dashboard-style widgets from various modules |
| **Info** | Custom fields defined for this node type |
| **Children** | Child nodes (if the type allows children) |
| **Connections** | Related nodes via the connection system |
| **Settings** | Node-specific settings |

### How Modules Add Tabs

Other modules register tabs via the **Node Tab Registry**:

```typescript
// In a Tasks module
import { nodeTabRegistry } from '@/features/structure';

nodeTabRegistry.register({
  id: 'tasks',
  moduleId: 'tasks',
  label: 'Tasks',
  icon: 'CheckSquare',
  nodeTypes: '*',  // Show on all node types (or ['client', 'project'])
  order: 20,       // Position in tab bar (lower = earlier)
  component: TasksTab,
  isVisible: (node, nodeType) => nodeType.features.tasks !== false,
});
```

The tab automatically appears on node detail pages for matching node types.

---

## Extending Nodes

Structure provides three registries for modules to extend node functionality.

<Aside type="tip">
All Structure registries extend `BaseRegistry` from `@/config/base.registry`. This gives them standard methods like `register()`, `unregister()`, `get()`, `getAll()`, and automatic React hooks.
</Aside>

### Node Tab Registry

Add tabs to node detail pages.

```typescript
import { nodeTabRegistry } from '@/features/structure';

nodeTabRegistry.register({
  id: 'documents',
  moduleId: 'documents',
  label: 'Documents',
  icon: 'FileText',
  nodeTypes: ['client', 'matter'],  // Only these types
  order: 30,
  component: DocumentsTab,
});
```

**React Hook:**

```typescript
import { useNodeTabRegistry } from '@/features/structure';

function TabBar() {
  const allTabs = useNodeTabRegistry();  // Auto-updates on changes
}
```

**Filtered for a Node:**

```typescript
const tabsForThisNode = nodeTabRegistry.getTabsForNodeType(
  nodeType.slug,
  node,
  nodeTypeConfig
);
```

### Node Widget Registry

Add widgets to the Overview tab.

```typescript
import { nodeWidgetRegistry } from '@/features/structure';

nodeWidgetRegistry.register({
  id: 'recent-activity',
  moduleId: 'activity',
  title: 'Recent Activity',
  nodeTypes: '*',
  order: 10,
  component: RecentActivityWidget,
});
```

**React Hook:**

```typescript
import { useNodeWidgetRegistry } from '@/features/structure';

function OverviewTab() {
  const widgets = useNodeWidgetRegistry();
}
```

### Node Card Extension Registry

Add badges or actions to node cards in list views.

```typescript
import { nodeCardExtensionRegistry } from '@/features/structure';

nodeCardExtensionRegistry.register({
  id: 'task-count',
  moduleId: 'tasks',
  type: 'badge',  // 'badge' | 'action' | 'footer'
  nodeTypes: '*',
  order: 10,
  component: TaskCountBadge,  // Shows "5 tasks" on the card
});
```

**React Hook:**

```typescript
import { useNodeCardExtensionRegistry } from '@/features/structure';

function NodeCard({ node }) {
  const extensions = useNodeCardExtensionRegistry();
}
```

### Registry Summary

| Registry | Purpose | Hook |
|----------|---------|------|
| `nodeTabRegistry` | Tabs on detail pages | `useNodeTabRegistry()` |
| `nodeWidgetRegistry` | Widgets on Overview tab | `useNodeWidgetRegistry()` |
| `nodeCardExtensionRegistry` | Badges/actions on cards | `useNodeCardExtensionRegistry()` |

---

## NodeSelector Component

Let users pick nodes in forms (e.g., "Select a Client for this Invoice"):

```typescript
import { NodeSelector } from '@/features/structure';

function InvoiceForm() {
  const [clientId, setClientId] = useState<string | null>(null);

  return (
    <NodeSelector
      value={clientId}
      onChange={(node) => setClientId(node?.id ?? null)}
      nodeTypes={['client']}
      placeholder="Select a client..."
    />
  );
}
```

---

## Database Schema

### structure_node

The universal entity table - every node is stored here.

| Column | Type | Description |
|--------|------|-------------|
| `id` | String | CUID primary key |
| `userId` | String | Owner |
| `nodeType` | String | References node type slug |
| `name` | String | Display name |
| `slug` | String? | URL-safe identifier |
| `description` | String? | Rich text description |
| `data` | JSON | Custom field values |
| `parentId` | String? | Parent node (for hierarchy) |
| `path` | String? | Materialised path for tree queries |
| `depth` | Int | Tree depth (0 = root) |
| `sortOrder` | Int | Position among siblings |
| `status` | String | active/archived/deleted |
| `isFavorite` | Boolean | User marked as favorite |
| `settings` | JSON | Node-specific settings |
| `metadata` | JSON | Module extensibility data |

### structure_node_type

Configuration for each node type.

| Column | Type | Description |
|--------|------|-------------|
| `slug` | String | Unique identifier |
| `name` | String | Display name |
| `namePlural` | String | Plural form |
| `icon` | String | Lucide icon name |
| `moduleId` | String? | Owning module |
| `rules` | JSON | Hierarchy rules |
| `features` | JSON | Enabled features |
| `fields` | JSON | Custom field definitions |
| `navigation` | JSON | Navigation config |
| `isSystem` | Boolean | Protected from user editing |

---

## API Endpoints

All endpoints are prefixed with `/api/v1/structure`.

### Nodes

| Method | Path | Description |
|--------|------|-------------|
| GET | `/nodes` | List nodes (with filters) |
| GET | `/nodes/:id` | Get single node |
| POST | `/nodes` | Create node |
| PATCH | `/nodes/:id` | Update node |
| DELETE | `/nodes/:id` | Soft delete |
| POST | `/nodes/:id/move` | Move to different parent |
| POST | `/nodes/:id/archive` | Archive |
| POST | `/nodes/:id/restore` | Restore |
| POST | `/nodes/:id/favorite` | Toggle favorite |
| GET | `/nodes/:id/children` | Get children |
| GET | `/nodes/:id/descendants` | Get all descendants |

### Query Parameters

| Param | Description |
|-------|-------------|
| `type` | Filter by node type slug |
| `parentId` | Filter by parent (use `null` for roots) |
| `status` | active, archived, deleted, or all |
| `search` | Search name/description |
| `page`, `limit` | Pagination |

### Node Types

| Method | Path | Description |
|--------|------|-------------|
| GET | `/types` | List all types |
| GET | `/types/:slug` | Get type config |
| POST | `/types` | Create type |
| PATCH | `/types/:slug` | Update type |
| DELETE | `/types/:slug` | Delete type |

---

## Frontend Routes

| Path | Component | Description |
|------|-----------|-------------|
| `/:nodeType` | NodeListPage | List view (e.g., `/clients`) |
| `/:nodeType/:nodeId` | NodeDetailPage | Detail page |
| `/:nodeType/:nodeId/:tabId` | NodeDetailPage | Direct tab link |

---

## Generated Files

<Tabs>
  <TabItem label="Frontend">
    <FileTree>
    - src/features/structure/
      - index.ts
      - routes.config.tsx
      - types/
        - index.ts
        - node.types.ts
        - node-type.types.ts
        - registry.types.ts
      - config/
        - index.ts
        - node-types.registry.ts
        - tabs.registry.ts
        - widgets.registry.ts
        - extensions.registry.ts
      - services/
        - structure.service.ts
      - hooks/
        - index.ts
        - useNodes.ts
        - useNode.ts
        - useNodeMutations.ts
        - useNodeTypes.ts
        - useNodeTree.ts
        - useNodeTabs.ts
        - useNodeWidgets.ts
      - components/
        - node/ (NodeIcon, NodeCard, NodeForm, etc.)
        - selectors/ (NodeSelector)
        - tree/ (StructureTree)
        - views/ (NodeGrid, NodeList)
        - tabs/ (Overview, Info, Children, etc.)
      - pages/
        - NodeListPage.tsx
        - NodeDetailPage.tsx
        - admin/ (NodeTypesAdminPage)
      - registrations/
        - index.ts
        - tabs.registration.ts
        - navigation.registration.ts
        - routes.registration.ts
        - default-types.registration.ts
        - admin-pages.registration.ts
    </FileTree>
  </TabItem>
  <TabItem label="Backend">
    <FileTree>
    - src/features/structure/
      - index.ts
      - structure.routes.ts
      - structure.service.ts
      - structure.types.ts
      - structure.init.ts
      - route.registration.ts
      - service.registration.ts
    </FileTree>
  </TabItem>
</Tabs>

---

## Commands

```bash
npx structure init              # Install module
npx structure init --force      # Force overwrite existing files
npx structure uninstall         # Remove module
npx structure update            # Update to latest templates
npx structure info              # Show module info
```

---

## Next Steps

- [Module Catalogue](/modules/) - Browse other modules
- [Building Modules](/module-starter/building-modules/) - Create your own modules that extend Structure
