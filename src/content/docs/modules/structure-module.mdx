---
title: Structure Module
description: Hierarchical organisation and navigation skeleton for SaaS applications
---

import { Steps, Tabs, TabItem, FileTree, Card, CardGrid, Aside } from '@astrojs/starlight/components';

## Overview

The Structure module provides a unified node model where everything in your application is represented as a node - projects, folders, tags, and connections. It includes dynamic routing, tab/widget registries, and integration points for other modules.

<CardGrid>
  <Card title="Unified Nodes" icon="document">
    Everything is a node - projects, folders, tags, connections
  </Card>
  <Card title="Hierarchical" icon="list-format">
    Materialised path pattern for efficient tree queries
  </Card>
  <Card title="Extensible" icon="puzzle">
    Tab, widget, and card extension registries for other modules
  </Card>
  <Card title="Clean URLs" icon="external">
    No `/structure/` prefix - routes like `/projects/:id`
  </Card>
</CardGrid>

---

## Installation

```bash
npx structure init
```

### Prompts

The installer asks configuration questions. Some prompts are conditional based on previous answers.

#### Container Node Configuration

| Prompt | Default | Condition | Description |
|--------|---------|-----------|-------------|
| `hasContainer` | No | - | Do you need a container type? (e.g., Client that contains Projects) |
| `containerNodeName` | Client | hasContainer=true | Singular name for container type |
| `containerNodePlural` | Clients | hasContainer=true | Plural form |
| `containerSlug` | clients | hasContainer=true | URL slug |
| `containerNodeIcon` | Building2 | hasContainer=true | Lucide icon |

#### Primary Node Configuration

| Prompt | Default | Description |
|--------|---------|-------------|
| `primaryNodeName` | Project | Main entity name (singular) |
| `primaryNodePlural` | Projects | Plural form for navigation |
| `primarySlug` | projects | URL path (e.g., `/projects`) |
| `primaryNodeIcon` | Briefcase | Lucide icon |
| `primaryInMainNav` | Yes | Show in main navigation? (only asked when hasContainer=false) |

#### Feature Flags

| Prompt | Default | Description |
|--------|---------|-------------|
| `enableFolders` | Yes | Enable folders within primary nodes |
| `enableTags` | Yes | Enable tags for categorisation |

### Post-Installation

<Steps>
1. **Generate Prisma client**
   ```bash
   npx prisma generate
   ```

2. **Run migrations**
   ```bash
   npx prisma migrate dev
   ```

3. **Add routes** to `frontend/src/routes.tsx`
   ```typescript
   import { structureRoutes } from '@/features/structure';

   // In protected routes:
   ...structureRoutes,
   ```

4. **Initialize backend** in `server.ts`
   ```typescript
   import { initStructure } from './features/structure';

   await initStructure();
   ```
</Steps>

---

## Features

- **Unified Node Model** - Everything is a node (projects, folders, tags, connections)
- **Hierarchical Structure** - Materialised path for efficient tree queries
- **Dynamic Navigation** - Node types auto-register in sidebar
- **Extensible Registries** - Other modules add tabs, widgets, card extensions
- **Built-in Tabs** - Overview, Info, Children, Connections, Settings (all optional)
- **NodeSelector** - Component for cross-module node reference
- **User Features** - Favorites, archiving, publishing
- **Drag-and-Drop** - Reordering with sort order persistence

---

## Generated Files

<Tabs>
  <TabItem label="Frontend">
    <FileTree>
    - src/features/structure/
      - index.ts
      - routes.config.tsx
      - types/
        - index.ts
        - node.types.ts
        - node-type.types.ts
        - registry.types.ts
      - config/
        - index.ts
        - node-types.registry.ts
        - tabs.registry.ts
        - widgets.registry.ts
        - extensions.registry.ts
        - structure.registry.ts
      - services/
        - structure.service.ts
      - hooks/
        - index.ts
        - useNodes.ts
        - useNode.ts
        - useNodeMutations.ts
        - useNodeTypes.ts
        - useNodeTree.ts
        - useNodeTabs.ts
        - useNodeWidgets.ts
        - useStructureNavigation.ts
      - components/
        - node/ (NodeIcon, NodeCard, NodeForm, etc.)
        - selectors/ (NodeSelector)
        - tree/ (StructureTree)
        - views/ (NodeGrid, NodeList)
        - tabs/ (Overview, Info, Children, etc.)
      - pages/
        - NodeListPage.tsx
        - NodeDetailPage.tsx
        - admin/ (NodeTypesAdminPage)
      - registrations/
        - index.ts
        - tabs.registration.ts
        - navigation.registration.ts
        - routes.registration.ts
        - header-toolbar.registration.ts
        - default-types.registration.ts
        - admin-pages.registration.ts
    </FileTree>
  </TabItem>
  <TabItem label="Backend">
    <FileTree>
    - src/features/structure/
      - index.ts
      - structure.routes.ts
      - structure.service.ts
      - structure.types.ts
      - structure.init.ts
      - route.registration.ts
      - service.registration.ts
    </FileTree>
  </TabItem>
</Tabs>

---

## Database Schema

### structure_node

The universal entity - everything is a node.

| Column | Type | Description |
|--------|------|-------------|
| `id` | String | CUID primary key |
| `userId` | String | Owner |
| `nodeType` | String | References node type slug |
| `name` | String | Display name |
| `slug` | String? | URL identifier |
| `description` | String? | Rich text |
| `data` | JSON | Custom field values |
| `parentId` | String? | Parent node |
| `path` | String? | Materialised path |
| `depth` | Int | Tree depth |
| `sortOrder` | Int | Position |
| `status` | String | active/archived/deleted |
| `isFavorite` | Boolean | User favorite |
| `settings` | JSON | Node-level config |
| `metadata` | JSON | Module extensibility |

### structure_node_type

Configuration per node type.

| Column | Type | Description |
|--------|------|-------------|
| `slug` | String | Unique ID |
| `name` | String | Display name |
| `namePlural` | String | Plural form |
| `moduleId` | String? | Registering module |
| `rules` | JSON | Hierarchy rules |
| `features` | JSON | Enabled features |
| `fields` | JSON | Custom fields |
| `navigation` | JSON | Nav config |
| `isSystem` | Boolean | Admin-only edit |

### structure_settings

User preferences as JSON.

---

## API Endpoints

All prefixed with `/api/v1/structure`.

### Nodes

| Method | Path | Description |
|--------|------|-------------|
| GET | `/nodes` | List with filters |
| GET | `/nodes/:id` | Get single |
| POST | `/nodes` | Create |
| PATCH | `/nodes/:id` | Update |
| DELETE | `/nodes/:id` | Soft delete |
| POST | `/nodes/:id/move` | Move to parent |
| POST | `/nodes/:id/duplicate` | Duplicate |
| POST | `/nodes/:id/archive` | Archive |
| POST | `/nodes/:id/restore` | Restore |
| POST | `/nodes/:id/favorite` | Toggle favorite |
| GET | `/nodes/:id/path` | Ancestor path |
| GET | `/nodes/:id/children` | Children |
| GET | `/nodes/:id/descendants` | All descendants |

### Query Parameters

| Param | Description |
|-------|-------------|
| `type` | Filter by type |
| `parentId` | Filter by parent (`null` for roots) |
| `status` | active/archived/deleted/all |
| `search` | Search name/description |
| `page`, `limit` | Pagination |
| `sortBy`, `sortOrder` | Sorting |

### Node Types

| Method | Path | Description |
|--------|------|-------------|
| GET | `/types` | List types |
| GET | `/types/:slug` | Get config |
| POST | `/types` | Create |
| PATCH | `/types/:slug` | Update |
| DELETE | `/types/:slug` | Delete |

### Other

| Method | Path | Description |
|--------|------|-------------|
| GET | `/tree` | Tree structure |
| POST | `/reorder` | Batch reorder |
| POST | `/connections` | Create connection |
| GET/PATCH | `/settings` | User settings |

---

## Frontend Routes

| Path | Component | Description |
|------|-----------|-------------|
| `/:nodeType` | NodeListPage | List (e.g., `/projects`) |
| `/:nodeType/:nodeId` | NodeDetailPage | Detail page |
| `/:nodeType/:nodeId/:tabId` | NodeDetailPage | Tab deep link |

---

## Structure Registries

The module provides its own registries that extend the starter template's `BaseRegistry` pattern, providing automatic React subscription support via `useSyncExternalStore`.

<Aside type="tip">
All Structure registries extend `BaseRegistry` from `@/config/base.registry`. This gives them standard methods like `register()`, `unregister()`, `get()`, `getAll()`, `has()`, and automatic React hooks via `createRegistryHook()`.
</Aside>

### Node Tab Registry

Register custom tabs for node detail pages. Tabs are automatically filtered based on node type and visibility rules.

```typescript
import { nodeTabRegistry } from '@/features/structure';

nodeTabRegistry.register({
  id: 'my-custom-tab',
  moduleId: 'my-module',
  label: 'Custom',
  icon: 'Star',
  nodeTypes: ['project'],  // or '*' for all
  order: 50,
  component: MyCustomTab,
  isVisible: (node, nodeType) => nodeType.features.myFeature,
});
```

**React Hook:**

```typescript
import { useNodeTabRegistry } from '@/features/structure';

function MyComponent() {
  const tabs = useNodeTabRegistry();  // Auto-updates on registry changes
  return <>{tabs.map(tab => <Tab key={tab.id} {...tab} />)}</>;
}
```

**Custom Filtering:**

```typescript
// Get tabs filtered for a specific node type
const tabsForProject = nodeTabRegistry.getTabsForNodeType(
  'project',
  currentNode,
  nodeTypeConfig
);
```

### Node Widget Registry

Register widgets for the Overview tab. Widgets can be filtered by node type and visibility.

```typescript
import { nodeWidgetRegistry } from '@/features/structure';

nodeWidgetRegistry.register({
  id: 'my-stats-widget',
  moduleId: 'my-module',
  title: 'Statistics',
  nodeTypes: ['project'],
  order: 10,
  component: StatsWidget,
  isVisible: (node, nodeType) => true,
});
```

**React Hook:**

```typescript
import { useNodeWidgetRegistry } from '@/features/structure';

function OverviewTab() {
  const widgets = useNodeWidgetRegistry();
  // ...
}
```

**Custom Filtering:**

```typescript
const widgetsForNode = nodeWidgetRegistry.getWidgetsForNodeType(
  'project',
  currentNode,
  nodeTypeConfig
);
```

### Node Card Extension Registry

Add badges, actions, or other extensions to node cards. Extensions appear in card headers or footers.

```typescript
import { nodeCardExtensionRegistry } from '@/features/structure';

nodeCardExtensionRegistry.register({
  id: 'task-count-badge',
  moduleId: 'tasks',
  type: 'badge',  // 'badge' | 'action' | 'footer'
  nodeTypes: ['project'],
  order: 10,
  component: TaskCountBadge,
});
```

**React Hook:**

```typescript
import { useNodeCardExtensionRegistry } from '@/features/structure';

function NodeCard({ node }) {
  const extensions = useNodeCardExtensionRegistry();
  // ...
}
```

**Custom Filtering:**

```typescript
const extensions = nodeCardExtensionRegistry.getExtensionsForNodeType(
  'project',
  currentNode,
  nodeTypeConfig
);
```

### Registry Pattern Summary

| Registry | Hook | Filter Method |
|----------|------|---------------|
| `nodeTabRegistry` | `useNodeTabRegistry()` | `getTabsForNodeType()` |
| `nodeWidgetRegistry` | `useNodeWidgetRegistry()` | `getWidgetsForNodeType()` |
| `nodeCardExtensionRegistry` | `useNodeCardExtensionRegistry()` | `getExtensionsForNodeType()` |

All registrations extend `RegistryItem`, which requires:
- `id: string` - Unique identifier
- `order?: number` - Sort order (default: 50, lower = earlier)

---

## Using NodeSelector

Let users pick nodes in forms:

```typescript
import { NodeSelector } from '@/features/structure';

function MyForm() {
  const [selectedNode, setSelectedNode] = useState(null);

  return (
    <NodeSelector
      value={selectedNode?.id}
      onChange={setSelectedNode}
      nodeTypes={['project', 'folder']}
      placeholder="Select a project..."
    />
  );
}
```

---

## Custom Node Types

Other modules can register node types:

```typescript
import { structureService } from '@/features/structure';

await structureService.createNodeType({
  slug: 'invoice',
  name: 'Invoice',
  namePlural: 'Invoices',
  icon: 'FileText',
  moduleId: 'billing',
  rules: {
    allowedParents: ['client'],
  },
  fields: [
    {
      id: 'amount',
      type: 'number',
      label: 'Amount',
    },
  ],
});
```

---

## Commands

```bash
npx structure init              # Install
npx structure init --force      # Force overwrite
npx structure uninstall         # Remove
npx structure update            # Update templates
npx structure info              # Show info
```

---

## Next Steps

- [Module Catalogue](/modules/) - Other modules
- [Module Structure Standards](/modules/structure/) - Conventions
- [Building Modules](/module-starter/building-modules/) - Create your own
