---
title: Base Registry Pattern
description: How registries work and how to create custom ones
---

import { Tabs, TabItem, Aside } from '@astrojs/starlight/components';

Registries are how features add things (menu items, widgets, settings pages) without editing core files. This page explains how they work.

---

## What is a Registry?

A registry is a **list that features can add to**. Instead of editing a file to add a menu item, you register it:

```typescript
// Without registry: edit the sidebar file directly (BAD)
const menuItems = [
  { title: 'Dashboard', url: '/dashboard' },
  { title: 'Billing', url: '/billing' },  // ← Added here, editing core file
];

// With registry: register from your feature (GOOD)
navigationRegistry.registerMain({
  id: 'billing',
  title: 'Billing',
  url: '/billing',
  icon: CreditCard,
  order: 40,
});
```

The sidebar component reads from the registry and renders whatever has been registered. Your feature doesn't need to know about other features, and no core files get modified.

---

## How Order Works

**Order controls the position** in the list. Lower numbers come first.

### Visual Example: Navigation

```typescript
// These registrations can happen in any order, in different files:
navigationRegistry.registerMain({ id: 'settings', title: 'Settings', order: 70, ... });
navigationRegistry.registerMain({ id: 'dashboard', title: 'Dashboard', order: 10, ... });
navigationRegistry.registerMain({ id: 'billing', title: 'Billing', order: 40, ... });
navigationRegistry.registerMain({ id: 'projects', title: 'Projects', order: 30, ... });
```

**Result in sidebar (sorted by order):**
```
Dashboard    (order: 10)  ← Lowest, appears first
Projects     (order: 30)
Billing      (order: 40)
Settings     (order: 70)  ← Highest, appears last
```

### Why This Matters

Different modules register at different times (when they load). Without ordering, items would appear in random load order. With `order`, you control exactly where things appear.

### Default Order

If you don't specify `order`, the registry uses its default (usually 10). Items with the same order appear in registration order.

```typescript
// No order specified - uses default of 10
navigationRegistry.registerMain({ id: 'feature-a', title: 'Feature A', ... });
navigationRegistry.registerMain({ id: 'feature-b', title: 'Feature B', ... });

// Both have order 10, so Feature A appears first (registered first)
```

### Order Ranges

Use these ranges so features land in predictable positions:

| Range | What Goes Here | Example |
|-------|---------------|---------|
| 1-9 | Core system items | — |
| 10-29 | Primary features | Dashboard (10), Home (15) |
| 30-49 | Main features | Projects (30), Billing (40) |
| 50-69 | Secondary features | Reports (50), Analytics (60) |
| 70-89 | Settings/Admin | Settings (70), Admin (80) |
| 90-99 | Footer items | Help (90), Logout (95) |
| 100+ | Third-party plugins | Plugin features (100+) |

<Aside type="tip">
Pick a number in the middle of the range (e.g., 40 for main features) so there's room to insert items before or after.
</Aside>

---

## The Registration Pattern

Every registry follows the same pattern:

### 1. Create a Registration File

```typescript
// features/billing/navigation.registration.ts
import { navigationRegistry } from '@/config/navigation.registry';
import { CreditCard } from 'lucide-react';

navigationRegistry.registerMain({
  id: 'billing',
  title: 'Billing',
  url: '/billing',
  icon: CreditCard,
  order: 40,
});
```

### 2. Import It (Side-Effect Import)

```typescript
// features/billing/index.ts
import './navigation.registration';  // ← This line runs the registration

export { BillingPage } from './pages/BillingPage';
```

When the app imports the billing feature, the registration runs automatically. No manual wiring needed.

---

## Common Registries

| Registry | What It Stores | Order Controls |
|----------|---------------|----------------|
| `navigationRegistry` | Menu items | Position in sidebar |
| `dashboardRegistry` | Dashboard widgets | Position in grid |
| `settingsPagesRegistry` | Settings page sections | Position in settings nav |
| `headerToolbarRegistry` | Header buttons/actions | Position in header |
| `adminPagesRegistry` | Admin panel pages | Position in admin nav |

Each works the same way: register items with an `id` and `order`, they appear in sorted order.

---

## BaseRegistry API

All registries extend `BaseRegistry<T>`, which provides these methods:

### Registration

```typescript
register(item, options?)      // Add one item
registerMany(items, options?) // Add multiple items
unregister(id)                // Remove by ID
clear()                       // Remove all
```

### Retrieval

```typescript
get(id)      // Get one item by ID
getAll()     // Get all items (sorted by order)
has(id)      // Check if ID exists
count()      // How many items
getIds()     // List all IDs
```

### Options

```typescript
registry.register(item, {
  allowReplace: true,  // Overwrite existing item with same ID
  silent: true,        // Don't log warning on duplicate
});
```

---

## React Integration

Registries work with React. When items are added/removed, components re-render.

```typescript
// In a component
import { useNavigationRegistry } from '@/config/registry.hooks';

function Sidebar() {
  const items = useNavigationRegistry();  // Re-renders when registry changes

  return (
    <nav>
      {items.map(item => (
        <Link key={item.id} to={item.url}>{item.title}</Link>
      ))}
    </nav>
  );
}
```

---

## Creating a Custom Registry

If you need a new registry (e.g., for a widget system in your module):

### Step 1: Define the Item Type

```typescript
// my-widget.registry.ts
import { BaseRegistry, createRegistryHook, type RegistryItem } from './base.registry';

interface MyWidget extends RegistryItem {
  id: string;
  title: string;
  component: React.ComponentType;
  order?: number;  // Optional - has default
}
```

### Step 2: Create the Registry Class

```typescript
class MyWidgetRegistry extends BaseRegistry<MyWidget> {
  constructor() {
    super('MyWidgetRegistry', 50);  // Name for logs, default order
  }

  // Add custom methods if needed
  getByTitle(title: string): MyWidget | undefined {
    return this.getAll().find(w => w.title === title);
  }
}
```

### Step 3: Export Singleton and Hook

```typescript
// Single instance used everywhere
export const myWidgetRegistry = new MyWidgetRegistry();

// React hook for components
export const useMyWidgets = createRegistryHook(myWidgetRegistry);

// Export the type
export type { MyWidget };
```

### Step 4: Use It

```typescript
// Register a widget
myWidgetRegistry.register({
  id: 'sales-chart',
  title: 'Sales Chart',
  component: SalesChart,
  order: 20,
});

// In a component
function WidgetGrid() {
  const widgets = useMyWidgets();
  return widgets.map(w => <w.component key={w.id} />);
}
```

---

## Frontend vs Backend

<Tabs>
  <TabItem label="Frontend">
Has React integration:
- `subscribe()` and `getSnapshot()` for React hooks
- `createRegistryHook()` utility
- Components re-render when registry changes

```typescript
import { BaseRegistry, createRegistryHook } from '@/config/base.registry';

class MyRegistry extends BaseRegistry<MyItem> { }
export const myRegistry = new MyRegistry();
export const useMyRegistry = createRegistryHook(myRegistry);
```
  </TabItem>
  <TabItem label="Backend">
No React, same registration API:
- Same `register()`, `getAll()`, etc.
- Used for routes, services

```typescript
import { BaseRegistry } from '../config/base.registry.js';

class MyRegistry extends BaseRegistry<MyItem> { }
export const myRegistry = new MyRegistry();
// No hook needed - backend doesn't use React
```
  </TabItem>
</Tabs>

---

## When NOT to Use BaseRegistry

Some registries need special behaviour:

| Registry | Why Different |
|----------|--------------|
| `routeRegistry` | Needs Express mounting, API versioning |
| `serviceRegistry` | Needs TypeScript type augmentation |
| `filterRegistry` | Transforms data through a chain (pipeline pattern) |
| `actionRegistry` | Runs side effects, not a collection |

These implement their own patterns. Use `BaseRegistry` for simple "collection of items" registries.

---

## Quick Reference

```typescript
// Register
registry.register({ id: 'my-item', order: 30, ...otherFields });

// Get all (sorted)
const items = registry.getAll();

// Get one
const item = registry.get('my-item');

// Check exists
if (registry.has('my-item')) { ... }

// Remove
registry.unregister('my-item');

// In React component
const items = useMyRegistry();  // Auto re-renders on change
```
