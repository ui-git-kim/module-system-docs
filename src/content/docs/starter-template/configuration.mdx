---
title: Configuration
description: Environment variables and security
---

import { Tabs, TabItem, Aside } from '@astrojs/starlight/components';

## Initial Setup

The [create-app script](/starter-template/create-script/) configures most environment variables automatically. This page covers what each variable does and how to keep them secure.

---

## Environment Files

<Tabs>
  <TabItem label="Frontend (.env)">
```env
VITE_NEON_AUTH_URL=https://xxx.neonauth.region.aws.neon.tech/neondb/auth
VITE_API_URL=http://localhost:3100
VITE_APP_NAME=My App
```
  </TabItem>
  <TabItem label="Backend (.env)">
```env
# Database (SENSITIVE - contains credentials)
DATABASE_URL="postgresql://user:pass@ep-xxx-pooler.region.aws.neon.tech/neondb?sslmode=require"
DIRECT_DATABASE_URL="postgresql://user:pass@ep-xxx.region.aws.neon.tech/neondb?sslmode=require"
DATABASE_ADAPTER=neon

# Auth
NEON_AUTH_URL="https://xxx.neonauth.region.aws.neon.tech/neondb/auth"

# Server
PORT=3100
NODE_ENV=development
FRONTEND_URL=http://localhost:5173

# Optional
DEBUG_PRISMA=false
DB_QUERY_TIMEOUT=10000
SHUTDOWN_TIMEOUT=10000
```
  </TabItem>
</Tabs>

---

## Security

<Aside type="danger" title="Never commit .env files">
The `.env` files contain database credentials and are git-ignored by default. If you accidentally commit them, rotate your credentials immediately in the Neon dashboard.
</Aside>

### What's Sensitive?

| Variable | Sensitive? | Why |
|----------|------------|-----|
| `DATABASE_URL` | **Yes** | Contains username and password |
| `DIRECT_DATABASE_URL` | **Yes** | Contains username and password |
| `NEON_AUTH_URL` | No | Public endpoint, no credentials |
| `VITE_NEON_AUTH_URL` | No | Same - public endpoint |
| `VITE_API_URL` | No | Just a URL |
| `VITE_APP_NAME` | No | Display text |
| `PORT`, `NODE_ENV`, etc. | No | Configuration only |

### Keeping .env Safe

1. **Never commit .env files** - They're in `.gitignore` by default
2. **Don't share .env files** - Use secure channels if you must share credentials
3. **Use separate credentials per environment** - Different databases for dev/staging/prod
4. **Rotate credentials if exposed** - Neon dashboard → Connection Details → Reset password

### If You Accidentally Commit Credentials

1. **Rotate immediately** - Go to Neon dashboard and reset the password
2. **Remove from git history** (optional but recommended):
   ```bash
   # Remove file from all commits
   git filter-branch --force --index-filter \
     "git rm --cached --ignore-unmatch backend/.env" \
     --prune-empty --tag-name-filter cat -- --all

   # Force push (coordinate with team)
   git push origin --force --all
   ```
3. **Verify .gitignore** includes `.env` files

---

## Production Deployment

A typical production setup:

```
┌─────────────────────────────────────┐
│     Web Hosting (Frontend)          │
│     Static files from dist/         │
│     (cPanel, nginx, CDN, etc.)      │
└──────────────────┬──────────────────┘
                   │ API calls
                   ▼
┌─────────────────────────────────────┐
│        VPS (Backend)                │
│     Express API + Prisma            │
│     (Node.js + PM2 or Docker)       │
└──────────────────┬──────────────────┘
                   │
        ┌──────────┴──────────┐
        ▼                     ▼
┌───────────────┐    ┌───────────────┐
│     Neon      │    │ S3-Compatible │
│   PostgreSQL  │    │    Storage    │
└───────────────┘    └───────────────┘
```

### Frontend (Static Files)

The frontend builds to static files - no Node.js required:

```bash
cd frontend
npm run build
# Upload dist/ folder to your web host
```

Works with any static hosting: traditional web hosting (cPanel), Cloudflare Pages, nginx, or a CDN.

### Backend (Node.js)

The backend needs Node.js. Options:

**PM2 (recommended for VPS):**
```bash
# ecosystem.config.js
module.exports = {
  apps: [{
    name: 'api',
    script: 'dist/app.js',
    env_production: {
      NODE_ENV: 'production',
      PORT: 3100,
      // ... other vars
    }
  }]
};

pm2 start ecosystem.config.js --env production
```

**Docker:**
```bash
docker run -d \
  --env-file .env.production \
  -p 3100:3100 \
  your-backend-image
```

**Systemd service:**
```ini
[Service]
EnvironmentFile=/etc/myapp/backend.env
ExecStart=/usr/bin/node /var/www/myapp/backend/dist/app.js
```

### Production Environment Variables

For production, set variables via your deployment method rather than `.env` files:

| Method | How to Set Variables |
|--------|---------------------|
| PM2 | `ecosystem.config.js` → `env_production` |
| Docker | `--env-file` flag or Docker Compose `env_file:` |
| Systemd | `EnvironmentFile=` directive |
| cPanel/Plesk | Usually in the Node.js app settings |

### Storage (Optional)

If you need file uploads, add S3-compatible storage (Wasabi, Backblaze B2, MinIO, etc.):

```env
# Storage (add to backend .env)
S3_ENDPOINT=https://s3.your-provider.com
S3_REGION=us-east-1
S3_BUCKET=your-bucket
S3_ACCESS_KEY=your-access-key     # SENSITIVE
S3_SECRET_KEY=your-secret-key     # SENSITIVE
```

---

## Variable Reference

### Frontend

| Variable | Required | Description |
|----------|----------|-------------|
| `VITE_NEON_AUTH_URL` | Yes | Neon Auth endpoint for sign-in UI |
| `VITE_API_URL` | Yes | Backend API base URL |
| `VITE_APP_NAME` | No | Display name in the app |

<Aside type="note">
Frontend variables prefixed with `VITE_` are exposed to the browser. Never put secrets in frontend env vars.
</Aside>

### Backend

| Variable | Required | Description |
|----------|----------|-------------|
| `DATABASE_URL` | Yes | Pooled connection string (has `-pooler`) |
| `DIRECT_DATABASE_URL` | Yes | Direct connection for migrations |
| `DATABASE_ADAPTER` | No | `neon` (default) or `pg` |
| `NEON_AUTH_URL` | Yes | Auth URL for JWT verification |
| `PORT` | No | Server port (default: 3100) |
| `NODE_ENV` | No | `development` or `production` |
| `FRONTEND_URL` | Yes | CORS allowed origin |
| `DEBUG_PRISMA` | No | Enable query logging |
| `DB_QUERY_TIMEOUT` | No | Query timeout in ms |
| `SHUTDOWN_TIMEOUT` | No | Graceful shutdown timeout |

---

## Database URLs

Neon provides two connection types:

| Type | URL Pattern | Use For |
|------|-------------|---------|
| **Pooled** | `ep-xxx-pooler.region...` | App queries (scales better) |
| **Direct** | `ep-xxx.region...` | Migrations (required by Prisma) |

Both URLs are in the Prisma snippet from your Neon dashboard.

### Database Adapter

```env
# For Neon serverless (default)
DATABASE_ADAPTER=neon

# For standard PostgreSQL (self-hosted, RDS, etc.)
DATABASE_ADAPTER=pg
```

---

## Auth URL Matching

The Neon Auth URL must match **exactly** between frontend and backend:

```env
# Frontend
VITE_NEON_AUTH_URL=https://xxx.neonauth.region.aws.neon.tech/neondb/auth

# Backend - must be identical
NEON_AUTH_URL=https://xxx.neonauth.region.aws.neon.tech/neondb/auth
```

If they don't match, JWT verification will fail and you'll see 401 errors.

---

## Prisma Commands

```bash
cd backend

# Create and apply migration
npx prisma migrate dev --name describe_change

# Apply migrations (production)
npx prisma migrate deploy

# Regenerate client after schema changes
npx prisma generate

# Open database GUI
npx prisma studio
```

---

## Troubleshooting

### 401 Unauthorized Errors

1. Check `NEON_AUTH_URL` matches exactly in both `.env` files
2. Verify the URL includes the full path (e.g., `/neondb/auth`)
3. Test JWKS endpoint: `<NEON_AUTH_URL>/.well-known/jwks.json`

### Database Connection Failed

1. Check `DATABASE_URL` has correct credentials
2. Verify your IP is allowed in Neon (Project Settings → IP Allow)
3. Ensure `?sslmode=require` is in the URL

### Prisma Migrate Fails

Use `DIRECT_DATABASE_URL` (without `-pooler`) for migrations. The pooled URL doesn't support the extended session needed for migrations.

### CORS Errors

Check `FRONTEND_URL` in backend `.env` matches your frontend's domain exactly (including `https://`).

---

## Next Steps

- [Built-in Features](/starter-template/features/) - What's included
- [Updating](/starter-template/updating/) - Template updates
