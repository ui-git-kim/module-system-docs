---
title: User Feature
description: User profiles, avatars, preferences, and settings
tableOfContents:
  maxHeadingLevel: 2
---

import { Aside, Steps, Tabs, TabItem } from '@astrojs/starlight/components';

The user feature provides profile management, avatars, preferences, and GDPR-compliant data handling.

---

## Overview

The user feature includes:

- **Profile** - Name, bio, avatar management
- **Preferences** - Theme, timezone, language, notifications
- **Settings Pages** - Extensible settings panel at `/settings`
- **GDPR Compliance** - Data export and account deletion

---

## File Structure

```
frontend/src/features/user/
├── index.ts                        # Public exports
├── types.ts                        # TypeScript types
├── routes.config.tsx               # Settings routes
├── navigation.registration.ts      # Registers "Settings" in user menu
├── settings-pages.registration.ts  # Registers settings pages
├── hooks/
│   └── useUserProfile.tsx          # Profile context and hook
├── services/
│   └── user.service.ts             # API client
├── pages/
│   ├── DynamicSettingsPage.tsx     # Settings router
│   ├── PersonalInformationPage.tsx # Profile settings
│   ├── SecurityPage.tsx            # Password, 2FA
│   ├── PreferencesPage.tsx         # Theme, notifications
│   ├── IntegrationsPage.tsx        # Third-party services
│   ├── BillingPage.tsx             # Subscription (placeholder)
│   └── DataPrivacyPage.tsx         # GDPR exports/deletion
└── components/
    ├── SettingsLayout.tsx          # Settings sidebar layout
    ├── UserAvatar.tsx              # Avatar component
    └── settings/
        ├── SettingsComponents.tsx  # Reusable settings UI
        └── AvatarColorPicker.tsx   # Color picker

backend/src/features/user/
├── index.ts                        # Exports + registrations
├── user.types.ts                   # Types and Zod schemas
├── user.service.ts                 # Business logic
├── user.routes.ts                  # API endpoints
├── route.registration.ts           # Route registry
└── service.registration.ts         # Service registry
```

---

## User Profile

### Profile Context

The `UserProfileProvider` makes profile data available app-wide:

```tsx
import { useUserProfile, UserProfileProvider } from '@/features/user';

// In a parent component
function App() {
  return (
    <UserProfileProvider>
      <Dashboard />
    </UserProfileProvider>
  );
}

// In any child component
function MyComponent() {
  const { profile, isLoading, error, updateProfile, refetch } = useUserProfile();

  if (isLoading) return <Spinner />;

  return <div>Hello, {profile?.name || profile?.email}</div>;
}
```

### Profile Data Structure

```typescript
interface UserProfile {
  id: string;
  email: string;
  role: 'user' | 'admin' | 'managed';
  name: string | null;
  avatarUrl: string | null;
  bio: string | null;
  preferences: UserPreferences;
  createdAt: string;
  updatedAt: string;
}
```

### Updating Profile

```tsx
const { updateProfile } = useUserProfile();

await updateProfile({
  name: 'New Name',
  bio: 'About me...',
});
```

---

## User Avatar

The `UserAvatar` component handles avatar display with intelligent fallbacks:

### Avatar Priority Order

1. **Custom uploaded image** (`profile.avatarUrl`)
2. **User-chosen color** (shows initials on colored background)
3. **OAuth/Google image** (only if no custom avatar or chosen color)

### Usage

```tsx
import { UserAvatar } from '@/features/user';

// Basic usage - auto-loads current user data
<UserAvatar />

// Size variants: sm, md, lg, xl
<UserAvatar size="lg" />

// Rounded variants: full (circle), lg (rounded corners)
<UserAvatar size="md" rounded="lg" />

// Override for previews
<UserAvatar imageUrl={previewUrl} color="#3B82F6" />
```

### Avatar Color Picker

Users can choose a custom avatar color:

```tsx
import { AvatarColorPicker } from '@/features/user/components/settings/AvatarColorPicker';

<AvatarColorPicker
  value={color}
  onChange={(newColor) => setColor(newColor)}
/>
```

The picker provides 10 preset colours plus a custom colour option.

---

## User Preferences

Preferences are stored as JSON and support partial updates:

```typescript
interface UserPreferences {
  theme?: 'light' | 'dark' | 'system';
  timezone?: string;
  language?: string;
  avatarColor?: string;
  dashboardWidgets?: WidgetVisibility[];
  emailNotifications?: boolean;
  marketingEmails?: boolean;
  productUpdates?: boolean;
}
```

### Updating Preferences

```tsx
const { updatePreferences } = useUserProfile();

// Partial update - only changes specified fields
await updatePreferences({
  theme: 'dark',
  emailNotifications: false,
});
```

<Aside type="note">
  Preferences use shallow merge - only the fields you specify are updated.
</Aside>

---

## Settings Pages

### Built-in Pages

| Page | Path | Purpose |
|------|------|---------|
| Personal Information | `/settings/personal-info` | Profile, avatar, display name |
| Security | `/settings/security` | Password, 2FA, sessions |
| Preferences | `/settings/preferences` | Theme, notifications |
| Integrations | `/settings/integrations` | Third-party services |
| Billing | `/settings/billing` | Subscription (placeholder) |
| Data & Privacy | `/settings/data` | Export, deletion |

### Adding Settings Pages

Features can register custom settings pages:

```tsx
// features/my-feature/settings-pages.registration.ts
import { settingsPagesRegistry } from '@/config/settings-pages.registry';
import { MySettingsContent } from './pages/MySettingsPage';
import { MyIcon } from 'lucide-react';

settingsPagesRegistry.register({
  id: 'my-settings',           // URL: /settings/my-settings
  title: 'My Settings',
  description: 'Configure my feature',
  icon: MyIcon,
  component: MySettingsContent, // Content only, layout automatic
  order: 60,
});
```

### Settings Components

Use the reusable settings components for consistent UI:

```tsx
import {
  SettingsRow,
  SettingsRowStacked,
  SettingsRowWithDropdown,
  SettingsDivider,
  SettingsSectionHeader,
} from '@/features/user/components/settings/SettingsComponents';

function MySettingsPage() {
  return (
    <div className="space-y-6">
      <SettingsSectionHeader
        title="Notifications"
        description="Configure how you receive notifications"
      />

      <SettingsRow
        label="Email notifications"
        description="Receive email updates"
      >
        <Switch checked={enabled} onCheckedChange={setEnabled} />
      </SettingsRow>

      <SettingsDivider />

      <SettingsRowWithDropdown
        label="Frequency"
        description="How often to send digests"
        options={[
          { value: 'daily', label: 'Daily' },
          { value: 'weekly', label: 'Weekly' },
        ]}
        value={frequency}
        onValueChange={setFrequency}
      />
    </div>
  );
}
```

---

## Role Helpers

Check user roles easily:

```tsx
const { role, isAdmin, isManaged } = useUserProfile();

if (isAdmin) {
  // Show admin features
}

if (role === 'managed') {
  // Check specific permissions
}
```

---

## GDPR Compliance

### Data Export

Users can export all their data:

```tsx
import { userService } from '@/features/user';

async function handleExport() {
  const result = await userService.requestDataExport();
  // result.downloadUrl contains the data
}
```

Rate limit: One export per hour.

### Account Deletion

Users can delete their account from Data & Privacy settings:

```tsx
import { userService } from '@/features/user';

async function handleDelete() {
  if (confirm('Are you sure? This cannot be undone.')) {
    await userService.deleteAccount();
    // Redirect to sign out
  }
}
```

<Aside type="caution">
  Account deletion is permanent and cannot be undone. All user data is removed.
</Aside>

---

## API Endpoints

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/v1/user` | GET | Get current user profile |
| `/api/v1/user` | PATCH | Update profile (name, bio, avatarUrl) |
| `/api/v1/user/preferences` | PATCH | Update preferences |
| `/api/v1/user/export` | POST | Request data export |
| `/api/v1/user` | DELETE | Delete account |

---

## Database Schema

```prisma
model User {
  id          String   @id           // From Neon Auth (JWT sub)
  email       String   @unique
  role        String   @default("user")
  name        String?
  avatarUrl   String?                 // URL or base64
  bio         String?
  preferences Json     @default("{}")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

---

## Extending Personal Info

Add custom fields to the Personal Information page:

```tsx
// features/my-feature/personal-info.registration.ts
import { personalInfoFieldsRegistry } from '@/config/personal-info-fields.registry';

personalInfoFieldsRegistry.register({
  id: 'company',
  type: 'text',
  label: 'Company',
  placeholder: 'Your company name',
  category: 'professional',
  order: 10,
  getValue: (profile) => profile.preferences?.company || '',
  setValue: (value, updatePreferences) => {
    updatePreferences({ company: value });
  },
});
```

---

## Troubleshooting

### Profile Not Loading

1. Check `UserProfileProvider` is in component tree
2. Verify user is authenticated
3. Check API endpoint returns 200

### Avatar Not Updating

1. Verify `avatarUrl` is being saved correctly
2. Check for base64 size limits
3. Ensure `UserAvatar` is receiving correct props

### Preferences Lost

1. Preferences use shallow merge - don't overwrite entire object
2. Check Zod validation isn't rejecting unknown fields
3. Verify backend returns updated preferences

---

## Next Steps

- [Authentication](/starter-template/auth-feature/) - How auth works
- [Admin Feature](/starter-template/admin-feature/) - User management
- [Dashboard](/starter-template/dashboard-feature/) - Widget system
