---
title: User Feature
description: User profiles, avatars, preferences, and settings
---

import { Aside, Steps, Tabs, TabItem } from '@astrojs/starlight/components';

The user feature provides profile management, avatars, preferences, and GDPR-compliant data handling.

---

## Overview

The user feature includes:

- **Profile** - Name, bio, avatar management
- **Preferences** - Theme, timezone, language, notifications
- **Settings Pages** - Extensible settings panel at `/settings`
- **GDPR Compliance** - Data export and account deletion

---

## Terminology: Settings vs Preferences

The template distinguishes between three types of configuration:

| Term | What It Is | Who Controls | Where Stored |
|------|-----------|--------------|--------------|
| **User Preferences** | How things look and feel for the user (theme, language, notification toggles) | Each user | `user.preferences` JSON field |
| **User Settings** | Account-related pages (security, privacy, billing, integrations) | Each user | Various (depends on setting type) |
| **Admin Settings** | App-wide configuration that affects all users (branding, navigation, features) | Admins only | `AppSettings` model |

**User Preferences** are personal customisations:
- Theme (light/dark/system)
- Language and timezone
- Email notification toggles
- Dashboard widget visibility
- Module-specific behaviour preferences

**User Settings Pages** are account management:
- Personal Information (profile details)
- Security (password, 2FA, sessions)
- Data & Privacy (export, deletion)
- Billing (subscription management)
- Integrations (connected services)

**Admin Settings** control the app for everyone:
- App name and logo
- Navigation overrides
- Feature flags
- User management

<Aside type="tip">
When building modules: register preference sections for "how it works for me" options (via `preferencesRegistry`), and register settings pages for "account management" type features (via `settingsPagesRegistry`).
</Aside>

---

## File Structure

```
frontend/src/features/user/
├── index.ts                        # Public exports
├── types.ts                        # TypeScript types
├── routes.config.tsx               # Settings routes
├── navigation.registration.ts      # Registers "Settings" in user menu
├── settings-pages.registration.ts  # Registers settings pages
├── hooks/
│   └── useUserProfile.tsx          # Profile context and hook
├── services/
│   └── user.service.ts             # API client
├── pages/
│   ├── DynamicSettingsPage.tsx     # Settings router
│   ├── PersonalInformationPage.tsx # Profile settings
│   ├── SecurityPage.tsx            # Password, 2FA
│   ├── PreferencesPage.tsx         # Theme, notifications
│   ├── IntegrationsPage.tsx        # Third-party services
│   ├── BillingPage.tsx             # Subscription (placeholder)
│   └── DataPrivacyPage.tsx         # GDPR exports/deletion
└── components/
    ├── SettingsLayout.tsx          # Settings sidebar layout
    ├── UserAvatar.tsx              # Avatar component
    └── settings/
        ├── SettingsComponents.tsx  # Reusable settings UI
        └── AvatarColorPicker.tsx   # Color picker

backend/src/features/user/
├── index.ts                        # Exports + registrations
├── user.types.ts                   # Types and Zod schemas
├── user.service.ts                 # Business logic
├── user.routes.ts                  # API endpoints
├── route.registration.ts           # Route registry
└── service.registration.ts         # Service registry
```

---

## User Profile

### Profile Context

The `UserProfileProvider` makes profile data available app-wide:

```tsx
import { useUserProfile, UserProfileProvider } from '@/features/user';

// In a parent component
function App() {
  return (
    <UserProfileProvider>
      <Dashboard />
    </UserProfileProvider>
  );
}

// In any child component
function MyComponent() {
  const { profile, isLoading, error, updateProfile, refetch } = useUserProfile();

  if (isLoading) return <Spinner />;

  return <div>Hello, {profile?.name || profile?.email}</div>;
}
```

### Profile Data Structure

```typescript
interface UserProfile {
  id: string;
  email: string;
  role: 'user' | 'admin' | 'managed';
  name: string | null;
  avatarUrl: string | null;
  bio: string | null;
  preferences: UserPreferences;
  createdAt: string;
  updatedAt: string;
}
```

### Updating Profile

```tsx
const { updateProfile } = useUserProfile();

await updateProfile({
  name: 'New Name',
  bio: 'About me...',
});
```

---

## User Avatar

The `UserAvatar` component handles avatar display with intelligent fallbacks:

### Avatar Priority Order

1. **Custom uploaded image** (`profile.avatarUrl`)
2. **User-chosen color** (shows initials on colored background)
3. **OAuth/Google image** (only if no custom avatar or chosen color)

### Usage

```tsx
import { UserAvatar } from '@/features/user';

// Basic usage - auto-loads current user data
<UserAvatar />

// Size variants: sm, md, lg, xl
<UserAvatar size="lg" />

// Rounded variants: full (circle), lg (rounded corners)
<UserAvatar size="md" rounded="lg" />

// Override for previews
<UserAvatar imageUrl={previewUrl} color="#3B82F6" />
```

### Avatar Color Picker

Users can choose a custom avatar color:

```tsx
import { AvatarColorPicker } from '@/features/user/components/settings/AvatarColorPicker';

<AvatarColorPicker
  value={color}
  onChange={(newColor) => setColor(newColor)}
/>
```

The picker provides 10 preset colours plus a custom colour option.

---

## User Preferences

Preferences are stored as JSON and support partial updates:

```typescript
interface UserPreferences {
  theme?: 'light' | 'dark' | 'system';
  timezone?: string;
  language?: string;
  avatarColor?: string;
  dashboardWidgets?: WidgetVisibility[];
  emailNotifications?: boolean;
  marketingEmails?: boolean;
  productUpdates?: boolean;
}
```

### Updating Preferences

```tsx
const { updatePreferences } = useUserProfile();

// Partial update - only changes specified fields
await updatePreferences({
  theme: 'dark',
  emailNotifications: false,
});
```

<Aside type="note">
  Preferences use shallow merge - only the fields you specify are updated.
</Aside>

---

## Settings Pages

### Built-in Pages

| Page | Path | Purpose |
|------|------|---------|
| Personal Information | `/settings/personal-info` | Profile, avatar, display name |
| Security | `/settings/security` | Password, 2FA, sessions |
| Preferences | `/settings/preferences` | Theme, notifications |
| Integrations | `/settings/integrations` | Third-party services |
| Billing | `/settings/billing` | Subscription (placeholder) |
| Data & Privacy | `/settings/data` | Export, deletion |

### Adding Settings Pages

Features can register custom settings pages:

```tsx
// features/my-feature/settings-pages.registration.ts
import { settingsPagesRegistry } from '@/config/settings-pages.registry';
import { MySettingsContent } from './pages/MySettingsPage';
import { MyIcon } from 'lucide-react';

settingsPagesRegistry.register({
  id: 'my-settings',           // URL: /settings/my-settings
  title: 'My Settings',
  description: 'Configure my feature',
  icon: MyIcon,
  component: MySettingsContent, // Content only, layout automatic
  order: 60,
});
```

### Settings Components

**All settings pages MUST use these components** for visual consistency. Import from:

```tsx
import {
  SettingsRow,
  SettingsRowStacked,
  SettingsRowWithDropdown,
  SettingsDropdownRow,
  SettingsToggleRow,
  SettingsToggleGroup,
  SettingsSectionHeader,
  SettingsDivider,
  SettingsNote,
  SettingsPlanCard,
  SettingsProviderCard,
  SettingsProviderGroup,
  SettingsDisabledRow,
  SettingsDangerBox,
  SettingsTable,
} from '@/features/user/components/settings/SettingsComponents';
```

#### Layout Components

| Component | Purpose |
|-----------|---------|
| `SettingsSectionHeader` | Section title with optional description and action |
| `SettingsDivider` | Dashed line separator between sections |
| `SettingsNote` | Info box for additional context |

```tsx
<SettingsSectionHeader
  title="Notifications"
  description="Configure how you receive notifications"
  action={<Button size="sm">Configure</Button>}
/>

<SettingsDivider />

<SettingsNote>
  Changes take effect immediately across all devices.
</SettingsNote>
```

#### Row Components

| Component | Use When |
|-----------|----------|
| `SettingsRow` | Label left, action right (most common) |
| `SettingsRowStacked` | Content below label, action top-right |
| `SettingsRowWithDropdown` | Full-width dropdown fills available space |
| `SettingsDropdownRow` | Dropdown aligned to right side |
| `SettingsToggleRow` | Single toggle with label |
| `SettingsDisabledRow` | Greyed out with "Coming soon" badge |

```tsx
{/* Basic row with action on right */}
<SettingsRow
  label="Two-factor authentication"
  description="Add an extra layer of security"
  action={<Button variant="outline" size="sm">Enable</Button>}
/>

{/* Row with content stacked below */}
<SettingsRowStacked
  label="Connected accounts"
  description="Manage your linked accounts"
  action={<Button size="sm">Add</Button>}
>
  <ProviderList />
</SettingsRowStacked>

{/* Full-width dropdown */}
<SettingsRowWithDropdown
  label="Language"
  description="Affects date formats"
  value={language}
  options={[
    { value: 'en-AU', label: 'English (Australian)' },
    { value: 'en-US', label: 'English (US)' },
  ]}
  onChange={setLanguage}
  icon={<Globe className="h-4 w-4" />}
/>

{/* Right-aligned dropdown */}
<SettingsDropdownRow
  label="Timezone"
  value={timezone}
  options={timezoneOptions}
  onChange={setTimezone}
/>

{/* Single toggle */}
<SettingsToggleRow
  label="Email notifications"
  description="Receive updates via email"
  checked={emailEnabled}
  onChange={setEmailEnabled}
/>

{/* Disabled/coming soon */}
<SettingsDisabledRow
  label="Passkeys"
  description="Sign in without a password"
  reason="Passkey support is coming in Q2 2026"
  badge="Coming soon"
/>
```

#### Toggle Group

For multiple related toggles in a compact card:

```tsx
<SettingsToggleGroup
  items={[
    {
      id: 'security',
      label: 'Security alerts',
      description: 'Important account notifications',
      checked: notifications.security,
    },
    {
      id: 'updates',
      label: 'Product updates',
      description: 'News about new features',
      checked: notifications.updates,
    },
    {
      id: 'marketing',
      label: 'Marketing',
      description: 'Tips and special offers',
      checked: notifications.marketing,
    },
  ]}
  onChange={(id, checked) => handleToggle(id, checked)}
/>
```

#### Specialised Components

**Plan Card** - For billing/subscription display:

```tsx
<SettingsPlanCard
  planName="Pro"
  status="Active"
  isActive={true}
  price="$29/month"
  action={<Button>Manage</Button>}
/>
```

**Provider Card** - For connected accounts/integrations:

```tsx
<SettingsProviderGroup>
  <SettingsProviderCard
    icon={<GoogleIcon className="h-5 w-5" />}
    name="Google"
    description="Connected 21 Jan 2026"
    badge={<Badge variant="secondary">Connected</Badge>}
    action={<Button variant="outline" size="sm">Disconnect</Button>}
  />
</SettingsProviderGroup>
```

**Danger Box** - For destructive actions:

```tsx
<SettingsDangerBox
  label="Delete account"
  description="Permanently remove your account and all data"
  buttonLabel="Delete account"
  onAction={handleDelete}
  isLoading={isDeleting}
/>
```

**Table** - For sessions, invoices, API keys:

```tsx
<SettingsTable
  columns={[
    { key: 'device', header: 'Device', render: (s) => s.device },
    { key: 'location', header: 'Location', render: (s) => s.location },
    { key: 'lastActive', header: 'Last active', render: (s) => s.lastActive },
  ]}
  data={sessions}
  getRowKey={(s) => s.id}
  isHighlighted={(s) => s.isCurrent}
  highlightBadge="Current"
  actions={[
    { label: 'Revoke', onClick: handleRevoke, variant: 'destructive' },
  ]}
  emptyMessage="No active sessions"
/>
```

#### Integration Card

For the Integrations page, use the dedicated `IntegrationCard`:

```tsx
import { IntegrationCard } from '@/features/user/components/settings/IntegrationCard';

<IntegrationCard
  name="Google Drive"
  description="Import and export files"
  icon={GoogleDriveIcon}
  status="connected"
  accountInfo="user@gmail.com"
  onDisconnect={handleDisconnect}
/>
```

<Aside type="danger">
  **Do not create custom settings UI.** Always use these components to ensure visual consistency across all settings pages. If you need a component that doesn't exist, consider adding it to `SettingsComponents.tsx` for reuse.
</Aside>

---

## Role Helpers

Check user roles easily:

```tsx
const { role, isAdmin, isManaged } = useUserProfile();

if (isAdmin) {
  // Show admin features
}

if (role === 'managed') {
  // Check specific permissions
}
```

---

## GDPR Compliance

### Data Export

Users can export all their data:

```tsx
import { userService } from '@/features/user';

async function handleExport() {
  const result = await userService.requestDataExport();
  // result.downloadUrl contains the data
}
```

Rate limit: One export per hour.

### Account Deletion

Users can delete their account from Data & Privacy settings:

```tsx
import { userService } from '@/features/user';

async function handleDelete() {
  if (confirm('Are you sure? This cannot be undone.')) {
    await userService.deleteAccount();
    // Redirect to sign out
  }
}
```

<Aside type="caution">
  Account deletion is permanent and cannot be undone. All user data is removed.
</Aside>

---

## API Endpoints

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/v1/user` | GET | Get current user profile |
| `/api/v1/user` | PATCH | Update profile (name, bio, avatarUrl) |
| `/api/v1/user/preferences` | PATCH | Update preferences |
| `/api/v1/user/export` | POST | Request data export |
| `/api/v1/user` | DELETE | Delete account |

---

## Database Schema

```prisma
model User {
  id          String   @id           // From Neon Auth (JWT sub)
  email       String   @unique
  role        String   @default("user")
  name        String?
  avatarUrl   String?                 // URL or base64
  bio         String?
  preferences Json     @default("{}")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

---

## Extending User Settings (For Modules)

Modules can extend user settings through several registries. All extensions appear automatically in the appropriate settings pages.

### Adding Personal Info Fields

Add custom fields to the Personal Information page (`/settings/personal-info`):

```tsx
// features/my-feature/personal-info.registration.ts
import { personalInfoFieldsRegistry } from '@/config/personal-info-fields.registry';

// Text field
personalInfoFieldsRegistry.register({
  id: 'company',
  type: 'text',
  label: 'Company',
  placeholder: 'Your company name',
  description: 'Optional company affiliation',
  category: 'work',
  order: 10,
});

// Select field
personalInfoFieldsRegistry.register({
  id: 'companySize',
  type: 'select',
  label: 'Company Size',
  options: [
    { value: '1-10', label: '1-10 employees' },
    { value: '11-50', label: '11-50 employees' },
    { value: '51-200', label: '51-200 employees' },
    { value: '200+', label: '200+ employees' },
  ],
  category: 'work',
  order: 20,
});

// Register a category header (optional)
personalInfoFieldsRegistry.registerCategory({
  id: 'work',
  label: 'Work Information',
  description: 'Professional details',
  order: 10,
});
```

**Field types:** `text`, `textarea`, `select`, `custom`

**Storage:** Fields are stored in `user.preferences` JSON by default. Values are automatically saved when changed.

### Adding Preference Sections

Add entire sections to the Preferences page (`/settings/preferences`):

```tsx
// features/ai-chat/preferences.registration.ts
import { preferencesRegistry } from '@/config/preferences.registry';
import { AIChatPreferences } from './components/AIChatPreferences';

preferencesRegistry.register({
  id: 'ai-chat',
  title: 'AI Chat',
  component: AIChatPreferences,
  order: 50,
});
```

Your component receives no props - use `useUserProfile()` to read/write preferences:

```tsx
// features/ai-chat/components/AIChatPreferences.tsx
import { useUserProfile } from '@/features/user';
import { SettingsToggleRow, SettingsSectionHeader } from '@/features/user/components/settings/SettingsComponents';

export function AIChatPreferences() {
  const { profile, updatePreferences } = useUserProfile();

  return (
    <>
      <SettingsSectionHeader
        title="AI Chat"
        description="Configure AI assistant behaviour"
      />
      <SettingsToggleRow
        label="Enable suggestions"
        description="Show AI-powered suggestions while typing"
        checked={profile?.preferences?.aiSuggestions ?? true}
        onChange={(checked) => updatePreferences({ aiSuggestions: checked })}
      />
    </>
  );
}
```

### Adding Notification Preferences

Add notification options to the Preferences page:

```tsx
// features/analytics/notifications.registration.ts
import { notificationPreferencesRegistry } from '@/config/notification-preferences.registry';

notificationPreferencesRegistry.register({
  id: 'emailAnalyticsReport',
  label: 'Analytics reports',
  description: 'Weekly analytics and performance insights',
  defaultValue: false,
  order: 110,  // Plugin notifications start at 100+
});
```

Notification preferences are automatically shown in the email notifications toggle group. The preference value is stored in `user.preferences[id]`.

### Adding Language Options

Add language options to the language dropdown:

```tsx
// features/i18n-spanish/languages.registration.ts
import { languageOptionsRegistry } from '@/config/language-options.registry';

languageOptionsRegistry.register({
  id: 'es',
  label: 'Spanish',
  order: 110,
});

languageOptionsRegistry.register({
  id: 'es-MX',
  label: 'Spanish (Mexico)',
  order: 111,
});

// RTL language example
languageOptionsRegistry.register({
  id: 'ar',
  label: 'Arabic',
  order: 120,
  rtl: true,
});
```

<Aside type="note">
  Core English options (en-AU, en-US, en-GB, etc.) are hardcoded and cannot be overridden. Plugin languages appear after the core options.
</Aside>

### Extension Points Summary

| Registry | What It Extends | Where It Appears |
|----------|-----------------|------------------|
| `personalInfoFieldsRegistry` | Profile fields | Personal Information page |
| `preferencesRegistry` | Preference sections | Preferences page (below notifications) |
| `notificationPreferencesRegistry` | Email toggles | Preferences page (notification group) |
| `languageOptionsRegistry` | Language dropdown | Preferences page |
| `settingsPagesRegistry` | Entire pages | Settings sidebar |

---

## Troubleshooting

### Profile Not Loading

1. Check `UserProfileProvider` is in component tree
2. Verify user is authenticated
3. Check API endpoint returns 200

### Avatar Not Updating

1. Verify `avatarUrl` is being saved correctly
2. Check for base64 size limits
3. Ensure `UserAvatar` is receiving correct props

### Preferences Lost

1. Preferences use shallow merge - don't overwrite entire object
2. Check Zod validation isn't rejecting unknown fields
3. Verify backend returns updated preferences

---

## Next Steps

- [Authentication](/starter-template/auth-feature/) - How auth works
- [Admin Feature](/starter-template/admin-feature/) - User management
- [Dashboard](/starter-template/dashboard-feature/) - Widget system
