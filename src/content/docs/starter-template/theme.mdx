---
title: Theme Utilities
description: How to apply CSS variable overrides and let modules react to theme changes
---

import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

The starter template provides a thin theme utility in `frontend/src/lib/theme.ts` that enables dynamic CSS variable overrides. It serves as the integration point for the planned [Style module](/modules/roadmap/#style), and any module that needs to apply or respond to theme changes.

<Aside type="note">
The theme utility manages CSS variable overrides applied on top of `globals.css`. It does **not** control the dark/light mode toggle — that is handled separately by the Tailwind `dark` class.
</Aside>

---

## How It Works

The utility uses the [filter and action registries](/starter-template/hooks/) to create a pipeline:

```
applyThemeVariables(variables)
        │
        ▼
1. Run `theme.cssVariables` filter
   → Modules can inject or modify variables
        │
        ▼
2. Apply to document.documentElement.style
   → CSS custom properties set on :root
        │
        ▼
3. Fire `theme.changed` action
   → Modules can react (re-render, sync state)
```

---

## Applying Theme Variables

Call `applyThemeVariables()` to override CSS custom properties on the document root:

```typescript
import { applyThemeVariables } from '@/lib/theme';

// Apply overrides (e.g., from admin-configured style settings)
applyThemeVariables({
  '--color-primary': 'hsl(220 70% 50%)',
  '--color-primary-foreground': 'hsl(0 0% 98%)',
  '--radius': '0.75rem',
});
```

These override the values defined in `globals.css`. Any CSS custom property can be set — the utility is not limited to a predefined list.

---

## Resetting to Defaults

Call `resetThemeVariables()` to remove all inline overrides, reverting to the values in `globals.css`:

```typescript
import { resetThemeVariables } from '@/lib/theme';

// Remove all inline overrides
resetThemeVariables();
```

This also fires the `theme.changed` action with an empty variables object, so modules know to revert to defaults.

---

## Injecting Variables via Filter

Modules can hook into the `theme.cssVariables` filter to inject additional CSS variables or modify existing ones before they are applied to the DOM:

```typescript
import { filterRegistry } from '@/config/filter.registry';

// Charts module adds chart-specific colour variables
filterRegistry.register('theme.cssVariables', 'charts-module', (vars) => ({
  ...vars,
  '--chart-primary': vars['--color-primary'] ?? 'hsl(220 70% 50%)',
  '--chart-secondary': vars['--color-secondary'] ?? 'hsl(160 60% 45%)',
}));
```

Filters run in order (lower number = earlier). The output of each filter is passed to the next.

---

## Reacting to Theme Changes

Modules can hook into the `theme.changed` action to react after theme variables are applied:

```typescript
import { actionRegistry } from '@/config/action.registry';

// Canvas module redraws when theme changes
actionRegistry.addAction('theme.changed', 'canvas-module', (ctx) => {
  redrawCanvas(ctx.variables);
});
```

The context object contains `{ variables }` — the final CSS variable map after all filters have run. When `resetThemeVariables()` is called, `variables` is an empty object.

---

## Hook Reference

| Hook | Registry | Type | Context |
|------|----------|------|---------|
| `theme.cssVariables` | filterRegistry | Filter | The CSS variable map (modules return modified map) |
| `theme.changed` | actionRegistry | Action | `{ variables }` — the applied variable map |

---

## Style Module Integration

The [Style module](/modules/roadmap/#style) (planned) will use this utility as its application layer:

1. Admin configures theme overrides in the admin panel
2. Backend stores configuration and fires `admin.styleUpdated`
3. Frontend fetches configuration and calls `applyThemeVariables()`
4. Other modules inject derived variables via the `theme.cssVariables` filter
5. Components re-render based on the `theme.changed` action

The theme utility is intentionally thin — it handles DOM application and hook orchestration. The Style module provides the admin UI, persistence, and configuration logic.

---

## API Reference

### Functions

| Function | Description |
|----------|-------------|
| `applyThemeVariables(variables)` | Apply CSS variable overrides to the document root |
| `resetThemeVariables()` | Remove all inline overrides, revert to `globals.css` |

### Types

```typescript
/** CSS variable overrides — key is the custom property name, value is the CSS value */
type ThemeVariables = Record<string, string>;
```

---

## Next Steps

- [Filter & Action Hooks](/starter-template/hooks/) — How filters and actions work
- [Registry Reference](/starter-template/registries/) — All available registries
