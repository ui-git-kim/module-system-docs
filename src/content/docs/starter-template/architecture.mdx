---
title: Project Architecture
description: How the starter template is organised
---

import { FileTree, Tabs, TabItem } from '@astrojs/starlight/components';

## Overview

The starter template is a fullstack TypeScript application with separate frontend and backend directories, connected through a REST API.

```
┌───────────────────────────────────────────────────────────────┐
│                       Frontend (Vite)                          │
│    React 19 · TypeScript · Tailwind v4 · shadcn/ui            │
│                                                                │
│    features/                                                   │
│    ├── auth/        Session, sign-in UI, route protection     │
│    ├── user/        Profile, avatar, preferences              │
│    ├── dashboard/   Layout shell, sidebar, header             │
│    └── admin/       App settings, branding, user management   │
└────────────────────────────┬──────────────────────────────────┘
                             │ REST API (JWT auth)
                             ▼
┌───────────────────────────────────────────────────────────────┐
│                      Backend (Express)                         │
│    TypeScript · Prisma 7 · Neon PostgreSQL                    │
│                                                                │
│    features/                                                   │
│    ├── user/        Profile CRUD, role management             │
│    └── admin/       App settings, navigation overrides        │
└────────────────────────────┬──────────────────────────────────┘
                             │
                             ▼
┌───────────────────────────────────────────────────────────────┐
│                    Neon PostgreSQL                             │
│    User · Profile · AppSettings tables                        │
└───────────────────────────────────────────────────────────────┘
```

---

## Root Directory

```
project-root/
├── frontend/               # React application
├── backend/                # Express API server
├── docs/                   # Documentation (git submodule)
├── scripts/                # Build and version scripts
├── create-app.ps1          # Windows clone script
├── create-app.sh           # macOS/Linux clone script
├── update-template.ps1     # Windows update script
├── update-template.sh      # macOS/Linux update script
├── CLAUDE.md               # AI assistant instructions
├── VERSION                 # Template version
└── package.json            # Root scripts for both
```

---

## Feature-Based Organisation

Both frontend and backend organise code by **feature** (domain) rather than by technical layer. This keeps related code together and makes features self-contained.

<Tabs>
  <TabItem label="Frontend">
```
frontend/src/
├── features/               # Feature modules
│   ├── auth/               # Authentication
│   │   ├── index.ts        # Exports
│   │   ├── components/     # AuthUI, SignIn
│   │   ├── pages/          # SignInPage
│   │   ├── lib/            # getAuthToken
│   │   └── routes.config.tsx
│   ├── user/               # User management
│   │   ├── index.ts
│   │   ├── components/     # UserAvatar, ProfileForm
│   │   ├── pages/          # ProfilePage, PreferencesPage
│   │   ├── hooks/          # useUserProfile
│   │   ├── services/       # user.service.ts
│   │   └── context/        # UserProfileProvider
│   ├── dashboard/          # App shell
│   │   ├── index.ts
│   │   ├── components/     # AppSidebar, HeaderToolbar
│   │   ├── pages/          # DashboardPage
│   │   └── navigation.registration.ts
│   └── admin/              # Admin settings
│       ├── index.ts
│       ├── pages/          # AppSettingsPage
│       ├── context/        # AppSettingsContext
│       └── hooks/          # useAppSettings
├── config/                 # Registries
│   ├── base.registry.ts
│   ├── navigation.registry.ts
│   ├── dashboard.registry.ts
│   ├── settings-pages.registry.ts
│   ├── header-toolbar.registry.ts
│   ├── admin-pages.registry.ts
│   ├── action.registry.ts     # Side-effect hooks
│   ├── filter.registry.ts     # Data transformation hooks
│   └── registry.hooks.ts
├── components/
│   ├── ui/                 # shadcn/ui (don't modify)
│   ├── layout/             # App layout, BreadcrumbContext
│   ├── page-blocks/        # Reusable page-level components
│   └── settings-blocks/    # Reusable settings/form components
├── lib/
│   ├── api.ts              # Axios client with auth
│   ├── theme.ts            # CSS variable overrides
│   └── utils.ts            # Helper functions
├── routes.tsx              # Router configuration
└── main.tsx                # App entry point
```
  </TabItem>
  <TabItem label="Backend">
```
backend/src/
├── features/               # Feature modules
│   ├── user/
│   │   ├── index.ts        # Exports + registration imports
│   │   ├── user.routes.ts  # GET/PATCH /profile
│   │   ├── user.service.ts # Business logic + action hooks
│   │   ├── user.types.ts
│   │   ├── route.registration.ts
│   │   └── service.registration.ts
│   └── admin/
│       ├── index.ts
│       ├── admin.routes.ts # GET/PATCH /settings
│       ├── admin.service.ts # Business logic + action hooks
│       └── route.registration.ts
├── config/                 # Registries
│   ├── base.registry.ts
│   ├── route.registry.ts
│   ├── service.registry.ts
│   ├── action.registry.ts  # Side-effect hooks
│   ├── filter.registry.ts  # Data transformation hooks
│   └── env.ts              # Environment validation (Zod)
├── middleware/
│   ├── auth.middleware.ts   # JWT verification
│   └── request-id.middleware.ts # Request correlation IDs
├── lib/
│   ├── prisma.ts           # Database client
│   ├── logger.ts           # Pino structured logging
│   └── errors.ts           # HTTP error classes
└── app.ts                  # Express app setup

backend/prisma/
├── schema.prisma           # Database schema
└── migrations/             # Migration history
```
  </TabItem>
</Tabs>

---

## Feature Structure

Each feature follows a consistent pattern:

### Frontend Feature

<FileTree>
- features/[feature]/
  - index.ts (Public exports + registration imports)
  - routes.config.tsx (Route definitions)
  - navigation.registration.ts (Navigation registry)
  - components/ (UI components)
  - pages/ (Page components)
  - services/ (API service layer)
  - hooks/ (Custom hooks)
  - context/ (React context providers)
  - types/ (TypeScript types)
</FileTree>

### Backend Feature

<FileTree>
- features/[feature]/
  - index.ts (Exports + registration imports)
  - [feature].routes.ts (Express routes)
  - [feature].service.ts (Business logic)
  - [feature].types.ts (Types)
  - route.registration.ts (Route registry)
  - service.registration.ts (Service registry)
</FileTree>

---

## Key Files

### Frontend

| File | Purpose |
|------|---------|
| `src/routes.tsx` | Main router, spreads feature routes |
| `src/config/navigation.registry.ts` | Sidebar/user menu registry |
| `src/config/dashboard.registry.ts` | Dashboard widget registry |
| `src/config/settings-pages.registry.ts` | Settings pages registry |
| `src/config/base.registry.ts` | Base class for creating registries |
| `src/config/registry.hooks.ts` | React hooks for all registries |
| `src/config/action.registry.ts` | Side-effect hooks (frontend) |
| `src/config/filter.registry.ts` | Data transformation hooks (frontend) |
| `src/lib/api.ts` | Axios client with auth interceptor |
| `src/lib/theme.ts` | CSS variable overrides with hook integration |
| `src/features/auth/lib/getAuthToken.ts` | Centralised auth token getter |
| `src/components/layout/BreadcrumbContext.tsx` | Dynamic breadcrumb system |
| `src/components/page-blocks/` | Page header, loading, error, empty states |
| `src/components/settings-blocks/` | Row layouts, toggles, dropdowns, tables |

### Backend

| File | Purpose |
|------|---------|
| `src/app.ts` | Express app setup, route mounting |
| `src/config/route.registry.ts` | Route registry with versioning |
| `src/config/service.registry.ts` | Service registry for cross-feature |
| `src/config/action.registry.ts` | Action hooks for side effects |
| `src/config/filter.registry.ts` | Filter hooks for data transformation |
| `src/config/env.ts` | Environment validation (Zod) |
| `src/middleware/auth.middleware.ts` | JWT verification middleware |
| `src/middleware/request-id.middleware.ts` | Request correlation IDs |
| `src/lib/prisma.ts` | Database client, health checks |
| `src/lib/logger.ts` | Pino structured logging factory |
| `src/lib/errors.ts` | HTTP-aware error classes |
| `prisma/schema.prisma` | Database schema |

---

## Self-Registration Pattern

Features register themselves using side-effect imports - no manual wiring required:

```typescript
// features/billing/index.ts

// Side-effect imports trigger registration
import './navigation.registration';
import './settings.registration';

// Public exports
export { BillingPage } from './pages/BillingPage';
export { billingRoutes } from './routes.config';
```

```typescript
// features/billing/navigation.registration.ts
import { navigationRegistry } from '@/config/navigation.registry';
import { CreditCard } from 'lucide-react';

navigationRegistry.registerMain({
  id: 'billing',
  title: 'Billing',
  url: '/billing',
  icon: CreditCard,
  order: 40,
});
```

When the app imports the feature, registrations happen automatically.

---

## Adding a New Feature

### Frontend

1. Create folder: `frontend/src/features/[name]/`
2. Create `navigation.registration.ts` to register nav items
3. Create `routes.config.tsx` for routes
4. Create `index.ts` with side-effect imports
5. Import feature in `main.tsx`
6. Spread routes in `routes.tsx`

### Backend

1. Create folder: `backend/src/features/[name]/`
2. Create `route.registration.ts` to register routes
3. Create `service.registration.ts` to register service
4. Create `index.ts` with side-effect imports
5. Import feature in `app.ts`

---

## Request Flow

When a user loads their profile:

```
1. Frontend: useUserProfile() hook triggers
         ↓
2. Frontend: api.get('/api/v1/user/profile')
         ↓
3. Frontend: Axios interceptor adds JWT from getAuthToken()
         ↓
4. Backend: requireAuth middleware verifies JWT via JWKS
         ↓
5. Backend: Route handler calls userService.getOrCreateProfile()
         ↓
6. Backend: Prisma queries Profile table
         ↓
7. Response flows back, hook updates state, UI renders
```

---

## Database Schema

The starter includes these core tables:

```prisma
model User {
  id        String   @id              // From Neon Auth
  email     String   @unique
  role      Role     @default(user)   // user | admin | managed
  profile   Profile?
  createdAt DateTime @default(now())
}

model Profile {
  id          String  @id @default(cuid())
  userId      String  @unique
  user        User    @relation(...)
  displayName String?
  avatarUrl   String?
  avatarColor String?
  // ... preferences
}

model AppSettings {
  id                  String  @id @default("singleton")
  appName             String?
  logoUrl             String?
  logoDisplayMode     String  @default("both")
  navigationOverrides Json    @default("{}")
  toolbarOverrides    Json    @default("{}")
}
```

---

## File Naming Conventions

| Type | Convention | Example |
|------|-----------|---------|
| Components | PascalCase | `UserAvatar.tsx` |
| Pages | PascalCase + Page | `BillingPage.tsx` |
| Hooks | camelCase + use | `useUserProfile.ts` |
| Services | camelCase + .service | `billing.service.ts` |
| Routes | camelCase + .routes | `billing.routes.ts` |
| Types | camelCase + .types | `billing.types.ts` |
| Registrations | camelCase + .registration | `navigation.registration.ts` |
| Config | camelCase + .registry | `navigation.registry.ts` |

---

## Shared Component Libraries

The starter provides two reusable component libraries that modules should use for building settings pages and admin pages. These ensure visual consistency across all features.

### Page Blocks (`@/components/page-blocks`)

Page-level building blocks for headers, loading states, errors, and empty states:

| Component | Purpose |
|-----------|---------|
| `PageHeader` | Page title with optional icon, description, and badge |
| `LoadingState` | Centered loading spinner |
| `ErrorAlert` | Error alert that renders `null` when no error |
| `EmptyState` | Centered empty state with icon, title, and optional action |

### Settings Blocks (`@/components/settings-blocks`)

Form and layout components for building settings-style pages:

| Category | Components |
|----------|-----------|
| **Rows** | `Row` (2-column), `Row3Col` (3-column), `RowStacked` (content below label) |
| **Layout** | `SectionHeader`, `Divider`, `TabBar`, `Note` |
| **Form controls** | `Dropdown`, `ToggleGroup`, `ToggleSwitch` |
| **Specialised** | `DangerBox`, `DisabledRow`, `PlanCard`, `ProviderCard`, `ProviderGroup`, `Table` |

These replace the old `SettingsComponents.tsx` and `AdminComponents.tsx` page-level components. Use composition to build rows with controls:

```tsx
import { Row, ToggleSwitch, Divider } from '@/components/settings-blocks';

<Row
  label="Email notifications"
  description="Receive updates via email"
  action={<ToggleSwitch checked={enabled} onChange={setEnabled} />}
/>
<Divider />
```

---

## Key Principles

### 1. Features Own Their Domain

Each feature contains its own routes, components, services, and types. No reaching into other features' internals.

### 2. Extension Via Registries

Features extend the app through registries rather than modifying core files. A module adds a nav item by calling `navigationRegistry.register()`, not by editing the sidebar component.

### 3. Contexts for Shared State

Cross-cutting data (user profile, app settings) is provided via React context at the layout level, available to all child components.

### 4. Split Route Permissions

Some data needs different access levels. The Admin feature demonstrates this: `GET /settings` is public (all users need branding), but `PATCH /settings` requires admin role.
