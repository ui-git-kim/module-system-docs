---
title: Admin Feature
description: Complete guide to the admin panel and site configuration
---

import { Aside, Steps, Tabs, TabItem } from '@astrojs/starlight/components';

The admin feature provides a comprehensive admin panel for managing app branding, navigation, toolbar items, and users. It also provides the global `AppSettingsProvider` context that makes these settings available throughout the application.

---

## Overview

The admin panel is accessible at `/admin` and is only visible to users with the `admin` role. It provides:

- **App Settings** - Configure app name, logo, and display options
- **User Management** - View, modify roles, and delete users
- **Navigation Management** - Customise sidebar items, sections, and user menu
- **Header Toolbar** - Show/hide toolbar items

<Aside type="tip">
  The first user to sign up automatically becomes an admin. You can promote other users in Admin → Users.
</Aside>

---

## Architecture

### The Settings Flow

When a user loads the dashboard:

<Steps>
1. `DashboardPage` renders with `AppSettingsProvider` wrapper
2. `AppSettingsProvider` fetches settings from `GET /api/v1/admin/settings`
3. Settings are stored in React context and made available via hooks
4. `AppSidebar` reads logo, app name, and applies navigation overrides
5. `HeaderToolbar` applies toolbar overrides to hide items
6. When admin saves changes, `refetch()` updates the context and UI updates immediately
</Steps>

### Why Settings GET is Public

The admin API has a unique permission structure:

```
GET  /api/v1/admin/settings  → All authenticated users (for sidebar branding)
PATCH /api/v1/admin/settings → Admin only (to modify settings)
```

This design allows:
- **All users** can see the app logo and name in the sidebar
- **Only admins** can change branding and configuration

### File Structure

```
frontend/src/features/admin/
├── index.ts                        # Public exports
├── routes.config.tsx               # Admin routes (/admin/*)
├── navigation.registration.ts      # Registers "Admin" in sidebar
├── admin-pages.registration.ts     # Registers admin pages
├── context/
│   └── AppSettingsContext.tsx      # Global settings provider
├── components/
│   └── AdminLayout.tsx             # Admin panel layout
├── pages/
│   ├── AdminDashboardPage.tsx      # Overview stats
│   ├── AppSettingsPage.tsx         # Branding config
│   ├── AdminUsersPage.tsx          # User management
│   ├── NavigationManagementPage.tsx # Nav + sections + user menu
│   └── HeaderToolbarPage.tsx       # Toolbar overrides
├── hooks/
│   ├── useAppSettings.ts           # Admin settings (for editing)
│   ├── useNavigationOverrides.ts   # Nav + section override management
│   ├── useToolbarOverrides.ts      # Toolbar override management
│   └── useAdminUsers.ts            # User management
└── services/
    └── admin.service.ts            # API client

backend/src/features/admin/
├── index.ts                        # Exports + registrations
├── admin.types.ts                  # Types and Zod schemas
├── admin.service.ts                # Business logic
├── admin.routes.ts                 # Two routers: public + admin
├── route.registration.ts           # Registers both routers
└── service.registration.ts         # Service registry
```

---

## App Settings

### Branding Configuration

The App Settings page allows admins to configure:

| Setting | Description |
|---------|-------------|
| **App Name** | Displayed in sidebar header and page titles |
| **Logo** | Custom logo (uploaded as base64 or URL) |
| **Logo Display Mode** | Logo only, logo + name, or name only |
| **Show Dashboard in Nav** | Whether dashboard appears in main nav |
| **Enable Marketing Pages** | Feature flag for public pages |

### Using App Settings in Your Components

```tsx
import { useAppSettingsValue } from '@/features/admin';

function MyComponent() {
  const settings = useAppSettingsValue();

  return (
    <header>
      {settings.logoUrl && <img src={settings.logoUrl} alt={settings.appName} />}
      <h1>{settings.appName}</h1>
    </header>
  );
}
```

### Available Hooks

| Hook | Purpose |
|------|---------|
| `useGlobalAppSettings()` | Full context (settings, loading, error, refetch) |
| `useAppSettingsValue()` | Just settings with defaults (most common) |
| `useGlobalNavigationOverrides()` | Navigation + section overrides |
| `useGlobalToolbarOverrides()` | Toolbar hidden items |

---

## Navigation Management

The Navigation Management page has three tabs for managing different parts of the navigation system.

### Main Navigation Tab

Displays navigation items grouped by their sections. Each section is a collapsible container showing:

- **Section header** with label, item count, and customisation options
- **Navigation items** within that section

**Section actions:**
- Create new sections to organise navigation items
- Edit the section label
- Toggle whether the section label is visible in the sidebar
- Hide the entire section (items move to the default section)
- Delete admin-created sections (if empty)
- Reset customisations to defaults

**Item actions:**
- Drag to reorder within the section
- Toggle visibility on/off

<Aside type="note">
**Sections can be created by admins** or registered by modules. Admins can create custom sections to organise navigation items. Module-registered sections cannot be deleted (they're tied to the module), but admin-created sections can be removed if empty.
</Aside>

### Secondary Navigation Tab

Items that appear at the bottom of the sidebar (e.g., Support, Admin links).

- Drag to reorder
- Toggle visibility on/off

### User Menu Tab

Items that appear in the user dropdown menu (accessed by clicking the user avatar).

- Drag to reorder
- Toggle visibility on/off

---

## Toolbar Overrides

Admins can hide toolbar items from the header:

<Steps>
1. Go to Admin → Header Toolbar
2. Toggle visibility for any item
3. Click "Save Changes"
</Steps>

---

## User Management

The Users page provides:

- **View all users** - List with email, name, role, and join date
- **Change roles** - Promote to admin or demote to user
- **Delete users** - Remove accounts (with confirmation)

### Role Types

| Role | Description |
|------|-------------|
| `user` | Standard user access |
| `admin` | Full access, can manage all settings and users |
| `managed` | Permissions controlled by external module (for future RBAC) |

### Safety Rules

The backend enforces these rules:

- Cannot remove the last admin
- Cannot delete your own account from admin panel
- Cannot demote yourself if you're the last admin

---

## Adding Admin Pages

Features can register custom admin pages using the admin pages registry:

```tsx
// features/my-feature/admin-pages.registration.ts
import { adminPagesRegistry } from '@/config/admin-pages.registry';
import { MyAdminPage } from './pages/MyAdminPage';
import { Settings } from 'lucide-react';

adminPagesRegistry.register({
  id: 'my-feature-settings',
  title: 'My Feature',
  description: 'Configure my feature',
  icon: Settings,
  component: MyAdminPage,
  order: 30,
});
```

The page will automatically appear in the admin sidebar at `/admin/my-feature-settings`.

---

## API Endpoints

### Public Endpoint (All Authenticated Users)

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/v1/admin/settings` | GET | Get all app settings (branding + all overrides) |

<Aside type="note">
This single endpoint returns **everything** users need: app name, logo, navigation overrides (including section overrides), and toolbar overrides. This is what the `AppSettingsProvider` fetches for all users to render the sidebar correctly.
</Aside>

### Admin-Only Endpoints (Require Admin Role)

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/v1/admin/settings` | PATCH | Update app branding settings |
| `/api/v1/admin/navigation` | PATCH | Update navigation + section overrides |
| `/api/v1/admin/toolbar` | PATCH | Update toolbar overrides |
| `/api/v1/admin/users` | GET | List all users |
| `/api/v1/admin/users/:id/role` | PATCH | Update user role |
| `/api/v1/admin/users/:id` | DELETE | Delete user |

<Aside type="tip">
The admin panel also uses a GET endpoint for `/navigation` and `/toolbar` to fetch data for editing. These are admin-only because regular users get everything from the single `/settings` endpoint.
</Aside>

---

## Database Schema

```prisma
model AppSettings {
  id                   String   @id @default("default")
  appName              String   @default("My App")
  logoUrl              String?
  logoDisplayMode      String   @default("logo-and-name")
  showDashboardInNav   Boolean  @default(true)
  enableMarketingPages Boolean  @default(false)
  navigationOverrides  Json     @default("{}")  // Items + sections
  toolbarOverrides     Json     @default("{}")  // Toolbar hidden
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}
```

The `navigationOverrides` JSON field contains both item overrides and section overrides:

```typescript
interface NavigationOverrides {
  hidden: string[];                        // Hidden item IDs
  orderOverrides: Record<string, number>;  // Item order
  sections: Record<string, SectionOverride>; // Section customisation
  hiddenSections: string[];                // Hidden section IDs
}
```

The table uses a singleton pattern - there's only ever one row with `id = "default"`. The service auto-creates this row on first access.

---

## Troubleshooting

### Logo Not Showing After Upload

1. Ensure you clicked "Save Changes" after uploading
2. Check browser console for errors
3. Verify the `AppSettingsProvider` wraps your dashboard layout

### Navigation Overrides Not Applied

1. Verify the `AppSettingsProvider` is in your component tree
2. Ensure the item IDs match (check registration files)
3. Check that the admin panel shows your changes as saved

### Section Not Appearing

1. Check that your module's `navigation.registration.ts` is imported
2. Verify at least one item is assigned to the section
3. Check the admin panel - is the section hidden?

### Can't Access Admin Panel

1. Verify your user has `role: 'admin'` in the database
2. Check the User table: `SELECT role FROM "User" WHERE email = 'your@email.com'`
3. First user is auto-promoted to admin on first API call

### Settings Don't Persist

1. Check that the AppSettings migration has run
2. Run: `cd backend && npx prisma migrate dev`

---

## Next Steps

- [User Feature](/starter-template/user-feature/) - User profiles and preferences
- [Authentication](/starter-template/auth-feature/) - How auth works
- [Dashboard Feature](/starter-template/dashboard-feature/) - Layout and widgets
- [Registries](/starter-template/registries/) - Full registry reference
