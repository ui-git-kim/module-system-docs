---
title: Admin Feature
description: Complete guide to the admin panel and site configuration
---

import { Aside, Steps, Tabs, TabItem } from '@astrojs/starlight/components';

The admin feature provides a comprehensive admin panel for managing app branding, navigation, toolbar items, and users. It also provides the global `AppSettingsProvider` context that makes these settings available throughout the application.

---

## Overview

The admin panel is accessible at `/admin` and is only visible to users with the `admin` role. It provides:

- **App Settings** - Configure app name, logo, and display options
- **User Management** - View, modify roles, and delete users
- **Navigation Management** - Show/hide, reorder sidebar items, and customise sections
- **Header Toolbar** - Show/hide toolbar items

<Aside type="tip">
  The first user to sign up automatically becomes an admin. You can promote other users in Admin → Users.
</Aside>

---

## Architecture

### The Settings Flow

When a user loads the dashboard, here's what happens:

<Steps>
1. `DashboardPage` renders with `AppSettingsProvider` wrapper
2. `AppSettingsProvider` fetches settings from `GET /api/v1/admin/settings`
3. Settings are stored in React context and made available via hooks
4. `AppSidebar` reads logo, app name, and applies navigation/section overrides
5. `HeaderToolbar` applies toolbar overrides to hide items
6. When admin saves changes, `refetch()` updates the context and UI updates immediately
</Steps>

### Why Settings GET is Public

The admin API has a unique permission structure:

```
GET  /api/v1/admin/settings  → All authenticated users (for sidebar branding)
PATCH /api/v1/admin/settings → Admin only (to modify settings)
```

This design allows:
- **All users** can see the app logo and name in the sidebar
- **Only admins** can change branding and configuration
- **No separate "site" feature** needed - keeps the codebase simpler

The backend achieves this by registering two routers on the same path:

```typescript
// route.registration.ts

// Public router (just GET /settings)
routeRegistry.register({
  path: '/admin',
  router: adminPublicRoutes,  // Contains GET /settings only
  requiresAuth: true,
  // No requireAdmin middleware
});

// Admin router (everything else)
routeRegistry.register({
  path: '/admin',
  router: adminRoutes,        // Contains PATCH, users, etc.
  requiresAuth: true,
  middleware: [requireAdmin], // Requires admin role
});
```

### Context Provider Structure

The `AppSettingsProvider` wraps the dashboard layout:

```tsx
// DashboardPage.tsx
function DashboardPage() {
  return (
    <AppSettingsProvider>      {/* Fetches and provides settings */}
      <UserProfileProvider>     {/* User profile data */}
        <SidebarProvider>       {/* Sidebar state */}
          <AppSidebar />        {/* Uses useAppSettingsValue() */}
          <SidebarInset>
            <SiteHeader />      {/* HeaderToolbar uses settings */}
            <main>
              <Outlet />
            </main>
          </SidebarInset>
        </SidebarProvider>
      </UserProfileProvider>
    </AppSettingsProvider>
  );
}
```

### File Structure

```
frontend/src/features/admin/
├── index.ts                        # Public exports
├── routes.config.tsx               # Admin routes (/admin/*)
├── navigation.registration.ts      # Registers "Admin" in sidebar
├── admin-pages.registration.ts     # Registers admin pages
├── context/
│   └── AppSettingsContext.tsx      # Global settings provider
├── components/
│   └── AdminLayout.tsx             # Admin panel layout
├── pages/
│   ├── AdminDashboardPage.tsx      # Overview stats
│   ├── AppSettingsPage.tsx         # Branding config
│   ├── AdminUsersPage.tsx          # User management
│   ├── NavigationManagementPage.tsx # Nav + section management
│   └── HeaderToolbarPage.tsx       # Toolbar overrides
├── hooks/
│   ├── useAppSettings.ts           # Admin settings (for editing)
│   ├── useNavigationOverrides.ts   # Nav override management
│   ├── useSectionOverridesAdmin.ts # Section override management
│   ├── useToolbarOverrides.ts      # Toolbar override management
│   └── useAdminUsers.ts            # User management
└── services/
    └── admin.service.ts            # API client

backend/src/features/admin/
├── index.ts                        # Exports + registrations
├── admin.types.ts                  # Types and Zod schemas
├── admin.service.ts                # Business logic
├── admin.routes.ts                 # Two routers: public + admin
├── route.registration.ts           # Registers both routers
└── service.registration.ts         # Service registry
```

---

## App Settings

### Branding Configuration

The App Settings page allows admins to configure:

| Setting | Description |
|---------|-------------|
| **App Name** | Displayed in sidebar header and page titles |
| **Logo** | Custom logo (uploaded as base64 or URL) |
| **Logo Display Mode** | Logo only, logo + name, or name only |
| **Show Dashboard in Nav** | Whether dashboard appears in main nav |
| **Enable Marketing Pages** | Feature flag for public pages |

### How the Sidebar Uses Settings

The `AppSidebar` component reads settings and applies them:

```tsx
// AppSidebar.tsx (simplified)
export function AppSidebar() {
  const settings = useAppSettingsValue();

  // Determine what to show based on logoDisplayMode
  const showLogo = settings.logoDisplayMode !== 'name-only';
  const showName = settings.logoDisplayMode !== 'logo-only';

  // Use database values with env fallback
  const appName = settings.appName || appConfig.appName;
  const logoUrl = settings.logoUrl;

  return (
    <Sidebar>
      <SidebarHeader>
        <Link to="/dashboard">
          {showLogo && (
            logoUrl ? <img src={logoUrl} /> : <DefaultLogo />
          )}
          {showName && <span>{appName}</span>}
        </Link>
      </SidebarHeader>
      {/* ... */}
    </Sidebar>
  );
}
```

### Using App Settings in Your Components

```tsx
import { useAppSettingsValue } from '@/features/admin';

function MyComponent() {
  const settings = useAppSettingsValue();

  return (
    <header>
      {settings.logoUrl && <img src={settings.logoUrl} alt={settings.appName} />}
      <h1>{settings.appName}</h1>
    </header>
  );
}
```

### Available Hooks

| Hook | Purpose |
|------|---------|
| `useGlobalAppSettings()` | Full context (settings, loading, error, refetch) |
| `useAppSettingsValue()` | Just settings with defaults (most common) |
| `useGlobalNavigationOverrides()` | Navigation hidden/order overrides |
| `useGlobalSectionOverrides()` | Section property overrides |
| `useGlobalToolbarOverrides()` | Toolbar hidden items |

### Refreshing Settings After Save

When an admin saves settings, the UI updates immediately:

```tsx
// AppSettingsPage.tsx
const { refetch: refetchGlobalSettings } = useGlobalAppSettings();

const handleSave = async () => {
  await save();
  // Refresh global settings so sidebar updates immediately
  await refetchGlobalSettings();
};
```

---

## Navigation Management

The Navigation Management page combines navigation item management with section management in one place.

### Navigation Items

Admins can customise the sidebar navigation without modifying code.

#### Hiding Items

<Steps>
1. Go to Admin → Navigation
2. Select the "Main Navigation" or "Secondary Navigation" tab
3. Toggle the visibility switch for any item
4. Click "Save Changes"
</Steps>

Items are hidden by ID, so they're still registered but not displayed.

#### Reordering Items (Drag and Drop)

<Steps>
1. Go to Admin → Navigation
2. Select the appropriate tab
3. Drag items using the grip handle to reorder
4. Click "Save Changes"
</Steps>

Order overrides are stored per-item and merged with the default order.

<Aside type="tip">
Admins never see order numbers - they simply drag items to the desired position. The system assigns appropriate order values automatically.
</Aside>

### Sidebar Sections

Sections are visual groupings for main navigation items. **Sections are defined by modules in the navigation registry** - admins can only customise their display properties, not create or delete them.

#### How Sections Work

The sidebar sections system has two layers:

1. **Registry (Developer/Module)** - Defines sections and assigns items to them
2. **Admin Overrides (Database)** - Customises section display properties

```
┌─────────────────────────────────────────────────────────────────┐
│                      Navigation Registry                        │
│                    (defined by modules)                         │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ Section: main          │ Section: workspace                 ││
│  │   label: "Application" │   label: "Workspace"               ││
│  │   showLabel: true      │   showLabel: true                  ││
│  │   order: 0             │   order: 20                        ││
│  │   items: [dashboard]   │   items: [projects, documents]     ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Admin Section Overrides                      │
│                    (stored in database)                         │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ workspace:             │ hidden: []                         ││
│  │   label: "My Projects" │                                    ││
│  │   order: 5             │                                    ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                    Merged at Render Time                        │
│  ┌─────────────────────────────────────────────────────────────┐│
│  │ Section: workspace                                          ││
│  │   label: "My Projects"  ← Override wins                     ││
│  │   showLabel: true       ← Registry default (no override)   ││
│  │   order: 5              ← Override wins                     ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
```

#### What Admins Can Customise

From the "Sections" tab in Navigation Management:

| Feature | Description |
|---------|-------------|
| **Edit Label** | Change the display text (e.g., "Workspace" → "My Projects") |
| **Toggle Label Visibility** | Show/hide the section header in the sidebar |
| **Reorder Sections** | Drag sections to change their position |
| **Hide Sections** | Hide entire sections (items move to "main" section) |
| **Reset to Default** | Remove all overrides for a section |

#### What Admins Cannot Do

- **Create sections** - Sections are defined by modules in the navigation registry
- **Delete sections** - Removing a section requires uninstalling the module
- **Move items between sections** - Item-to-section assignment is defined in the registry

<Aside type="note">
**Why this design?** Sections are part of the module's UI design. When you install a module, it defines how its navigation items are grouped. Admins can customise the presentation but can't break the module's intended structure.
</Aside>

#### The Default Section

The "main" section is special:

- Cannot be hidden (items need somewhere to go)
- Auto-created if no sections are registered
- Items without a `sidebarSection` default to "main"
- Items from hidden sections are moved to "main"

### Override Data Structures

**Navigation Overrides:**

```typescript
interface NavigationOverrides {
  hidden: string[];                      // Item IDs to hide
  orderOverrides: Record<string, number>; // Item ID → custom order
}
```

**Section Overrides:**

```typescript
interface SectionOverride {
  label?: string;      // Custom label
  showLabel?: boolean; // Override label visibility
  order?: number;      // Custom sort order
}

interface SectionOverrides {
  sections: Record<string, SectionOverride>; // Section ID → overrides
  hidden: string[];                          // Section IDs to hide
}
```

### How Overrides Are Applied

The `NavMain` component merges registry sections with admin overrides:

```tsx
// NavMain.tsx (simplified)
function NavMain({ items, registrySections, sectionOverrides }) {
  const sectionsWithItems = useMemo(() => {
    // Group items by their sidebarSection property
    const sectionItemsMap = new Map<string, NavigationItem[]>();

    for (const item of items) {
      const sectionId = item.sidebarSection || 'main';
      // ...group items
    }

    // Merge registry sections with admin overrides
    const mergedSections = [];

    for (const section of registrySections) {
      // Skip if admin hid this section (move items to main)
      if (sectionOverrides.hidden?.includes(section.id)) {
        continue;
      }

      // Apply admin overrides
      const override = sectionOverrides.sections?.[section.id];
      mergedSections.push({
        id: section.id,
        label: override?.label ?? section.label,        // Override wins
        showLabel: override?.showLabel ?? section.showLabel,
        order: override?.order ?? section.order ?? 50,
      });
    }

    return mergedSections.sort((a, b) => a.order - b.order);
  }, [items, registrySections, sectionOverrides]);

  // Render sections with their items...
}
```

---

## Toolbar Overrides

Similar to navigation, admins can hide toolbar items:

<Steps>
1. Go to Admin → Header Toolbar
2. Toggle visibility for any item
3. Click "Save Changes"
</Steps>

The `HeaderToolbar` component applies these overrides:

```tsx
// HeaderToolbar.tsx
function applyToolbarOverrides(
  items: ToolbarItem[],
  overrides: ToolbarOverrides
): ToolbarItem[] {
  return items.filter((item) => !overrides.hidden.includes(item.id));
}
```

---

## User Management

The Users page provides:

- **View all users** - List with email, name, role, and join date
- **Change roles** - Promote to admin or demote to user
- **Delete users** - Remove accounts (with confirmation)

### Role Types

| Role | Description |
|------|-------------|
| `user` | Standard user access |
| `admin` | Full access, can manage all settings and users |
| `managed` | Permissions controlled by external module (for future RBAC) |

### Safety Rules

The backend enforces these rules:

- Cannot remove the last admin
- Cannot delete your own account from admin panel
- Cannot demote yourself if you're the last admin

```typescript
// admin.service.ts
async updateUserRole(userId: string, newRole: string) {
  // Prevent removing the last admin
  if (user.role === 'admin' && newRole !== 'admin') {
    const adminCount = await prisma.user.count({
      where: { role: 'admin' },
    });

    if (adminCount <= 1) {
      throw new BadRequestError('Cannot remove the last admin.');
    }
  }
  // ...
}
```

---

## Adding Admin Pages

Features can register custom admin pages using the admin pages registry:

```tsx
// features/my-feature/admin-pages.registration.ts
import { adminPagesRegistry } from '@/config/admin-pages.registry';
import { MyAdminPage } from './pages/MyAdminPage';
import { Settings } from 'lucide-react';

adminPagesRegistry.register({
  id: 'my-feature-settings',
  title: 'My Feature',
  description: 'Configure my feature',
  icon: Settings,
  component: MyAdminPage,
  order: 30,
});
```

The page will automatically appear in the admin sidebar at `/admin/my-feature-settings`.

---

## API Endpoints

### Public Endpoints (All Authenticated Users)

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/v1/admin/settings` | GET | Get app settings (branding, overrides) |

<Aside type="note">
  This endpoint is public so all users can see the app branding in the sidebar. Only GET is allowed - modifications require admin role.
</Aside>

### Admin-Only Endpoints (Require Admin Role)

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/v1/admin/settings` | PATCH | Update app settings |
| `/api/v1/admin/navigation` | GET | Get navigation overrides |
| `/api/v1/admin/navigation` | PATCH | Update navigation overrides |
| `/api/v1/admin/toolbar` | GET | Get toolbar overrides |
| `/api/v1/admin/toolbar` | PATCH | Update toolbar overrides |
| `/api/v1/admin/section-overrides` | GET | Get section overrides |
| `/api/v1/admin/section-overrides` | PATCH | Update section overrides |
| `/api/v1/admin/users` | GET | List all users |
| `/api/v1/admin/users/:id/role` | PATCH | Update user role |
| `/api/v1/admin/users/:id` | DELETE | Delete user |

---

## Database Schema

```prisma
model AppSettings {
  id                   String   @id @default("default")
  appName              String   @default("My App")
  logoUrl              String?
  logoDisplayMode      String   @default("logo-and-name")
  showDashboardInNav   Boolean  @default(true)
  enableMarketingPages Boolean  @default(false)
  sectionOverrides     Json     @default("{}")  // Section display overrides
  navigationOverrides  Json     @default("{}")  // Nav hidden/order
  toolbarOverrides     Json     @default("{}")  // Toolbar hidden
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}
```

### JSON Field Structures

**sectionOverrides:**

```json
{
  "sections": {
    "workspace": {
      "label": "My Projects",
      "order": 5
    }
  },
  "hidden": ["reports"]
}
```

**navigationOverrides:**

```json
{
  "hidden": ["support", "help"],
  "orderOverrides": {
    "projects": 5,
    "settings": 90
  }
}
```

**toolbarOverrides:**

```json
{
  "hidden": ["theme-toggle"]
}
```

### Singleton Pattern

The table uses a singleton pattern - there's only ever one row with `id = "default"`. The service auto-creates this row on first access:

```typescript
// admin.service.ts
async getAppSettings(): Promise<AppSettings> {
  let settings = await prisma.appSettings.findUnique({
    where: { id: 'default' },
  });

  // Auto-create with defaults if not exists
  if (!settings) {
    settings = await prisma.appSettings.create({
      data: { id: 'default' },
    });
  }

  return settings;
}
```

---

## For Module Developers

### Registering Sections

If your module needs a dedicated section in the sidebar:

```typescript
// features/my-module/navigation.registration.ts
import { navigationRegistry } from '@/config/navigation.registry';
import { Folder, FileText, Users } from 'lucide-react';

// 1. Register your section
navigationRegistry.registerSection({
  id: 'my-module',
  label: 'My Module',
  showLabel: true,
  order: 30,  // Position in sidebar (0-100)
});

// 2. Register items into your section
navigationRegistry.registerMain({
  id: 'my-module-dashboard',
  title: 'Dashboard',
  url: '/my-module',
  icon: Folder,
  order: 10,
  sidebarSection: 'my-module',  // Assign to your section
});

navigationRegistry.registerMain({
  id: 'my-module-settings',
  title: 'Settings',
  url: '/my-module/settings',
  icon: Settings,
  order: 20,
  sidebarSection: 'my-module',
});
```

### Best Practices

1. **Use descriptive section IDs** - `my-module`, not just `module` or `section1`
2. **Set appropriate order values** - See [Registry Reference](/starter-template/registries/#order-convention) for conventions
3. **Keep section labels concise** - They appear in the sidebar, so shorter is better
4. **Consider `showLabel: false`** if your section has only one item

### What Happens When Your Module is Uninstalled

When a module is removed:
- Its section registration is removed (no more section in registry)
- Its navigation items are removed
- Any admin overrides for that section remain in the database but have no effect
- The sidebar simply doesn't show the section anymore

<Aside type="tip">
Admin overrides are safe to leave in the database. They're keyed by section ID, so they'll automatically apply again if the module is reinstalled.
</Aside>

---

## Troubleshooting

### Logo Not Showing After Upload

1. Ensure you clicked "Save Changes" after uploading
2. Check browser console for errors
3. Verify the `AppSettingsProvider` wraps your dashboard layout
4. Check that `useAppSettingsValue()` is returning the expected `logoUrl`

### Navigation Overrides Not Applied

1. Verify the `AppSettingsProvider` is in your component tree
2. Check that `useAppSettingsValue()` returns the expected overrides
3. Ensure the item IDs match (check registration files)
4. Confirm the sidebar is using `applyNavigationOverrides()`

### Section Not Appearing

1. Check that your module's `navigation.registration.ts` is imported
2. Verify the section is registered with `registerSection()` or via item's `sidebarSection`
3. Check the admin panel - is the section hidden?
4. Confirm at least one item is assigned to the section

### Can't Access Admin Panel

1. Verify your user has `role: 'admin'` in the database
2. Check the User table: `SELECT role FROM "User" WHERE email = 'your@email.com'`
3. First user is auto-promoted to admin on first API call

### Settings Don't Persist

1. Check that the AppSettings migration has run
2. Look for console warnings about missing table
3. Run: `cd backend && npx prisma migrate dev`

### Settings Not Updating in Sidebar

1. Verify `refetchGlobalSettings()` is called after saving
2. Check network tab - is the GET request returning new data?
3. Ensure component is using `useAppSettingsValue()` not cached data

---

## Next Steps

- [User Feature](/starter-template/user-feature/) - User profiles and preferences
- [Authentication](/starter-template/auth-feature/) - How auth works
- [Dashboard Feature](/starter-template/dashboard-feature/) - Layout and widgets
- [Registries](/starter-template/registries/) - Full registry reference
