---
title: Admin Feature
description: Complete guide to the admin panel and site configuration
---

import { Aside, Steps, Tabs, TabItem } from '@astrojs/starlight/components';

The admin feature provides a comprehensive admin panel for managing app branding, navigation, toolbar items, and users. It also provides the global `AppSettingsProvider` context that makes these settings available throughout the application.

---

## Overview

The admin panel is accessible at `/admin` and is only visible to users with the `admin` role. It provides:

- **App Settings** - Configure app name, logo, and display options
- **User Management** - View, modify roles, and delete users
- **Navigation Management** - Show/hide and reorder sidebar items
- **Header Toolbar** - Show/hide toolbar items

<Aside type="tip">
  The first user to sign up automatically becomes an admin. You can promote other users in Admin → Users.
</Aside>

---

## Architecture

### The Settings Flow

When a user loads the dashboard, here's what happens:

<Steps>
1. `DashboardPage` renders with `AppSettingsProvider` wrapper
2. `AppSettingsProvider` fetches settings from `GET /api/v1/admin/settings`
3. Settings are stored in React context and made available via hooks
4. `AppSidebar` reads logo, app name, and applies navigation overrides
5. `HeaderToolbar` applies toolbar overrides to hide items
6. When admin saves changes, `refetch()` updates the context and UI updates immediately
</Steps>

### Why Settings GET is Public

The admin API has a unique permission structure:

```
GET  /api/v1/admin/settings  → All authenticated users (for sidebar branding)
PATCH /api/v1/admin/settings → Admin only (to modify settings)
```

This design allows:
- **All users** can see the app logo and name in the sidebar
- **Only admins** can change branding and configuration
- **No separate "site" feature** needed - keeps the codebase simpler

The backend achieves this by registering two routers on the same path:

```typescript
// route.registration.ts

// Public router (just GET /settings)
routeRegistry.register({
  path: '/admin',
  router: adminPublicRoutes,  // Contains GET /settings only
  requiresAuth: true,
  // No requireAdmin middleware
});

// Admin router (everything else)
routeRegistry.register({
  path: '/admin',
  router: adminRoutes,        // Contains PATCH, users, etc.
  requiresAuth: true,
  middleware: [requireAdmin], // Requires admin role
});
```

### Context Provider Structure

The `AppSettingsProvider` wraps the dashboard layout:

```tsx
// DashboardPage.tsx
function DashboardPage() {
  return (
    <AppSettingsProvider>      {/* Fetches and provides settings */}
      <UserProfileProvider>     {/* User profile data */}
        <SidebarProvider>       {/* Sidebar state */}
          <AppSidebar />        {/* Uses useAppSettingsValue() */}
          <SidebarInset>
            <SiteHeader />      {/* HeaderToolbar uses settings */}
            <main>
              <Outlet />
            </main>
          </SidebarInset>
        </SidebarProvider>
      </UserProfileProvider>
    </AppSettingsProvider>
  );
}
```

### File Structure

```
frontend/src/features/admin/
├── index.ts                        # Public exports
├── routes.config.tsx               # Admin routes (/admin/*)
├── navigation.registration.ts      # Registers "Admin" in sidebar
├── admin-pages.registration.ts     # Registers admin pages
├── context/
│   └── AppSettingsContext.tsx      # Global settings provider
├── components/
│   └── AdminLayout.tsx             # Admin panel layout
├── pages/
│   ├── AdminDashboardPage.tsx      # Overview stats
│   ├── AppSettingsPage.tsx         # Branding config
│   ├── AdminUsersPage.tsx          # User management
│   ├── NavigationManagementPage.tsx # Nav overrides
│   └── HeaderToolbarPage.tsx       # Toolbar overrides
├── hooks/
│   ├── useAppSettings.ts           # Admin settings (for editing)
│   ├── useNavigationOverrides.ts   # Nav override management
│   ├── useToolbarOverrides.ts      # Toolbar override management
│   └── useAdminUsers.ts            # User management
└── services/
    └── admin.service.ts            # API client

backend/src/features/admin/
├── index.ts                        # Exports + registrations
├── admin.types.ts                  # Types and Zod schemas
├── admin.service.ts                # Business logic
├── admin.routes.ts                 # Two routers: public + admin
├── route.registration.ts           # Registers both routers
└── service.registration.ts         # Service registry
```

---

## App Settings

### Branding Configuration

The App Settings page allows admins to configure:

| Setting | Description |
|---------|-------------|
| **App Name** | Displayed in sidebar header and page titles |
| **Logo** | Custom logo (uploaded as base64 or URL) |
| **Logo Display Mode** | Logo only, logo + name, or name only |
| **Show Dashboard in Nav** | Whether dashboard appears in main nav |
| **Enable Marketing Pages** | Feature flag for public pages |

### How the Sidebar Uses Settings

The `AppSidebar` component reads settings and applies them:

```tsx
// AppSidebar.tsx (simplified)
export function AppSidebar() {
  const settings = useAppSettingsValue();

  // Determine what to show based on logoDisplayMode
  const showLogo = settings.logoDisplayMode !== 'name-only';
  const showName = settings.logoDisplayMode !== 'logo-only';

  // Use database values with env fallback
  const appName = settings.appName || appConfig.appName;
  const logoUrl = settings.logoUrl;

  return (
    <Sidebar>
      <SidebarHeader>
        <Link to="/dashboard">
          {showLogo && (
            logoUrl ? <img src={logoUrl} /> : <DefaultLogo />
          )}
          {showName && <span>{appName}</span>}
        </Link>
      </SidebarHeader>
      {/* ... */}
    </Sidebar>
  );
}
```

### Using App Settings in Your Components

```tsx
import { useAppSettingsValue } from '@/features/admin';

function MyComponent() {
  const settings = useAppSettingsValue();

  return (
    <header>
      {settings.logoUrl && <img src={settings.logoUrl} alt={settings.appName} />}
      <h1>{settings.appName}</h1>
    </header>
  );
}
```

### Available Hooks

| Hook | Purpose |
|------|---------|
| `useGlobalAppSettings()` | Full context (settings, loading, error, refetch) |
| `useAppSettingsValue()` | Just settings with defaults (most common) |
| `useNavigationOverrides()` | Navigation hidden/order overrides |
| `useToolbarOverrides()` | Toolbar hidden items |

### Refreshing Settings After Save

When an admin saves settings, the UI updates immediately:

```tsx
// AppSettingsPage.tsx
const { refetch: refetchGlobalSettings } = useGlobalAppSettings();

const handleSave = async () => {
  await save();
  // Refresh global settings so sidebar updates immediately
  await refetchGlobalSettings();
};
```

---

## Navigation Overrides

Admins can customise the sidebar navigation without modifying code.

### Hiding Items

From the Navigation Management page:

<Steps>
1. Go to Admin → Navigation
2. Toggle the visibility switch for any item
3. Click "Save Changes"
</Steps>

Items are hidden by ID, so they're still registered but not displayed.

### Reordering Items (Drag and Drop)

<Steps>
1. Go to Admin → Navigation
2. Drag items using the grip handle to reorder
3. Click "Save Changes"
</Steps>

Order overrides are stored per-item and merged with the default order.

<Aside type="tip">
Admins never see order numbers - they simply drag items to the desired position. The system assigns appropriate order values automatically.
</Aside>

### How Overrides Are Applied

The `AppSidebar` applies overrides before passing items to navigation components:

```tsx
// AppSidebar.tsx
function applyNavigationOverrides(
  items: NavigationItem[],
  overrides: NavigationOverrides,
  showDashboardInNav: boolean
): NavigationItem[] {
  // Filter out hidden items
  let filtered = items.filter((item) => {
    // Check admin hidden list
    if (overrides.hidden.includes(item.id)) {
      return false;
    }
    // Check showDashboardInNav setting
    if (item.id === 'dashboard' && !showDashboardInNav) {
      return false;
    }
    return true;
  });

  // Apply order overrides
  if (Object.keys(overrides.orderOverrides).length > 0) {
    filtered = filtered.map((item) => ({
      ...item,
      order: overrides.orderOverrides[item.id] ?? item.order,
    }));

    // Re-sort by order
    filtered.sort((a, b) => (a.order ?? 100) - (b.order ?? 100));
  }

  return filtered;
}
```

### Override Data Structure

```typescript
interface NavigationOverrides {
  hidden: string[];                    // Array of item IDs to hide
  orderOverrides: Record<string, number>; // Item ID → custom order
}

// Example stored in database:
{
  "hidden": ["support", "help"],
  "orderOverrides": {
    "projects": 5,
    "settings": 90
  }
}
```

---

## Toolbar Overrides

Similar to navigation, admins can hide toolbar items:

<Steps>
1. Go to Admin → Header Toolbar
2. Toggle visibility for any item
3. Click "Save Changes"
</Steps>

The `HeaderToolbar` component applies these overrides:

```tsx
// HeaderToolbar.tsx
function applyToolbarOverrides(
  items: ToolbarItem[],
  overrides: ToolbarOverrides
): ToolbarItem[] {
  return items.filter((item) => !overrides.hidden.includes(item.id));
}
```

---

## User Management

The Users page provides:

- **View all users** - List with email, name, role, and join date
- **Change roles** - Promote to admin or demote to user
- **Delete users** - Remove accounts (with confirmation)

### Role Types

| Role | Description |
|------|-------------|
| `user` | Standard user access |
| `admin` | Full access, can manage all settings and users |
| `managed` | Permissions controlled by external module (for future RBAC) |

### Safety Rules

The backend enforces these rules:

- Cannot remove the last admin
- Cannot delete your own account from admin panel
- Cannot demote yourself if you're the last admin

```typescript
// admin.service.ts
async updateUserRole(userId: string, newRole: string) {
  // Prevent removing the last admin
  if (user.role === 'admin' && newRole !== 'admin') {
    const adminCount = await prisma.user.count({
      where: { role: 'admin' },
    });

    if (adminCount <= 1) {
      throw new BadRequestError('Cannot remove the last admin.');
    }
  }
  // ...
}
```

---

## Adding Admin Pages

Features can register custom admin pages using the admin pages registry:

```tsx
// features/my-feature/admin-pages.registration.ts
import { adminPagesRegistry } from '@/config/admin-pages.registry';
import { MyAdminPage } from './pages/MyAdminPage';
import { Settings } from 'lucide-react';

adminPagesRegistry.register({
  id: 'my-feature-settings',
  title: 'My Feature',
  description: 'Configure my feature',
  icon: Settings,
  component: MyAdminPage,
  order: 30,
});
```

The page will automatically appear in the admin sidebar at `/admin/my-feature-settings`.

---

## API Endpoints

### Public Endpoints (All Authenticated Users)

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/v1/admin/settings` | GET | Get app settings (branding, overrides) |

<Aside type="note">
  This endpoint is public so all users can see the app branding in the sidebar. Only GET is allowed - modifications require admin role.
</Aside>

### Admin-Only Endpoints (Require Admin Role)

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/api/v1/admin/settings` | PATCH | Update app settings |
| `/api/v1/admin/navigation` | GET | Get navigation overrides |
| `/api/v1/admin/navigation` | PATCH | Update navigation overrides |
| `/api/v1/admin/toolbar` | GET | Get toolbar overrides |
| `/api/v1/admin/toolbar` | PATCH | Update toolbar overrides |
| `/api/v1/admin/users` | GET | List all users |
| `/api/v1/admin/users/:id/role` | PATCH | Update user role |
| `/api/v1/admin/users/:id` | DELETE | Delete user |

---

## Database Schema

```prisma
model AppSettings {
  id                   String   @id @default("default")
  appName              String   @default("My App")
  logoUrl              String?
  logoDisplayMode      String   @default("logo-and-name")
  showDashboardInNav   Boolean  @default(true)
  enableMarketingPages Boolean  @default(false)
  navigationOverrides  Json     @default("{\"hidden\":[],\"orderOverrides\":{}}")
  toolbarOverrides     Json     @default("{\"hidden\":[]}")
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
}
```

### Singleton Pattern

The table uses a singleton pattern - there's only ever one row with `id = "default"`. The service auto-creates this row on first access:

```typescript
// admin.service.ts
async getAppSettings(): Promise<AppSettings> {
  let settings = await prisma.appSettings.findUnique({
    where: { id: 'default' },
  });

  // Auto-create with defaults if not exists
  if (!settings) {
    settings = await prisma.appSettings.create({
      data: { id: 'default' },
    });
  }

  return settings;
}
```

---

## Troubleshooting

### Logo Not Showing After Upload

1. Ensure you clicked "Save Changes" after uploading
2. Check browser console for errors
3. Verify the `AppSettingsProvider` wraps your dashboard layout
4. Check that `useAppSettingsValue()` is returning the expected `logoUrl`

### Navigation Overrides Not Applied

1. Verify the `AppSettingsProvider` is in your component tree
2. Check that `useAppSettingsValue()` returns the expected overrides
3. Ensure the item IDs match (check registration files)
4. Confirm the sidebar is using `applyNavigationOverrides()`

### Can't Access Admin Panel

1. Verify your user has `role: 'admin'` in the database
2. Check the User table: `SELECT role FROM "User" WHERE email = 'your@email.com'`
3. First user is auto-promoted to admin on first API call

### Settings Don't Persist

1. Check that the AppSettings migration has run
2. Look for console warnings about missing table
3. Run: `cd backend && npx prisma migrate dev`

### Settings Not Updating in Sidebar

1. Verify `refetchGlobalSettings()` is called after saving
2. Check network tab - is the GET request returning new data?
3. Ensure component is using `useAppSettingsValue()` not cached data

---

## Next Steps

- [User Feature](/starter-template/user-feature/) - User profiles and preferences
- [Authentication](/starter-template/auth-feature/) - How auth works
- [Dashboard Feature](/starter-template/dashboard-feature/) - Layout and widgets
- [Registries](/starter-template/registries/) - Full registry reference
