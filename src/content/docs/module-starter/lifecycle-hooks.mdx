---
title: Lifecycle Hooks
description: Filter and action registries for advanced module integration
---

import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

Modules can hook into application lifecycle events using **filters** (transform data) and **actions** (execute side effects). These are pipeline registries that enable modules to extend functionality without modifying core code.

<Aside type="note">
This page covers how modules use filter and action registries. For the complete API reference, see the [Filter Registry](/starter-template/registries/#filter-registry) and [Action Registry](/starter-template/registries/#action-registry) in the starter template docs.
</Aside>

---

## Overview

| Registry | Purpose | Returns Value? |
|----------|---------|----------------|
| **Filter** | Transform data at hook points | Yes - modified data |
| **Action** | Execute side effects at hook points | No - fire and forget |

<Aside type="tip">
Use **filters** when you need to modify data (e.g., format a display name).
Use **actions** when you need side effects (e.g., log an event, send a notification).
</Aside>

---

## Filter Registry

Filters transform data as it passes through hook points. Multiple filters can chain together—each receives the output of the previous filter.

### Basic Usage

<Tabs>
  <TabItem label="Frontend">
```typescript
// filter.registration.ts
import { filterRegistry } from '@/config/filter.registry';

// Register a filter
filterRegistry.register(
  'user.displayName',        // Hook name
  'my-feature-titles',       // Unique ID (prefix with module name)
  (name, context) => {
    // Add title prefix if user has one
    if (context?.user?.title) {
      return `${context.user.title} ${name}`;
    }
    return name;
  },
  10                         // Order (lower = runs first)
);
```
  </TabItem>
  <TabItem label="Backend">
```typescript
// filter.registration.ts
import { filterRegistry } from '../../config/filter.registry.js';

// Sync filter
filterRegistry.register(
  'api.user.profile.response',
  'my-feature-mask-email',
  (profile) => ({
    ...profile,
    email: maskEmail(profile.email),
  }),
  20
);

// Async filter (for database lookups, external APIs)
filterRegistry.registerAsync(
  'api.user.profile.response',
  'my-feature-enrich',
  async (profile, ctx) => {
    const stats = await getStats(profile.id);
    return { ...profile, stats };
  },
  5
);
```
  </TabItem>
</Tabs>

### Applying Filters

```typescript
// Somewhere in your code where the hook point is defined
const displayName = filterRegistry.apply(
  'user.displayName',    // Hook name
  user.name,             // Initial value
  { user }               // Context object
);

// Async (backend)
const response = await filterRegistry.applyAsync('api.user.profile.response', profile, ctx);

// Apply all (sync then async, backend only)
const result = await filterRegistry.applyAll('hook.name', data, ctx);
```

### Filter Methods

| Method | Description |
|--------|-------------|
| `register(hook, id, fn, order?)` | Register sync filter |
| `registerAsync(hook, id, fn, order?)` | Register async filter (backend only) |
| `unregister(hook, id)` | Remove a sync filter |
| `unregisterAsync(hook, id)` | Remove an async filter (backend only) |
| `apply(hook, value, ctx?)` | Run sync filters |
| `applyAsync(hook, value, ctx?)` | Run async filters (backend only) |
| `applyAll(hook, value, ctx?)` | Run sync then async (backend only) |
| `hasFilters(hook)` | Check if any filters exist (sync or async) |
| `hasSyncFilters(hook)` | Check if sync filters exist (backend only) |
| `hasAsyncFilters(hook)` | Check if async filters exist (backend only) |
| `getHooks()` | List all hook names |
| `getFilterCount(hook)` | Get count of filters for a hook |
| `getFilterIds(hook)` | List filter IDs (backend returns `{sync, async}`) |

---

## Action Registry

Actions execute side effects at hook points. Unlike filters, they don't return values and can't modify data.

### Basic Usage

<Tabs>
  <TabItem label="Frontend">
```typescript
// action.registration.ts
import { actionRegistry } from '@/config/action.registry';

// Sync action
actionRegistry.addAction(
  'user.loggedIn',           // Hook name
  'my-feature-analytics',    // Unique ID
  (context) => {
    trackEvent('login', { userId: context.user.id });
  },
  10                         // Order
);

// Async action
actionRegistry.addActionAsync(
  'settings.saved',
  'my-feature-sync',
  async (context) => {
    await syncToExternalService(context.settings);
  },
  20
);
```
  </TabItem>
  <TabItem label="Backend">
```typescript
// action.registration.ts
import { actionRegistry } from '../../config/action.registry.js';

// Sync action
actionRegistry.addAction(
  'user.created',
  'my-feature-welcome',
  (context) => {
    console.log(`New user: ${context.userId}`);
  }
);

// Async action
actionRegistry.addActionAsync(
  'order.completed',
  'my-feature-notify',
  async (context) => {
    await notificationService.send(context.userId, 'Order complete!');
  },
  30
);
```
  </TabItem>
</Tabs>

### Triggering Actions

```typescript
// Execute sync actions only
actionRegistry.doAction('user.loggedIn', { user, method: 'email' });

// Execute async actions sequentially
await actionRegistry.doActionAsync('settings.saved', { settings });

// Execute all (sync first, then async) - backend
await actionRegistry.doActionAll('user.created', { user, req });

// Execute async in parallel (for independent operations) - backend
await actionRegistry.doActionParallel('notifications.send', { notifications });
```

### Action Methods

| Method | Description |
|--------|-------------|
| `addAction(hook, id, fn, order?)` | Register sync action |
| `addActionAsync(hook, id, fn, order?)` | Register async action |
| `removeAction(hook, id)` | Remove an action |
| `doAction(hook, context)` | Execute sync actions |
| `doActionAsync(hook, context)` | Execute async actions sequentially |
| `doActionAll(hook, context)` | Execute sync then async (backend) |
| `doActionParallel(hook, context)` | Execute async in parallel (backend) |
| `hasActions(hook)` | Check if actions exist |
| `getHooks()` | Get all hook names |

---

## Common Hook Points

### Frontend Hooks

| Hook | Type | When | Context |
|------|------|------|---------|
| `user.displayName` | Filter | Format display name | `{ user }` |
| `user.avatarUrl` | Filter | Modify avatar URL | `{ user }` |
| `dashboard.widgets` | Filter | Modify widget list | `{ widgets }` |
| `nav.main.items` | Filter | Modify navigation | `{ items }` |
| `user.loggedIn` | Action | After login | `{ user, method }` |
| `user.loggedOut` | Action | After logout | `{ userId }` |
| `settings.saved` | Action | After settings save | `{ settings, page }` |
| `theme.changed` | Action | After theme change | `{ theme }` |

### Backend Hooks

| Hook | Type | When | Context |
|------|------|------|---------|
| `api.user.profile.response` | Filter | Before sending profile | `{ userId }` |
| `api.*.response` | Filter | Before any API response | Varies |
| `auth.login` | Action | Successful login | `{ userId, method }` |
| `auth.failed` | Action | Failed login attempt | `{ email, reason }` |
| `user.created` | Action | User registered | `{ userId, email }` |
| `resource.created` | Action | Resource created | `{ resourceId, type }` |
| `resource.deleted` | Action | Resource deleted | `{ resourceId, type }` |

---

## Hook Naming Convention

| Pattern | Location | Examples |
|---------|----------|----------|
| `user.{property}` | Frontend | `user.displayName`, `user.avatarUrl` |
| `dashboard.{element}` | Frontend | `dashboard.widgets`, `dashboard.layout` |
| `nav.{section}.items` | Frontend | `nav.main.items`, `nav.secondary.items` |
| `api.{feature}.{action}.response` | Backend | `api.user.profile.response` |
| `service.{feature}.{method}` | Backend | `service.user.getProfile` |
| `auth.{event}` | Both | `auth.login`, `auth.failed` |

---

## Creating Custom Hooks

Modules can define their own hooks for other modules to use:

### Define the Hook Point

```typescript
// In your module's code
import { filterRegistry } from '@/config/filter.registry';
import { actionRegistry } from '@/config/action.registry';

// Apply filter before returning data
export async function getFormattedData() {
  const rawData = await fetchData();

  // Allow other modules to transform the data
  const data = filterRegistry.apply('myModule.data.format', rawData, {
    source: 'api',
  });

  return data;
}

// Trigger action when something happens
export async function processItem(item: Item) {
  await doProcessing(item);

  // Notify other modules
  await actionRegistry.doActionAsync('myModule.item.processed', {
    itemId: item.id,
    result: 'success',
  });
}
```

### Document Your Hooks

Add to your module's README:

```markdown
## Available Hooks

### Filters

| Hook | Purpose | Context |
|------|---------|---------|
| `myModule.data.format` | Transform data before display | `{ source }` |

### Actions

| Hook | When | Context |
|------|------|---------|
| `myModule.item.processed` | After item processing | `{ itemId, result }` |
```

---

## Template Examples

### Filter Registration Template

```typescript
// src/templates/frontend/registrations.ts
export const FILTER_REGISTRATION = `// ========================================================================
// FILE: frontend/src/features/my-feature/filter.registration.ts
// PURPOSE: Register filters for my-feature
// ========================================================================

import { filterRegistry } from '@/config/filter.registry';

// Transform user display name
filterRegistry.register(
  'user.displayName',
  'my-feature-premium-badge',
  (name, context) => {
    if (context?.user?.isPremium) {
      return \`\${name} ⭐\`;
    }
    return name;
  },
  15
);
`;
```

### Action Registration Template

```typescript
export const ACTION_REGISTRATION = `// ========================================================================
// FILE: frontend/src/features/my-feature/action.registration.ts
// PURPOSE: Register actions for my-feature
// ========================================================================

import { actionRegistry } from '@/config/action.registry';

// Track user login
actionRegistry.addAction(
  'user.loggedIn',
  'my-feature-login-track',
  (context) => {
    console.log('[my-feature] User logged in:', context.user.id);
  },
  20
);

// Sync settings after save
actionRegistry.addActionAsync(
  'settings.saved',
  'my-feature-settings-sync',
  async (context) => {
    if (context.page === 'my-feature') {
      await syncMyFeatureSettings(context.settings);
    }
  },
  30
);
`;
```

---

## Best Practices

### Do

- **Prefix IDs with module name** - `my-feature-transform` not just `transform`
- **Handle errors gracefully** - Don't let filter/action errors break the app
- **Use appropriate order values** - Lower = runs first, use 10-50 for most modules
- **Document your hooks** - Help other developers integrate with your module
- **Clean up on uninstall** - Remove filters/actions if module provides uninstall logic

### Don't

- **Don't throw in hooks** - Catch errors and handle gracefully
- **Don't use hooks for required logic** - Hooks are optional extensions
- **Don't block async actions** - Keep them fast or use background jobs
- **Don't modify context object** - Create new objects instead

---

## Next Steps

- [Code Templates](/module-starter/templates/) - More template examples
- [Module Structure](/module-starter/module-structure/) - File organisation
- [Creating Modules](/module-starter/creating-modules/) - Step-by-step guide
