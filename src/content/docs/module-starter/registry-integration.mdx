---
title: Registry Integration
description: How modules connect to the starter template through registries
---

import { Aside, Tabs, TabItem } from '@astrojs/starlight/components';

Modules integrate with the starter template through **registries** — singleton objects that modules register with instead of editing shared files. This is the core architectural principle: modules never modify the app's core code.

Each registry handles a specific integration point (navigation, dashboard, settings, etc.). Your module imports the registry, calls its `register()` method, and the app picks it up automatically.

<Aside type="tip">
Registration files are imported as **side effects** — they run code on import and don't need to export anything. Your module's barrel `index.ts` imports them first, before any exports. See [Module Structure — Index File Patterns](/module-starter/module-structure/#index-file-patterns) for examples.
</Aside>

For the full API reference for each registry (all fields, types, and options), see the starter template's [Registry Reference](/starter-template/registries/).

---

## Frontend Registries

### Navigation

Register sidebar items, bottom bar items, and user menu entries.

**Import:** `@/config/navigation.registry`

```typescript
import { navigationRegistry } from '@/config/navigation.registry';
import { MessageSquare } from 'lucide-react';

// Main sidebar item
navigationRegistry.registerMain({
  id: 'ai-chat',
  title: 'AI Chat',
  url: '/dashboard/ai-chat',
  icon: MessageSquare,
  order: 50,
  // sidebarSection: 'ai-tools',  // Optional: group items
  // badge: '3',                   // Optional: notification badge
});

// Bottom sidebar (optional)
// navigationRegistry.registerSecondary({ ... });

// User dropdown menu (optional)
// navigationRegistry.registerUserMenu({ ... });
```

You can also register sidebar sections to group related items:

```typescript
navigationRegistry.registerSection({
  id: 'ai-tools',
  label: 'AI Tools',
  showLabel: true,
  order: 40,
});
```

### Dashboard

Register widgets on the user's dashboard.

**Import:** `@/config/dashboard.registry`

```typescript
import { dashboardRegistry } from '@/config/dashboard.registry';
import { MyFeatureWidget } from '../components/widgets/MyFeatureWidget';

dashboardRegistry.register({
  id: 'my-feature-overview',
  title: 'My Feature',
  component: MyFeatureWidget,
  size: '2x1',              // '1x1' | '2x1' | '1x2' | '2x2' | 'full'
  order: 50,
  category: 'activity',
  canHide: true,
});
```

### Settings Pages

Add new pages to the settings section, or replace placeholder pages with real implementations.

**Import:** `@/config/settings-pages.registry`

<Tabs>
  <TabItem label="New Page">
    ```typescript
    import { settingsPagesRegistry } from '@/config/settings-pages.registry';
    import { Sparkles } from 'lucide-react';
    import { MyFeatureSettingsPage } from '../pages/MyFeatureSettingsPage';

    settingsPagesRegistry.register({
      id: 'my-feature',
      title: 'My Feature',
      description: 'Configure My Feature settings',
      icon: Sparkles,
      component: MyFeatureSettingsPage,
      order: 60,
    });
    ```
  </TabItem>
  <TabItem label="Replace Placeholder">
    ```typescript
    import { settingsPagesRegistry } from '@/config/settings-pages.registry';
    import { CreditCard } from 'lucide-react';
    import { BillingPage } from '../pages/BillingPage';

    // Replace the stub Billing page with a real implementation
    settingsPagesRegistry.register({
      id: 'billing',            // Must match existing placeholder ID
      title: 'Billing',
      icon: CreditCard,
      component: BillingPage,
      order: 50,
      isReplacement: true,      // IMPORTANT: replaces the placeholder
    });
    ```
  </TabItem>
</Tabs>

### Admin Pages

Register pages in the admin panel (requires admin role).

**Import:** `@/config/admin-pages.registry`

```typescript
import { adminPagesRegistry } from '@/config/admin-pages.registry';
import { Sparkles } from 'lucide-react';
import { MyFeatureAdminPage } from './pages/MyFeatureAdminPage';

adminPagesRegistry.register({
  id: 'my-feature',               // URL: /admin/my-feature
  title: 'My Feature Settings',
  description: 'Configure My Feature options',
  icon: Sparkles,
  component: MyFeatureAdminPage,
  order: 50,
});
```

### Preferences

Register user preference sections (appear in user settings).

**Import:** `@/config/preferences.registry`

```typescript
import { preferencesRegistry } from '@/config/preferences.registry';
import { MyFeaturePreferences } from '../components/settings/MyFeaturePreferences';

preferencesRegistry.register({
  id: 'my-feature',
  title: 'My Feature',
  component: MyFeaturePreferences,
  order: 50,
});
```

### Integrations

Register third-party integration cards (appear in integrations settings page).

**Import:** `@/config/integrations.registry`

```typescript
import { integrationsRegistry } from '@/config/integrations.registry';
import { Cloud } from 'lucide-react';
// Icon: LucideIcon or ComponentType<{ className?: string }> (e.g., custom SVG)
import { MyFeatureIntegration } from '../components/integrations/MyFeatureIntegration';

integrationsRegistry.register({
  id: 'my-feature',
  name: 'My Feature Service',
  description: 'Connect to My Feature for enhanced functionality',
  icon: Cloud,
  category: 'productivity',  // 'storage' | 'communication' | 'productivity' | 'developer' | 'social' | 'other'
  component: MyFeatureIntegration,
  order: 50,
});
```

### Header Toolbar

Add buttons, toggles, dropdowns, or custom components to the app header.

**Import:** `@/config/header-toolbar.registry`

```typescript
import { headerToolbarRegistry } from '@/config/header-toolbar.registry';
import { Sparkles } from 'lucide-react';

// Action button (simple click)
headerToolbarRegistry.register({
  id: 'my-feature-action',
  type: 'action',             // 'action' | 'toggle' | 'dropdown' | 'custom'
  position: 'left',           // 'left' (after breadcrumbs) | 'right' (end of header)
  order: 50,
  icon: Sparkles,
  label: 'My Feature Action',
  onClick: () => { /* handler */ },
});
```

### Personal Info Fields

Add custom fields to the Personal Information settings page.

**Import:** `@/config/personal-info-fields.registry`

```typescript
import { personalInfoFieldsRegistry } from '@/config/personal-info-fields.registry';

// Optional: group related fields
personalInfoFieldsRegistry.registerCategory({
  id: 'my-feature',
  label: 'My Feature Settings',
  order: 50,
});

// Register a text field
personalInfoFieldsRegistry.register({
  id: 'myFeatureUsername',
  type: 'text',              // 'text' | 'textarea' | 'select' | 'custom'
  label: 'My Feature Username',
  category: 'my-feature',
  order: 10,
  storage: 'preferences',    // Stored in User.preferences JSON
});
```

### Filters (Frontend)

Transform data at hook points using a pipeline pattern.

**Import:** `@/config/filter.registry`

```typescript
import { filterRegistry } from '@/config/filter.registry';

filterRegistry.register(
  'user.displayName',           // Hook name
  'my-feature-display-name',    // Unique filter ID
  (name, context) => {
    // Transform and return
    return name;
  },
  10  // Order: lower runs first
);
```

### Actions (Frontend)

Run side effects at hook points (fire-and-forget).

**Import:** `@/config/action.registry`

```typescript
import { actionRegistry } from '@/config/action.registry';

actionRegistry.addAction(
  'user.loggedIn',              // Hook name
  'my-feature-login-track',     // Unique action ID
  (context) => {
    console.log('[my-feature] User logged in:', context.user?.id);
  },
  10  // Order: lower runs first
);

// Async version for API calls
// actionRegistry.addActionAsync('hook', 'id', async (ctx) => { ... }, 20);
```

---

## Backend Registries

Backend registrations use `.js` extensions for all relative imports (ESM requirement).

### Routes

Mount Express routers at versioned API paths.

**Import:** `../../config/route.registry.js`

```typescript
import { routeRegistry } from '../../config/route.registry.js';
import { myFeatureRoutes } from './my-feature.routes.js';

routeRegistry.register({
  path: '/my-feature',
  router: myFeatureRoutes,
  feature: 'my-feature',
  versions: ['v1'],           // Mounted at /api/v1/my-feature
  requiresAuth: true,
  description: 'My Feature management',
});
```

### Services

Register business logic services with type-safe access via declaration merging.

**Import:** `../../config/service.registry.js`

```typescript
import { serviceRegistry } from '../../config/service.registry.js';
import { myFeatureService } from './my-feature.service.js';

// Type augmentation for type-safe access
declare module '../../config/service.registry.js' {
  interface ServiceTypes {
    'my-feature': typeof myFeatureService;
  }
}

serviceRegistry.register('my-feature', myFeatureService, {
  feature: 'my-feature',
  description: 'My Feature business logic',
});
```

<Aside type="note">
For plugins or runtime registration, use `serviceRegistry.registerDynamic()` instead. See [Registry Reference — Service Registry](/starter-template/registries/#service-registry) for details.
</Aside>

### Filters (Backend)

Same pipeline pattern as frontend, with async support for database/API calls.

**Import:** `../../config/filter.registry.js`

```typescript
import { filterRegistry } from '../../config/filter.registry.js';

// Sync filter
filterRegistry.register(
  'api.user.profile.response',
  'my-feature-mask',
  (profile, context) => {
    return profile; // Transform and return
  },
  20
);

// Async filter (for DB/API calls)
// filterRegistry.registerAsync('hook', 'id', async (data, ctx) => { ... }, 5);
```

### Actions (Backend)

Same fire-and-forget pattern as frontend, with async support.

**Import:** `../../config/action.registry.js`

```typescript
import { actionRegistry } from '../../config/action.registry.js';

actionRegistry.addAction(
  'user.created',
  'my-feature-welcome',
  (context) => {
    console.log('[my-feature] New user created:', context.userId);
  },
  10
);

// Async version
// actionRegistry.addActionAsync('hook', 'id', async (ctx) => { ... }, 20);
```

---

## Order Convention

All registries use a **0-100 scale** for ordering (lower number = appears first):

| Range | Use For | Examples |
|-------|---------|----------|
| **0-25** | Primary features | Dashboard (10), Home (15) |
| **26-50** | Core features | Projects (30), Documents (40) |
| **51-75** | Secondary features | Settings (60), Reports (65) |
| **76-100** | Utilities | Help (80), Admin (90) |

The default order is `50` if not specified. Admins can override order values via the admin panel.

<Aside type="tip">
Use `50` for most modules. This puts your feature in the middle, leaving room for admins to reorder. Pick from the ranges above if you want a sensible default position.
</Aside>

---

## Quick Reference

### Frontend Registry Summary

| Registry | Import From | Method | Purpose |
|----------|------------|--------|---------|
| Navigation | `@/config/navigation.registry` | `registerMain()`, `registerSecondary()`, `registerUserMenu()` | Sidebar & menu items |
| Dashboard | `@/config/dashboard.registry` | `register()` | Dashboard widgets |
| Settings Pages | `@/config/settings-pages.registry` | `register()` | Settings section pages |
| Admin Pages | `@/config/admin-pages.registry` | `register()` | Admin panel pages |
| Preferences | `@/config/preferences.registry` | `register()` | User preference sections |
| Integrations | `@/config/integrations.registry` | `register()` | Third-party integrations |
| Header Toolbar | `@/config/header-toolbar.registry` | `register()` | Header buttons & dropdowns |
| Personal Info | `@/config/personal-info-fields.registry` | `register()`, `registerCategory()` | Profile page fields |
| Filter | `@/config/filter.registry` | `register()` | Data transformation pipeline |
| Action | `@/config/action.registry` | `addAction()`, `addActionAsync()` | Side-effect hooks |

### Backend Registry Summary

| Registry | Import From | Method | Purpose |
|----------|------------|--------|---------|
| Routes | `../../config/route.registry.js` | `register()` | API route mounting |
| Services | `../../config/service.registry.js` | `register()`, `registerDynamic()` | Business logic access |
| Filter | `../../config/filter.registry.js` | `register()`, `registerAsync()` | Data transformation pipeline |
| Action | `../../config/action.registry.js` | `addAction()`, `addActionAsync()` | Side-effect hooks |

---

## Keeping in Sync with the Starter Template

When the starter template's registries change (new fields, renamed methods, updated types), your module templates need to match. Here's where to update:

| If Starter Template Changes... | Update in Module Starter... |
|-------------------------------|---------------------------|
| Registry API (method names, parameters) | `src/templates/frontend/registrations.ts` and `src/templates/backend/registrations.ts` |
| Registry import paths | Same registration template files |
| Route configuration patterns | `src/templates/frontend/routes.ts` |
| Feature barrel file pattern | `src/templates/frontend/routes.ts` (INDEX_TEMPLATE) and `src/templates/backend/routes.ts` |
| `DashboardWidgetProps` interface | `src/templates/frontend/components.ts` (WIDGET_COMPONENT_TEMPLATE) |
| Backend service patterns | `src/templates/backend/services.ts` |
| Integration categories | `src/templates/frontend/registrations.ts` and `src/scaffold/types.ts` |

<Aside type="caution">
After changing any template file, always bump the scaffold version with `npm run scaffold:version:patch`. Without this, cloned modules won't pick up the changes via `scaffold:update`.
</Aside>

---

## Next Steps

- [Scaffold Architecture](/module-starter/scaffold/) — How registrations are auto-wired during installation
- [Module Structure](/module-starter/module-structure/) — Index file patterns and registration file conventions
- [Lifecycle Hooks](/module-starter/lifecycle-hooks/) — Filter and action hook details
- [Code Templates](/module-starter/templates/) — Copy-paste templates for all registrations
- [Registry Reference](/starter-template/registries/) — Full API reference (starter template docs)
