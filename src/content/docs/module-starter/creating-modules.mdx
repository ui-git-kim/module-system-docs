---
title: Creating Modules
description: Step-by-step guide to creating a new module package
---

import { Steps, Tabs, TabItem, Aside, FileTree } from '@astrojs/starlight/components';

This guide walks through creating a new module from the module starter template.

---

## Quick Start

<Steps>
1. **Clone the module starter**

   <Tabs>
     <TabItem label="Windows">
       ```powershell
       # Run the create script (recommended)
       .\create-module.ps1
       ```
     </TabItem>
     <TabItem label="macOS/Linux">
       ```bash
       # Run the create script (recommended)
       ./create-module.sh
       ```
     </TabItem>
     <TabItem label="Manual">
       ```bash
       git clone https://github.com/ui-git-kim/unique-react-fullstack-module-starter my-module
       cd my-module
       git remote rename origin scaffold-upstream
       mv CLAUDE.MODULE.md CLAUDE.md
       ```
     </TabItem>
   </Tabs>

   The create script:
   - Prompts for module name
   - Clones with git history (for scaffold updates)
   - Renames `origin` to `scaffold-upstream`
   - Updates `package.json` and `src/module.ts` with your module name
   - Installs dependencies
   - Creates initial commit

2. **Update module identity**

   Edit `package.json`:
   ```json
   {
     "name": "my-billing-module",
     "description": "Billing and subscription management",
     "bin": {
       "my-billing-module": "./dist/cli.js"
     }
   }
   ```

   Edit `src/module.ts`:
   ```typescript
   export const moduleDefinition: ModuleDefinition = {
     id: 'billing',              // kebab-case, used in file paths
     name: 'Billing',            // Human readable
     description: 'Billing and subscription management',
     version: '1.0.0',
     // ... templates configuration
   };
   ```

3. **Write your templates**

   Templates live in `src/templates/`. See [Code Templates](/module-starter/templates/) for examples.

4. **Build and test**

   ```bash
   npm run build
   npm link

   # In a starter project
   cd ../my-app
   npx my-billing-module init
   ```

5. **Publish** (optional)

   ```bash
   npm run release:patch    # Creates git tag
   npm publish              # Publish to npm
   ```
</Steps>

---

## The Create Script

The `create-module.ps1` (Windows) or `create-module.sh` (macOS/Linux) script automates module setup:

### What It Does

1. **Prompts for module name** - Accepts any format, converts to kebab-case
2. **Prompts for save location** - Defaults to parent directory
3. **Clones via git** - Preserves history for scaffold updates
4. **Configures remotes** - Renames `origin` to `scaffold-upstream`
5. **Removes scaffold-only files** - `create-module.ps1`, `create-module.sh`, etc.
6. **Renames CLAUDE files** - `CLAUDE.MODULE.md` becomes `CLAUDE.md`
7. **Updates configuration** - `package.json`, `src/module.ts`, `README.md`
8. **Installs dependencies** - Runs `npm install`
9. **Creates initial commit** - Clean starting point

### Name Conversion

The script converts any input to kebab-case:

| Input | Converted |
|-------|-----------|
| `My Feature` | `my-feature` |
| `AI_Chat_Bot` | `ai-chat-bot` |
| `billingModule` | `billing-module` |

---

## What to Edit

The module starter has two distinct parts. Knowing which files are yours and which are shared infrastructure saves time and prevents breaking the scaffold update mechanism.

### Your Code (Edit These)

| File | Purpose |
|------|---------|
| `src/module.ts` | Module identity, configuration, templates, prompts |
| `src/templates/**/*.ts` | Template string constants that generate code in apps |
| `package.json` | Module name, version, dependencies, bin command |
| `CLAUDE.md` | AI assistant instructions for your module |

### Shared Infrastructure (Do NOT Edit)

| File | Purpose |
|------|---------|
| `src/cli.ts` | CLI entry point and command routing |
| `src/scaffold/**/*.ts` | Installation, update, uninstall, enable/disable logic |
| `scripts/*` | Version bump and build scripts |
| `VERSION` | Scaffold infrastructure version (auto-managed) |

<Aside type="caution">
Scaffold files are maintained upstream in the module starter repo. Editing them in your cloned module will cause merge conflicts when you run `scaffold:update`. If you find a bug, report it upstream.
</Aside>

---

## Module Configuration

The `src/module.ts` file defines everything about your module. Here's a billing module example showing all the key configuration options:

```typescript
import type { ModuleDefinition } from './scaffold/index.js';
import { SCHEMA } from './templates/schema.js';
import * as frontend from './templates/frontend/index.js';
import * as backend from './templates/backend/index.js';

export const moduleDefinition: ModuleDefinition = {
  // Identity
  id: 'billing',
  name: 'Billing',
  description: 'Billing and subscription management',
  version: '1.0.0',

  // Database schema (optional - delete if no database needed)
  schema: {
    content: SCHEMA,
    modelNames: ['billing_subscription', 'billing_invoice'],
  },

  // Frontend configuration
  frontend: {
    // Directories to create in the feature folder
    directories: ['pages', 'components', 'hooks', 'services', 'types', 'registrations'],

    // Template files: { 'relative/path': templateContent }
    templates: {
      'routes.config.tsx': frontend.ROUTES_CONFIG,
      'navigation.registration.ts': frontend.NAVIGATION_REGISTRATION,
      'pages/BillingPage.tsx': frontend.PAGE_TEMPLATE,
      'services/billing.service.ts': frontend.SERVICE_TEMPLATE,
      'types/index.ts': frontend.TYPES_TEMPLATE,
    },

    // Index/barrel file (exports + registration imports)
    indexFiles: [
      { path: 'index.ts', content: frontend.INDEX_TEMPLATE },
    ],

    // shadcn/ui components to install
    shadcnComponents: ['card', 'button', 'badge'],

    // npm dependencies for frontend
    dependencies: [],

    // Navigation config (documentation - actual config in navigation.registration.ts)
    navigation: {
      sidebarItems: [
        { title: 'Billing', url: '/billing', icon: 'CreditCard' },
      ],
    },

    // Route config (documentation - actual routes in routes.config.tsx)
    routes: {
      protectedRoutes: [
        { path: 'billing', element: 'BillingPage' },
      ],
      insertAfter: 'auto',
    },

    // Registry registrations (each generates a separate file)
    registrations: [
      {
        type: 'settingsPage',
        path: 'registrations/settings-page.registration.ts',
        content: frontend.SETTINGS_PAGE_REGISTRATION,
      },
      // {
      //   type: 'dashboard',
      //   path: 'registrations/dashboard.registration.ts',
      //   content: frontend.DASHBOARD_REGISTRATION,
      // },
    ],
  },

  // Backend configuration (optional - delete for frontend-only modules)
  backend: {
    // Template files: { 'filename': templateContent }
    templates: {
      'billing.routes.ts': backend.ROUTES_TEMPLATE,
      'billing.service.ts': backend.SERVICE_TEMPLATE,
      'billing.types.ts': backend.TYPES_TEMPLATE,
      'route.registration.ts': backend.ROUTE_REGISTRATION,
      'service.registration.ts': backend.SERVICE_REGISTRATION,
    },

    // Index file template (side-effect imports + exports)
    indexTemplate: backend.INDEX_TEMPLATE,

    // npm dependencies for backend
    dependencies: ['stripe'],

    // API route path (documentation)
    apiPath: '/api/v1/billing',

    // Whether module has an init function
    hasInit: false,
  },

  // Interactive prompts (optional)
  prompts: [
    {
      id: 'provider',
      type: 'select',
      question: 'Which payment provider?',
      options: [
        { value: 'stripe', label: 'Stripe' },
        { value: 'paddle', label: 'Paddle' },
      ],
      default: 'stripe',
    },
  ],

  // Features list (shown in CLI summary after installation)
  features: [
    'Subscription management',
    'Invoice generation',
    'Payment processing',
  ],

  // Environment variables (optional - split into frontend/backend)
  envVariables: {
    backend: [
      {
        name: 'STRIPE_SECRET_KEY',
        description: 'Stripe secret API key',
        required: true,
        secret: true,
      },
    ],
    frontend: [
      {
        name: 'BILLING_PUBLIC_KEY',       // Auto-prefixed with VITE_
        description: 'Stripe publishable key',
      },
    ],
  },
};
```

<Aside type="tip">
The default `src/module.ts` in the module starter includes all options with comments. Start by editing the identity fields, then customise the templates and registrations for your module.
</Aside>

### Configuration Reference

| Field | Required | Purpose |
|-------|----------|---------|
| `id` | ✅ | Kebab-case identifier used in file paths and CLI |
| `name` | ✅ | Human-readable name for CLI output |
| `version` | ✅ | Semver version stamped into generated file headers |
| `frontend.templates` | ✅ | `Record<string, string>` mapping relative paths to template content |
| `frontend.indexFiles` | ✅ | Barrel files with side-effect registration imports |
| `frontend.directories` | ✅ | Folder structure to create in the feature directory |
| `frontend.shadcnComponents` | ✅ | UI components to install (can be empty array) |
| `frontend.navigation` | ✅ | Navigation metadata (actual config lives in template) |
| `frontend.routes` | ✅ | Route metadata (actual routes live in template) |
| `frontend.registrations` | Optional | Array of registry registration files to generate |
| `backend` | Optional | Delete entirely for frontend-only modules |
| `backend.indexTemplate` | Optional | Custom barrel file (recommended over auto-generation) |
| `schema` | Optional | Prisma models (no `@relation` directives) |
| `prompts` | Optional | Questions asked during `npx my-module init` |
| `features` | ✅ | Feature list shown in post-install summary |
| `envVariables` | Optional | Split into `{ frontend: [], backend: [] }` |
| `requiredModules` | Optional | Module IDs that must be installed first |
| `lifecycle` | Optional | Hooks for install, update, activate, deactivate, uninstall |

---

## Template Placeholders

Templates use placeholder patterns that get replaced during installation:

### Name Patterns

| Pattern | Replaced With | Example |
|---------|--------------|---------|
| `my-feature` | Module ID (kebab) | `billing` |
| `myFeature` | camelCase | `billing` |
| `MyFeature` | PascalCase | `Billing` |
| `my_feature` | snake_case | `billing` |

### Variable Substitution

Use `{{variableName}}` for values from prompts:

```typescript
// Template
const provider = '{{provider}}';
const apiKey = process.env.{{apiKeyEnvVar}};

// With default fallback
const timeout = {{timeout|5000}};
```

### Conditional Blocks

Use `{{#if}}` to include or exclude template sections based on prompt answers:

```typescript
{{#if includeApi}}
import { api } from '@/lib/api';
{{/if}}

{{#if provider === 'stripe'}}
import Stripe from 'stripe';
{{else}}
import { Paddle } from '@paddle/paddle-node-sdk';
{{/if}}
```

Supports simple truthy checks, `===` / `!==` equality, `{{else}}`, and nesting. See [Scaffold Architecture — Conditional Blocks](/module-starter/scaffold/#conditional-blocks) for full details.

### Example Template

```typescript
// src/templates/frontend/pages.ts
export const PAGE_TEMPLATE = `// ========================================================================
// FILE: frontend/src/features/my-feature/pages/MyFeaturePage.tsx
// PURPOSE: Main page for my-feature
// ========================================================================

import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

export function MyFeaturePage() {
  return (
    <div>
      <div className="mb-6">
        <h1 className="text-xl font-semibold">My Feature</h1>
      </div>
      <Card>
        <CardHeader>
          <CardTitle>Welcome</CardTitle>
        </CardHeader>
        <CardContent>
          <p>My Feature is ready to use.</p>
        </CardContent>
      </Card>
    </div>
  );
}
`;
```

---

## Testing Your Module

<Steps>
1. **Build the module**
   ```bash
   npm run build
   ```

2. **Link locally**
   ```bash
   npm link
   ```

3. **Create a test app** (or use existing)
   ```bash
   # In another terminal
   cd ../my-test-app
   ```

4. **Install your module**
   ```bash
   npx my-billing-module init
   ```

5. **Verify installation**
   - Check `frontend/src/features/billing/` exists
   - Check `backend/src/features/billing/` exists
   - Run the app: `npm run dev`
   - Navigate to your module's page
</Steps>

---

## Updating from Module Starter

When the module starter improves (bug fixes, new features, template improvements), you can pull those changes into your module. This works the same way the starter template updates propagate to apps.

### How It Works

The create script preserves git history and sets up `scaffold-upstream` as a remote pointing back to the module starter. This enables standard git merge to pull in changes.

```bash
# Check what's changed
npm run scaffold:check

# Merge updates
npm run scaffold:update
```

The update script will:
1. Fetch the latest module starter from `scaffold-upstream`
2. Show available commits and version differences
3. Merge changes via git
4. Handle conflicts (if any)

### What Gets Updated

| Updated (module starter infrastructure) | Preserved (your code) |
|-----------------------------------------|----------------------|
| `src/scaffold/*` — init, update, uninstall logic | `src/templates/*` — your custom templates |
| `src/cli.ts` — CLI entry point | `src/module.ts` — your module configuration |
| `scripts/*` — build and version scripts | `package.json` — your module name and deps |
| `tsconfig.json`, `tsup.config.ts` — build config | `CLAUDE.md` — your module-specific instructions |
| `VERSION` — scaffold version | `.env` files |

### Handling Conflicts

If both you and the module starter modified the same file, git will flag a conflict:

```bash
# Keep your version
git checkout --ours path/to/file

# Take module starter version
git checkout --theirs path/to/file

# After resolving
git add path/to/file
git commit
```

<Aside type="tip">
Scaffold updates primarily affect `src/scaffold/` and build infrastructure. Your templates in `src/templates/` are yours — the module starter only provides the initial starting point. Conflicts are rare because the scaffold files are marked "DO NOT EDIT".
</Aside>

<Aside type="note">
For a full explanation of versioning, version headers, and how updates flow through the system, see [Versioning & Updates](/module-starter/versioning/).
</Aside>

---

## Publishing

### Version Bump

Before publishing, bump the version:

```bash
npm run release:patch    # Bug fixes
npm run release:minor    # New features
npm run release:major    # Breaking changes
```

This updates both `package.json` and `src/module.ts`, commits, and creates a git tag.

### npm Publish

```bash
npm publish
```

Users can then install with:

```bash
npx my-billing-module init
```

---

## Next Steps

- [Module Structure](/module-starter/module-structure/) - Detailed file reference
- [Registry Integration](/module-starter/registry-integration/) - Connecting to the starter template's registries
- [Scaffold Architecture](/module-starter/scaffold/) - How the scaffold infrastructure works
- [Code Templates](/module-starter/templates/) - Copy-paste templates
- [Lifecycle Hooks](/module-starter/lifecycle-hooks/) - Filters, actions, and module lifecycle
