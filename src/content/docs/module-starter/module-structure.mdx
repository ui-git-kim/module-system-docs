---
title: Module Structure
description: File structure reference for module packages and generated output
---

import { FileTree, Aside, Tabs, TabItem } from '@astrojs/starlight/components';

This page documents two structures: the **module package** (what you edit) and the **generated output** (what gets installed into apps).

---

## Module Package Structure

This is what the module starter looks like after cloning:

<FileTree>
- my-module/
  - src/
    - module.ts *(EDIT - module configuration)*
    - cli.ts *(DO NOT EDIT)*
    - index.ts *(exports)*
    - scaffold/ *(DO NOT EDIT - shared infrastructure)*
      - init.ts
      - update.ts
      - uninstall.ts
      - types.ts
      - utils.ts
      - ...
    - templates/ *(EDIT - your file templates)*
      - schema.ts
      - frontend/
        - index.ts
        - routes.ts
        - pages.ts
        - components.ts
        - registrations.ts
        - services.ts
        - types.ts
      - backend/
        - index.ts
        - routes.ts
        - services.ts
        - registrations.ts
        - types.ts
  - scripts/ *(version bump scripts)*
  - dist/ *(built output)*
  - package.json
  - VERSION *(scaffold version)*
  - CLAUDE.md *(AI instructions)*
  - README.md
</FileTree>

### Key Files

| File | Purpose | Edit? |
|------|---------|-------|
| `src/module.ts` | Module ID, name, templates, configuration | ✅ Yes |
| `src/templates/**/*.ts` | File content templates | ✅ Yes |
| `src/cli.ts` | CLI command handling | ❌ No |
| `src/scaffold/**/*.ts` | Scaffolding infrastructure | ❌ No |
| `package.json` | Package name, version, bin command | ✅ Yes |
| `VERSION` | Scaffold infrastructure version | Auto |

---

## Generated Output Structure

When users run `npx my-module init`, this structure is created in the target app:

<Tabs>
  <TabItem label="Frontend">
    <FileTree>
    - frontend/src/features/[module]/
      - index.ts *(barrel exports + registration imports)*
      - navigation.registration.ts
      - routes.config.tsx
      - pages/
        - [Module]Page.tsx
      - components/
        - widgets/ *(optional)*
        - settings/ *(optional)*
      - hooks/ *(optional)*
      - services/ *(optional)*
      - types/ *(optional)*
      - registrations/ *(optional)*
        - dashboard.registration.ts
        - preferences.registration.ts
        - ...
    </FileTree>
  </TabItem>
  <TabItem label="Backend">
    <FileTree>
    - backend/src/features/[module]/
      - index.ts *(barrel exports + registration imports)*
      - [module].routes.ts
      - [module].service.ts
      - [module].types.ts
      - route.registration.ts
      - service.registration.ts
    </FileTree>
  </TabItem>
  <TabItem label="Database">
    <FileTree>
    - backend/prisma/
      - schema/ *(multi-file mode)*
        - [module].prisma
      - schema.prisma *(single-file mode - appended)*
    </FileTree>
  </TabItem>
</Tabs>

---

## Naming Conventions

### File Names

| Type | Convention | Example |
|------|------------|---------|
| Module folder | kebab-case | `ai-chat` |
| Routes file | `[module].routes.ts` | `ai-chat.routes.ts` |
| Service file | `[module].service.ts` | `ai-chat.service.ts` |
| Types file | `[module].types.ts` | `ai-chat.types.ts` |
| Page component | `[Module]Page.tsx` | `AiChatPage.tsx` |
| Registration files | `*.registration.ts` | `navigation.registration.ts` |

### Export Names

| Type | Convention | Example |
|------|------------|---------|
| Routes array | `[module]Routes` | `aiChatRoutes` |
| Service object | `[module]Service` | `aiChatService` |
| Main hook | `use[Module]` | `useAiChat` |
| Page component | `[Module]Page` | `AiChatPage` |
| Widget component | `[Module]Widget` | `AiChatWidget` |

---

## Index File Patterns

### Frontend Index

```typescript
// frontend/src/features/[module]/index.ts

// ========================================================================
// REGISTRATION IMPORTS (side effects)
// These MUST come first - they register with app registries
// ========================================================================

import './navigation.registration';
// import './registrations/dashboard.registration';
// import './registrations/preferences.registration';
// import './filter.registration';
// import './action.registration';

// ========================================================================
// PUBLIC EXPORTS
// ========================================================================

export { moduleRoutes } from './routes.config';
export { ModulePage } from './pages/ModulePage';
// export { useModule } from './hooks/useModule';
// export type { ModuleItem } from './types';
```

### Backend Index

```typescript
// backend/src/features/[module]/index.ts

// ========================================================================
// REGISTRATION IMPORTS (side effects)
// ========================================================================

import './route.registration.js';
import './service.registration.js';
// import './filter.registration.js';
// import './action.registration.js';

// ========================================================================
// PUBLIC EXPORTS
// ========================================================================

export { moduleRoutes } from './[module].routes.js';
export { moduleService } from './[module].service.js';
export type * from './[module].types.js';
```

<Aside type="caution">
Backend imports **must** use `.js` extension for relative imports. This is required for ESM compatibility.
</Aside>

---

## Order Convention

All registries use the same ordering system (lower = appears first):

| Range | Purpose | Examples |
|-------|---------|----------|
| **1-9** | Core/system | Auth checks, core widgets |
| **10** | Default | Standard items |
| **11-49** | Primary features | Main feature navigation |
| **50-79** | Standard modules | Most installed modules |
| **80-99** | Secondary | Settings, footer items |
| **100+** | Plugins/third-party | External integrations |

<Aside type="tip">
Use order 50 for most modules. Admin can override via the admin panel.
</Aside>

---

## Registration Files

### Navigation Registration

```typescript
// navigation.registration.ts
import { navigationRegistry } from '@/config/navigation.registry';
import { MessageSquare } from 'lucide-react';

navigationRegistry.registerMain({
  id: 'ai-chat',
  title: 'AI Chat',
  url: '/dashboard/ai-chat',
  icon: MessageSquare,
  order: 50,
});
```

### Route Registration (Backend)

```typescript
// route.registration.ts
import { routeRegistry } from '../../config/route.registry.js';
import { aiChatRoutes } from './ai-chat.routes.js';

routeRegistry.register({
  path: '/ai-chat',
  router: aiChatRoutes,
  feature: 'ai-chat',
  versions: ['v1'],
  requiresAuth: true,
});
```

### Service Registration (Backend)

```typescript
// service.registration.ts
import { serviceRegistry } from '../../config/service.registry.js';
import { aiChatService } from './ai-chat.service.js';

declare module '../../config/service.registry.js' {
  interface ServiceTypes {
    'ai-chat': typeof aiChatService;
  }
}

serviceRegistry.register('ai-chat', aiChatService, {
  feature: 'ai-chat',
  description: 'AI chat business logic',
});
```

---

## Template Organisation

### Split by Category

Templates are organised by file type for maintainability:

```
src/templates/
├── frontend/
│   ├── index.ts        # Re-exports all frontend templates
│   ├── routes.ts       # INDEX_TEMPLATE, ROUTES_CONFIG
│   ├── pages.ts        # PAGE_TEMPLATE, SETTINGS_PAGE_TEMPLATE
│   ├── components.ts   # WIDGET_TEMPLATE, etc.
│   ├── registrations.ts # All *_REGISTRATION templates
│   ├── services.ts     # SERVICE_TEMPLATE
│   └── types.ts        # TYPES_TEMPLATE
├── backend/
│   ├── index.ts        # Re-exports all backend templates
│   ├── routes.ts       # INDEX_TEMPLATE, ROUTES_TEMPLATE
│   ├── services.ts     # SERVICE_TEMPLATE
│   ├── registrations.ts # ROUTE_REGISTRATION, SERVICE_REGISTRATION
│   └── types.ts        # TYPES_TEMPLATE
└── schema.ts           # SCHEMA_TEMPLATE
```

### Template Naming

| Constant | Purpose |
|----------|---------|
| `INDEX_TEMPLATE` | Barrel file (index.ts) |
| `ROUTES_CONFIG` | React Router routes |
| `PAGE_TEMPLATE` | Main page component |
| `ROUTES_TEMPLATE` | Express router |
| `SERVICE_TEMPLATE` | Business logic |
| `*_REGISTRATION` | Registry registration files |
| `SCHEMA_TEMPLATE` | Prisma models |

---

## Next Steps

- [Code Templates](/module-starter/templates/) - Copy-paste templates
- [Lifecycle Hooks](/module-starter/lifecycle-hooks/) - Filters and actions
- [Creating Modules](/module-starter/creating-modules/) - Step-by-step guide
